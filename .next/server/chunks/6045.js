"use strict";exports.id=6045,exports.ids=[6045,3594],exports.modules={35747:(e,t,o)=>{o.d(t,{Bd:()=>r,ZO:()=>i,jQ:()=>a,yK:()=>s});class n extends Error{constructor(e,t){super(e),this.missingVars=t,this.name="EnvironmentValidationError"}}function r(){try{return function(){let e=[],t=[];function o(t){let o=process.env[t];return o||(e.push(t),"")}function r(e,o){let n=process.env[e];return n||void 0===o?n||void 0:(t.push(`${e} not set, using default: ${o}`),o)}function i(e,o){let n=process.env[e];if(!n)return void 0!==o?(t.push(`${e} not set, using default: ${o}`),o):void 0;let r=parseInt(n,10);return isNaN(r)?(t.push(`${e} is not a valid number, ignoring`),o):r}function s(e,o){let n=process.env[e];return n?"true"===n.toLowerCase():void 0!==o?(t.push(`${e} not set, using default: ${o}`),o):void 0}let a={openai:{apiKey:o("OPENAI_API_KEY")},multiModel:{anthropic:r("ANTHROPIC_API_KEY"),google:r("GOOGLE_API_KEY"),mistral:r("MISTRAL_API_KEY"),groq:r("GROQ_API_KEY")},notion:{token:o("NOTION_TOKEN"),databases:{registry:o("NOTION_DB_REGISTRY"),cases:o("NOTION_DB_CASES"),finance:o("NOTION_DB_FINANCE"),publishing:o("NOTION_DB_PUBLISHING")}},database:{pgDsn:o("PG_DSN"),poolMin:i("PG_POOL_MIN",2),poolMax:i("PG_POOL_MAX",20)},vector:{qdrantUrl:o("QDRANT_URL"),qdrantApiKey:o("QDRANT_API_KEY"),collectionName:r("QDRANT_COLLECTION_NAME","traceremove_vectors"),dimension:i("VECTOR_DIMENSION",1536)},cache:{redisUrl:r("UPSTASH_REDIS_REST_URL"),redisToken:r("UPSTASH_REDIS_REST_TOKEN"),ttlSearch:i("CACHE_TTL_SEARCH",3600),ttlDatabase:i("CACHE_TTL_DATABASE",1800),maxSize:i("CACHE_MAX_SIZE",1e3)},security:{cronSecret:o("CRON_SECRET"),rateLimitRequests:i("RATE_LIMIT_REQUESTS",100),rateLimitWindow:i("RATE_LIMIT_WINDOW",60)},monitoring:{logLevel:r("LOG_LEVEL","info"),logFormat:r("LOG_FORMAT","json"),enablePerformanceTracking:s("ENABLE_PERFORMANCE_TRACKING",!0),enableHealthChecks:s("ENABLE_HEALTH_CHECKS",!0)},etl:{fullSyncInterval:i("ETL_FULL_SYNC_INTERVAL",1440),incrementalSyncInterval:i("ETL_INCREMENTAL_SYNC_INTERVAL",60),batchSize:i("ETL_BATCH_SIZE",100),maxRetries:i("ETL_MAX_RETRIES",3)},development:{debugMode:s("DEBUG_MODE",!1),mockExternalApis:s("MOCK_EXTERNAL_APIS",!1),skipHealthChecks:s("SKIP_HEALTH_CHECKS",!1)}};if(t.length>0&&a.development.debugMode&&console.warn("Environment validation warnings:",t),e.length>0)throw new n(`Missing required environment variables: ${e.join(", ")}. Please check your .env.local file and ensure all required variables are set.`,e);return a}()}catch(e){if(e instanceof n)return console.error("Environment validation failed:",e.message),null;throw e}}function i(){return process.env.LOG_LEVEL||"info"}function s(){return"true"===process.env.DEBUG_MODE}function a(){return"true"===process.env.MOCK_EXTERNAL_APIS}},28977:(e,t,o)=>{o.d(t,{$G:()=>a,JN:()=>l,id:()=>i,p8:()=>r});class n extends Error{constructor(e,t=500,o,n){super(e),this.statusCode=t,this.code=o,this.details=n,this.name="APIError"}}class r extends n{constructor(e,t){super(e,400,"VALIDATION_ERROR",t),this.name="ValidationError"}}class i extends n{constructor(e,t,o){super(`${e} service error: ${t}`,502,"EXTERNAL_SERVICE_ERROR",o),this.name="ExternalServiceError"}}function s(e,t){let o={error:e.message,timestamp:new Date().toISOString()};return t&&(o.requestId=t),e instanceof n&&(o.code=e.code,o.details=e.details),o}function a(e){return(console.error("API Error:",e),e instanceof n)?{response:s(e),status:e.statusCode}:e instanceof Error?{response:s(e),status:500}:{response:{error:"An unexpected error occurred",timestamp:new Date().toISOString()},status:500}}async function l(e,t=3,o=1e3,n=2){let r;for(let i=1;i<=t;i++)try{return await e()}catch(s){if(r=s instanceof Error?s:Error(String(s)),i===t)throw r;let e=o*Math.pow(n,i-1);console.warn(`Attempt ${i} failed, retrying in ${e}ms:`,r.message),await new Promise(t=>setTimeout(t,e))}throw r}},56045:(e,t,o)=>{o.d(t,{_I:()=>g,getOpenAIClient:()=>u,oJ:()=>_});var n=o(69809),r=o(21507),i=o(50148),s=o(29550),a=o(49582),l=o(35747),c=o(28977);let p={};function u(){if(!p.openai){if((0,l.jQ)())return console.log("Using mock OpenAI client for development"),p.openai={},p.openai;let e=(0,l.Bd)();if(!e?.openai.apiKey)throw new c.id("OpenAI","API key not configured properly. Please set OPENAI_API_KEY environment variable.");p.openai=new n.ZP({apiKey:e.openai.apiKey})}return p.openai}let m=new Map;function d(e,t,o,n,r,i){let s=`${e}-${t}`,a=m.get(s);if(a){let e=a.successRate>0?Math.round(1/(1-a.successRate)):1,t=e+1;a.avgResponseTime=(a.avgResponseTime*e+o)/t,a.errorRate=n?a.errorRate*e/t:(a.errorRate*e+1)/t,a.costPerToken=r>0?(a.costPerToken+i/r)/2:a.costPerToken,a.successRate=(a.successRate*e+(n?1:0))/t,a.lastUpdated=new Date}else m.set(s,{provider:e,model:t,avgResponseTime:o,errorRate:n?0:1,costPerToken:r>0?i/r:0,successRate:n?1:0,lastUpdated:new Date})}function g(e){let{intent:t,length:o,persona:n,prioritize:r="quality"}=e,i=function(e,t,o){let n=[];return"code"===e&&t<2e3?n.push({provider:"openai",model:"gpt-4o-mini",temperature:.1},{provider:"groq",model:"llama-3.1-8b-instant",temperature:.1}):"long"===e||t>4e3?n.push({provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7},{provider:"openai",model:"gpt-4o",temperature:.7}):"analysis"===e&&("philosopher"===o||"comprehensive-ai"===o)?n.push({provider:"openai",model:"gpt-4o",temperature:.6},{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.6}):"comprehensive-ai"===o&&"qa"===e?n.push({provider:"openai",model:"gpt-4o",temperature:.7},{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7}):"qa"===e&&t<1e3&&n.push({provider:"openai",model:"gpt-4o-mini",temperature:.7},{provider:"groq",model:"llama-3.1-8b-instant",temperature:.7},{provider:"google",model:"gemini-pro",temperature:.7}),0===n.length&&n.push({provider:"openai",model:"gpt-4o-mini",temperature:.7}),n}(t,o,n);return"speed"===r?function(e){let t=e[0],o=1/0;for(let n of e){let e=`${n.provider}-${n.model}`,r=m.get(e);r&&r.avgResponseTime<o&&r.successRate>.9&&(t=n,o=r.avgResponseTime)}return t}(i):"cost"===r?function(e){let t=e[0],o=1/0;for(let n of e){let e=`${n.provider}-${n.model}`,r=m.get(e);r&&r.costPerToken<o&&r.successRate>.9&&(t=n,o=r.costPerToken)}return t}(i):"code"===t&&o<2e3?{provider:"openai",model:"gpt-4o-mini",temperature:.1}:"long"===t||o>4e3?{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7}:"analysis"===t&&("philosopher"===n||"comprehensive-ai"===n)?{provider:"openai",model:"gpt-4o",temperature:.6}:"comprehensive-ai"===n&&"qa"===t?{provider:"openai",model:"gpt-4o",temperature:.7}:{provider:"openai",model:"gpt-4o-mini",temperature:.7}}async function _(e,t){let{provider:o,model:n,temperature:m=.7,maxTokens:g=1e3}=t,E=Date.now();if((0,l.jQ)())return console.log(`Mock response for ${o} ${n}`),{content:`Mock response from ${o} ${n} for: ${e[e.length-1]?.content?.substring(0,50)}...`,provider:o,model:n,usage:{promptTokens:100,completionTokens:50,totalTokens:150}};try{let t=await (0,c.JN)(async()=>{switch(o){case"openai":{let t=u(),r=await t.chat.completions.create({model:n,messages:e,temperature:m,max_tokens:g});return{content:r.choices[0]?.message?.content||"",provider:o,model:n,usage:r.usage?{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens,totalTokens:r.usage.total_tokens}:void 0}}case"anthropic":{let t=function(){if(!p.anthropic){if((0,l.jQ)())return console.log("Using mock Anthropic client for development"),p.anthropic={},p.anthropic;let e=(0,l.Bd)();if(!e?.multiModel.anthropic)throw new c.id("Anthropic","API key not configured properly. Please set ANTHROPIC_API_KEY environment variable.");p.anthropic=new r.ZP({apiKey:e.multiModel.anthropic})}return p.anthropic}(),i=e.find(e=>"system"===e.role),s=e.filter(e=>"system"!==e.role),a=await t.messages.create({model:n,max_tokens:g,temperature:m,system:i?.content,messages:s.map(e=>({role:e.role,content:e.content}))}),u=a.content[0];return{content:"text"===u.type?u.text:"",provider:o,model:n,usage:a.usage?{promptTokens:a.usage.input_tokens,completionTokens:a.usage.output_tokens,totalTokens:a.usage.input_tokens+a.usage.output_tokens}:void 0}}case"google":{let t=function(){if(!p.google){if((0,l.jQ)())return console.log("Using mock Google client for development"),p.google={},p.google;let e=(0,l.Bd)();if(!e?.multiModel.google)throw new c.id("Google","API key not configured properly. Please set GOOGLE_API_KEY environment variable.");p.google=new i.$D(e.multiModel.google)}return p.google}(),r=t.getGenerativeModel({model:n}),s=e.find(e=>"system"===e.role),a=e.filter(e=>"system"!==e.role),u=[s?.content,...a.map(e=>`${e.role}: ${e.content}`)].filter(Boolean).join("\n\n"),m=await r.generateContent(u),d=m.response.text();return{content:d,provider:o,model:n}}case"mistral":{let t=function(){if(!p.mistral){if((0,l.jQ)())return console.log("Using mock Mistral client for development"),p.mistral={},p.mistral;let e=(0,l.Bd)();if(!e?.multiModel.mistral)throw new c.id("Mistral","API key not configured properly. Please set MISTRAL_API_KEY environment variable.");p.mistral=new s.Z(e.multiModel.mistral)}return p.mistral}(),r=await t.chat({model:n,messages:e,temperature:m,maxTokens:g});return{content:r.choices?.[0]?.message?.content||"",provider:o,model:n,usage:r.usage?{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens,totalTokens:r.usage.total_tokens}:void 0}}case"groq":{let t=function(){if(!p.groq){if((0,l.jQ)())return console.log("Using mock Groq client for development"),p.groq={},p.groq;let e=(0,l.Bd)();if(!e?.multiModel.groq)throw new c.id("Groq","API key not configured properly. Please set GROQ_API_KEY environment variable.");p.groq=new a.ZP({apiKey:e.multiModel.groq})}return p.groq}(),r=await t.chat.completions.create({model:n,messages:e,temperature:m,max_tokens:g});return{content:r.choices[0]?.message?.content||"",provider:o,model:n,usage:r.usage?{promptTokens:r.usage.prompt_tokens,completionTokens:r.usage.completion_tokens,totalTokens:r.usage.total_tokens}:void 0}}default:throw Error(`Unsupported provider: ${o}`)}},2),_=Date.now()-E,f=t.usage?.totalTokens||0,h=({openai:{"gpt-4o":3e-5,"gpt-4o-mini":15e-8,"gpt-4":3e-5},anthropic:{"claude-3-5-sonnet-20241022":15e-6,"claude-3-haiku-20240307":25e-8},google:{"gemini-pro":5e-7},mistral:{"mistral-large":8e-6},groq:{"llama-3.1-8b-instant":1e-7}}[o]?.[n]||1e-6)*f;return d(o,n,_,!0,f,h),t}catch(r){let t=Date.now()-E;if(d(o,n,t,!1,0,0),console.error(`Error with ${o} ${n}:`,r),"openai"!==o){console.log(`Falling back to OpenAI due to ${o} error...`);try{return _(e,{provider:"openai",model:"gpt-4o-mini",temperature:m})}catch(e){throw console.error("Fallback to OpenAI also failed:",e),Error(`Both ${o} and OpenAI fallback failed. Please check API key configuration.`)}}throw r}}}};