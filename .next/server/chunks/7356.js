"use strict";exports.id=7356,exports.ids=[7356,1124,1087],exports.modules={81087:(e,t,s)=>{s.r(t),s.d(t,{cacheQueryResult:()=>l,cacheSearchResults:()=>o,clearAdvancedCache:()=>c,getCacheStats:()=>n,getCachedQueryResult:()=>u,getCachedSearchResults:()=>h,withAdvancedCache:()=>i});class r{constructor(){this.cache=new Map,this.maxSize=1e3,this.defaultTTL=3e5,this.cleanupInterval=setInterval(()=>this.cleanup(),6e4)}set(e,t,s){let r=Date.now(),a=r+(s||this.defaultTTL);this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,{key:e,value:t,expiry:a,hits:0,created:r,lastAccessed:r})}get(e){let t=this.cache.get(e);if(!t)return null;let s=Date.now();return s>t.expiry?(this.cache.delete(e),null):(t.hits++,t.lastAccessed=s,t.value)}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()>t.expiry)||(this.cache.delete(e),!1))}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}evictLRU(){let e="",t=Date.now();for(let[s,r]of this.cache.entries())r.lastAccessed<t&&(t=r.lastAccessed,e=s);e&&this.cache.delete(e)}cleanup(){let e=Date.now(),t=[];for(let[s,r]of this.cache.entries())e>r.expiry&&t.push(s);t.forEach(e=>this.cache.delete(e)),t.length>0&&console.log(`ðŸ§¹ Cache cleanup: removed ${t.length} expired entries`)}getStats(){let e=Date.now(),t=Array.from(this.cache.values()).map(t=>({key:t.key,hits:t.hits,age:e-t.created,ttl:t.expiry-e})),s=t.reduce((e,t)=>e+t.hits,0),r=s>0?s/t.length:0;return{size:this.cache.size,maxSize:this.maxSize,hitRate:r,entries:t.sort((e,t)=>t.hits-e.hits).slice(0,10)}}destroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cache.clear()}}let a=new r;async function i(e,t,s){let r=a.get(e);if(null!==r)return r;let i=await t();return a.set(e,i,s),i}function n(){return a.getStats()}function c(){a.clear()}async function o(e,t,s,r=6e5){let i=`search:${t}:${Buffer.from(e).toString("base64")}`;a.set(i,s,r)}async function h(e,t){let s=`search:${t}:${Buffer.from(e).toString("base64")}`;return a.get(s)}async function l(e,t,s,r=3e5){let i=`query:${Buffer.from(e+JSON.stringify(t)).toString("base64")}`;a.set(i,s,r)}async function u(e,t){let s=`query:${Buffer.from(e+JSON.stringify(t)).toString("base64")}`;return a.get(s)}},47356:(e,t,s)=>{s.r(t),s.d(t,{generateSystemReport:()=>m,getHealthChecks:()=>l,getSystemMetrics:()=>h,performHealthChecks:()=>u,recordApiResponse:()=>n,recordModelUsage:()=>c,updateHealthCheck:()=>o,updateMetric:()=>i});let r={timestamp:new Date().toISOString(),apiResponseTimes:{},databaseConnections:0,vectorIndexSize:0,notionSyncStatus:{},modelUsage:{},memoryUsage:0,uptime:0},a=[];function i(e,t){r[e]=t,r.timestamp=new Date().toISOString()}function n(e,t){r.apiResponseTimes[e]=t,r.timestamp=new Date().toISOString()}function c(e,t,s){r.modelUsage[e]||(r.modelUsage[e]={requests:0,tokens:0,errors:0}),r.modelUsage[e].requests++,r.modelUsage[e].tokens+=t,s&&r.modelUsage[e].errors++,r.timestamp=new Date().toISOString()}function o(e,t,s,r){let i=a.findIndex(t=>t.service===e),n={service:e,status:t,responseTime:s,error:r,lastCheck:new Date().toISOString()};i>=0?a[i]=n:a.push(n)}function h(){r.uptime=process.uptime(),r.memoryUsage=process.memoryUsage().heapUsed/1024/1024;try{let{getCacheStats:e}=s(81087),t=e();r.cacheStats={size:t.size,hitRate:t.hitRate,maxSize:t.maxSize}}catch(e){console.debug("Cache stats not available:",e)}try{let{getPerformanceStats:e}=s(41124),t=e();r.queryPerformance={averageResponseTime:t.averageQueryTime,slowQueries:t.slowQueries,totalQueries:t.totalQueries}}catch(e){console.debug("Performance stats not available:",e)}return{...r}}function l(){return[...a]}async function u(){let e=[];try{let t=Date.now(),{getPool:r}=await s.e(8307).then(s.bind(s,88307)),a=r();await a.query("SELECT 1");let i=Date.now()-t;e.push({service:"PostgreSQL",status:i<1e3?"healthy":"degraded",responseTime:i,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"PostgreSQL",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}try{let t=Date.now(),{getOpenAIClient:r}=await Promise.all([s.e(9809),s.e(6849),s.e(6045)]).then(s.bind(s,56045)),a=r();await a.models.list();let i=Date.now()-t;e.push({service:"OpenAI",status:i<2e3?"healthy":"degraded",responseTime:i,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"OpenAI",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}try{let t=Date.now(),{getNotionClient:r}=await Promise.all([s.e(9809),s.e(8830),s.e(3326),s.e(2082),s.e(3594)]).then(s.bind(s,12082)),a=r();await a.users.me({});let i=Date.now()-t;e.push({service:"Notion",status:i<2e3?"healthy":"degraded",responseTime:i,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"Notion",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}return a=e,e}function m(){let e=h(),t=l(),s=t.filter(e=>"unhealthy"===e.status),r=t.filter(e=>"degraded"===e.status),a=[];s.length>0&&a.push(`Critical: ${s.length} services are unhealthy: ${s.map(e=>e.service).join(", ")}`),r.length>0&&a.push(`Warning: ${r.length} services are degraded: ${r.map(e=>e.service).join(", ")}`),e.memoryUsage>500&&a.push("High memory usage detected. Consider optimizing queries or restarting services.");let i=Object.values(e.apiResponseTimes).reduce((e,t)=>e+t,0)/Object.values(e.apiResponseTimes).length;i>2e3&&a.push("High API response times detected. Check database and external service performance."),0===a.length&&a.push("All systems operating normally.");let n=`System Status: ${0===s.length?0===r.length?"Healthy":"Degraded":"Critical"} | Uptime: ${Math.floor(e.uptime/3600)}h ${Math.floor(e.uptime%3600/60)}m | Memory: ${e.memoryUsage.toFixed(1)}MB`;return{summary:n,metrics:e,health:t,recommendations:a}}},41124:(e,t,s)=>{s.r(t),s.d(t,{getPerformanceStats:()=>i,measurePerformance:()=>n,measureQuery:()=>c,performanceMonitor:()=>a});class r{recordMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&this.metrics.shift()}recordQuery(e){this.queryMetrics.push(e),this.queryMetrics.length>this.maxMetrics&&this.queryMetrics.shift()}getAverageResponseTime(e=5){let t=new Date(Date.now()-6e4*e),s=this.metrics.filter(e=>new Date(e.timestamp)>t);return 0===s.length?0:s.reduce((e,t)=>e+t.responseTime,0)/s.length}getSlowestQueries(e=10){return[...this.queryMetrics].sort((e,t)=>t.duration-e.duration).slice(0,e)}getMetricsSummary(){let e=this.getAverageResponseTime(),t=this.metrics.length>0?this.metrics.reduce((e,t)=>e+t.memoryUsage,0)/this.metrics.length:0,s=this.queryMetrics.filter(e=>e.duration>1e3).length;return{avgResponseTime:e,avgMemoryUsage:t,totalQueries:this.queryMetrics.length,slowQueries:s}}clearOldMetrics(e=24){let t=new Date(Date.now()-36e5*e);this.metrics=this.metrics.filter(e=>new Date(e.timestamp)>t),this.queryMetrics=this.queryMetrics.filter(e=>new Date(e.timestamp)>t)}constructor(){this.metrics=[],this.queryMetrics=[],this.maxMetrics=1e3}}let a=new r;function i(){let e=a.getMetricsSummary();return{totalQueries:e.totalQueries,averageQueryTime:e.avgResponseTime,slowQueries:e.slowQueries}}function n(e,t){return new Promise(async(t,s)=>{let r=Date.now(),i=process.memoryUsage().heapUsed;try{let s=await e(),n=Date.now(),c=process.memoryUsage().heapUsed;a.recordMetric({responseTime:n-r,memoryUsage:(c-i)/1024/1024,timestamp:new Date().toISOString()}),t(s)}catch(e){s(e)}})}function c(e,t){return new Promise(async(s,r)=>{let i=Date.now();try{let r=await e(),n=Date.now()-i;a.recordQuery({query:t.substring(0,100),duration:n,rows:Array.isArray(r)?r.length:1,timestamp:new Date().toISOString()}),s(r)}catch(e){r(e)}})}}};