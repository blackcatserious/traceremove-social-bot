"use strict";(()=>{var e={};e.id=6368,e.ids=[6368,7356,1124,1087],e.modules={21841:e=>{e.exports=require("@aws-sdk/client-s3")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8678:e=>{e.exports=import("pg")},57147:e=>{e.exports=require("fs")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},87561:e=>{e.exports=require("node:fs")},84492:e=>{e.exports=require("node:stream")},72477:e=>{e.exports=require("node:stream/web")},71017:e=>{e.exports=require("path")},85477:e=>{e.exports=require("punycode")},12781:e=>{e.exports=require("stream")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},71267:e=>{e.exports=require("worker_threads")},59796:e=>{e.exports=require("zlib")},55074:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>q,originalPathname:()=>D,patchFetch:()=>O,requestAsyncStorage:()=>w,routeModule:()=>f,serverHooks:()=>S,staticGenerationAsyncStorage:()=>v,staticGenerationBailout:()=>x});var s={};r.r(s),r.d(s,{GET:()=>m,dynamic:()=>h,runtime:()=>l});var a=r(10884),n=r(16132),i=r(21040),o=r(95798),c=r(47356),u=r(28977);let l="nodejs",h="force-dynamic";async function m(e){try{let{searchParams:t}=new URL(e.url),r=t.get("timeframe")||"24h",s=t.get("metric")||"all",a=(0,c.getSystemMetrics)(),n={timestamp:new Date().toISOString(),timeframe:r,performance:{apiResponseTimes:a.apiResponseTimes,modelUsage:a.modelUsage,errorRates:function(e){let t=e.modelUsage,r={};for(let[e,s]of Object.entries(t))r[e]=s.requests>0?s.errors/s.requests*100:0;return r}(a),throughput:function(e,t){let r="24h"===t?24:"7d"===t?168:720,s=e.modelUsage,a={};for(let[e,t]of Object.entries(s))a[e]=t.requests/r;return a}(a,r)},costs:await d(r),userInteractions:await g(r),contentGeneration:await p(r),trends:await y(r),recommendations:function(e){let t=[],r=e.modelUsage,s=e.apiResponseTimes,a=Object.values(s).reduce((e,t)=>e+t,0)/Object.values(s).length;a>2e3&&t.push("Consider optimizing API response times - current average is above 2 seconds");let n=Object.values(r).reduce((e,t)=>e+t.errors,0),i=Object.values(r).reduce((e,t)=>e+t.requests,0);n/i*100>1&&t.push("Error rate is elevated - review model configurations and fallback strategies"),e.memoryUsage>400&&t.push("Memory usage is high - consider implementing more aggressive caching strategies");let o=Object.entries(r).reduce((e,t)=>e[1].requests>t[1].requests?e:t);return o[1].requests>.7*i&&t.push(`Consider load balancing - ${o[0]} is handling ${Math.round(o[1].requests/i*100)}% of requests`),0===t.length&&t.push("System is performing optimally - no immediate recommendations"),t}(a)};if("all"!==s)return o.Z.json({[s]:n[s]});return o.Z.json(n)}catch(r){console.error("Advanced analytics API error:",r);let{response:e,status:t}=(0,u.$G)(r);return o.Z.json(e,{status:t})}}async function d(e){let t={openai:{requests:12450,cost:245.67,tokens:125e4},anthropic:{requests:8930,cost:189.23,tokens:89e4},google:{requests:1250,cost:23.45,tokens:125e3},mistral:{requests:5670,cost:78.9,tokens:567e3},groq:{requests:3200,cost:12.5,tokens:32e4}},r=Object.values(t).reduce((e,t)=>e+t.cost,0),s=Object.values(t).reduce((e,t)=>e+t.requests,0),a=Object.values(t).reduce((e,t)=>e+t.tokens,0);return{byProvider:t,totals:{cost:r,requests:s,tokens:a,costPerRequest:r/s,costPerToken:r/a},trends:{costChange:"+8%",requestChange:"+15%",efficiencyChange:"-3%"}}}async function g(e){return{totalSessions:2847,averageSessionLength:4.2,topQueries:[{query:"AI ethics",count:234},{query:"machine learning",count:189},{query:"data privacy",count:156},{query:"automation",count:134},{query:"digital rights",count:98}],userRetention:{daily:.65,weekly:.42,monthly:.28},peakHours:[{hour:9,requests:145},{hour:14,requests:189},{hour:16,requests:167},{hour:20,requests:134}]}}async function p(e){return{totalGenerated:1456,byType:{articles:234,summaries:456,responses:567,analyses:199},qualityMetrics:{averageLength:1250,readabilityScore:8.2,accuracyRate:.94,userSatisfaction:4.3},trends:{volumeChange:"+12%",qualityChange:"+5%",speedImprovement:"+18%"}}}async function y(e){return{performance:{responseTime:{current:1200,change:-8,trend:"improving"},throughput:{current:145,change:15,trend:"improving"},errorRate:{current:.3,change:-12,trend:"improving"}},usage:{apiCalls:{current:45200,change:18,trend:"growing"},uniqueUsers:{current:1234,change:8,trend:"growing"},dataProcessed:{current:2.4,change:22,trend:"growing"}},costs:{totalSpend:{current:549.75,change:8,trend:"increasing"},efficiency:{current:.012,change:-3,trend:"improving"},roi:{current:3.2,change:12,trend:"improving"}}}}let f=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/analytics/advanced/route",pathname:"/api/analytics/advanced",filename:"route",bundlePath:"app/api/analytics/advanced/route"},resolvedPagePath:"/workspaces/traceremove-social-bot/src/app/api/analytics/advanced/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:w,staticGenerationAsyncStorage:v,serverHooks:S,headerHooks:q,staticGenerationBailout:x}=f,D="/api/analytics/advanced/route";function O(){return(0,i.patchFetch)({serverHooks:S,staticGenerationAsyncStorage:v})}},81087:(e,t,r)=>{r.r(t),r.d(t,{cacheQueryResult:()=>l,cacheSearchResults:()=>c,clearAdvancedCache:()=>o,getCacheStats:()=>i,getCachedQueryResult:()=>h,getCachedSearchResults:()=>u,withAdvancedCache:()=>n});class s{constructor(){this.cache=new Map,this.maxSize=1e3,this.defaultTTL=3e5,this.cleanupInterval=setInterval(()=>this.cleanup(),6e4)}set(e,t,r){let s=Date.now(),a=s+(r||this.defaultTTL);this.cache.size>=this.maxSize&&this.evictLRU(),this.cache.set(e,{key:e,value:t,expiry:a,hits:0,created:s,lastAccessed:s})}get(e){let t=this.cache.get(e);if(!t)return null;let r=Date.now();return r>t.expiry?(this.cache.delete(e),null):(t.hits++,t.lastAccessed=r,t.value)}has(e){let t=this.cache.get(e);return!!t&&(!(Date.now()>t.expiry)||(this.cache.delete(e),!1))}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}evictLRU(){let e="",t=Date.now();for(let[r,s]of this.cache.entries())s.lastAccessed<t&&(t=s.lastAccessed,e=r);e&&this.cache.delete(e)}cleanup(){let e=Date.now(),t=[];for(let[r,s]of this.cache.entries())e>s.expiry&&t.push(r);t.forEach(e=>this.cache.delete(e)),t.length>0&&console.log(`ðŸ§¹ Cache cleanup: removed ${t.length} expired entries`)}getStats(){let e=Date.now(),t=Array.from(this.cache.values()).map(t=>({key:t.key,hits:t.hits,age:e-t.created,ttl:t.expiry-e})),r=t.reduce((e,t)=>e+t.hits,0),s=r>0?r/t.length:0;return{size:this.cache.size,maxSize:this.maxSize,hitRate:s,entries:t.sort((e,t)=>t.hits-e.hits).slice(0,10)}}destroy(){this.cleanupInterval&&clearInterval(this.cleanupInterval),this.cache.clear()}}let a=new s;async function n(e,t,r){let s=a.get(e);if(null!==s)return s;let n=await t();return a.set(e,n,r),n}function i(){return a.getStats()}function o(){a.clear()}async function c(e,t,r,s=6e5){let n=`search:${t}:${Buffer.from(e).toString("base64")}`;a.set(n,r,s)}async function u(e,t){let r=`search:${t}:${Buffer.from(e).toString("base64")}`;return a.get(r)}async function l(e,t,r,s=3e5){let n=`query:${Buffer.from(e+JSON.stringify(t)).toString("base64")}`;a.set(n,r,s)}async function h(e,t){let r=`query:${Buffer.from(e+JSON.stringify(t)).toString("base64")}`;return a.get(r)}},28977:(e,t,r)=>{r.d(t,{$G:()=>o,JN:()=>c,id:()=>n,p8:()=>a});class s extends Error{constructor(e,t=500,r,s){super(e),this.statusCode=t,this.code=r,this.details=s,this.name="APIError"}}class a extends s{constructor(e,t){super(e,400,"VALIDATION_ERROR",t),this.name="ValidationError"}}class n extends s{constructor(e,t,r){super(`${e} service error: ${t}`,502,"EXTERNAL_SERVICE_ERROR",r),this.name="ExternalServiceError"}}function i(e,t){let r={error:e.message,timestamp:new Date().toISOString()};return t&&(r.requestId=t),e instanceof s&&(r.code=e.code,r.details=e.details),r}function o(e){return(console.error("API Error:",e),e instanceof s)?{response:i(e),status:e.statusCode}:e instanceof Error?{response:i(e),status:500}:{response:{error:"An unexpected error occurred",timestamp:new Date().toISOString()},status:500}}async function c(e,t=3,r=1e3,s=2){let a;for(let n=1;n<=t;n++)try{return await e()}catch(i){if(a=i instanceof Error?i:Error(String(i)),n===t)throw a;let e=r*Math.pow(s,n-1);console.warn(`Attempt ${n} failed, retrying in ${e}ms:`,a.message),await new Promise(t=>setTimeout(t,e))}throw a}},47356:(e,t,r)=>{r.r(t),r.d(t,{generateSystemReport:()=>m,getHealthChecks:()=>l,getSystemMetrics:()=>u,performHealthChecks:()=>h,recordApiResponse:()=>i,recordModelUsage:()=>o,updateHealthCheck:()=>c,updateMetric:()=>n});let s={timestamp:new Date().toISOString(),apiResponseTimes:{},databaseConnections:0,vectorIndexSize:0,notionSyncStatus:{},modelUsage:{},memoryUsage:0,uptime:0},a=[];function n(e,t){s[e]=t,s.timestamp=new Date().toISOString()}function i(e,t){s.apiResponseTimes[e]=t,s.timestamp=new Date().toISOString()}function o(e,t,r){s.modelUsage[e]||(s.modelUsage[e]={requests:0,tokens:0,errors:0}),s.modelUsage[e].requests++,s.modelUsage[e].tokens+=t,r&&s.modelUsage[e].errors++,s.timestamp=new Date().toISOString()}function c(e,t,r,s){let n=a.findIndex(t=>t.service===e),i={service:e,status:t,responseTime:r,error:s,lastCheck:new Date().toISOString()};n>=0?a[n]=i:a.push(i)}function u(){s.uptime=process.uptime(),s.memoryUsage=process.memoryUsage().heapUsed/1024/1024;try{let{getCacheStats:e}=r(81087),t=e();s.cacheStats={size:t.size,hitRate:t.hitRate,maxSize:t.maxSize}}catch(e){console.debug("Cache stats not available:",e)}try{let{getPerformanceStats:e}=r(41124),t=e();s.queryPerformance={averageResponseTime:t.averageQueryTime,slowQueries:t.slowQueries,totalQueries:t.totalQueries}}catch(e){console.debug("Performance stats not available:",e)}return{...s}}function l(){return[...a]}async function h(){let e=[];try{let t=Date.now(),{getPool:s}=await r.e(8307).then(r.bind(r,88307)),a=s();await a.query("SELECT 1");let n=Date.now()-t;e.push({service:"PostgreSQL",status:n<1e3?"healthy":"degraded",responseTime:n,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"PostgreSQL",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}try{let t=Date.now(),{getOpenAIClient:s}=await Promise.all([r.e(9809),r.e(6849),r.e(6045)]).then(r.bind(r,56045)),a=s();await a.models.list();let n=Date.now()-t;e.push({service:"OpenAI",status:n<2e3?"healthy":"degraded",responseTime:n,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"OpenAI",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}try{let t=Date.now(),{getNotionClient:s}=await Promise.all([r.e(9809),r.e(8830),r.e(3326),r.e(2082),r.e(3594)]).then(r.bind(r,12082)),a=s();await a.users.me({});let n=Date.now()-t;e.push({service:"Notion",status:n<2e3?"healthy":"degraded",responseTime:n,lastCheck:new Date().toISOString()})}catch(t){e.push({service:"Notion",status:"unhealthy",error:t instanceof Error?t.message:"Unknown error",lastCheck:new Date().toISOString()})}return a=e,e}function m(){let e=u(),t=l(),r=t.filter(e=>"unhealthy"===e.status),s=t.filter(e=>"degraded"===e.status),a=[];r.length>0&&a.push(`Critical: ${r.length} services are unhealthy: ${r.map(e=>e.service).join(", ")}`),s.length>0&&a.push(`Warning: ${s.length} services are degraded: ${s.map(e=>e.service).join(", ")}`),e.memoryUsage>500&&a.push("High memory usage detected. Consider optimizing queries or restarting services.");let n=Object.values(e.apiResponseTimes).reduce((e,t)=>e+t,0)/Object.values(e.apiResponseTimes).length;n>2e3&&a.push("High API response times detected. Check database and external service performance."),0===a.length&&a.push("All systems operating normally.");let i=`System Status: ${0===r.length?0===s.length?"Healthy":"Degraded":"Critical"} | Uptime: ${Math.floor(e.uptime/3600)}h ${Math.floor(e.uptime%3600/60)}m | Memory: ${e.memoryUsage.toFixed(1)}MB`;return{summary:i,metrics:e,health:t,recommendations:a}}},41124:(e,t,r)=>{r.r(t),r.d(t,{getPerformanceStats:()=>n,measurePerformance:()=>i,measureQuery:()=>o,performanceMonitor:()=>a});class s{recordMetric(e){this.metrics.push(e),this.metrics.length>this.maxMetrics&&this.metrics.shift()}recordQuery(e){this.queryMetrics.push(e),this.queryMetrics.length>this.maxMetrics&&this.queryMetrics.shift()}getAverageResponseTime(e=5){let t=new Date(Date.now()-6e4*e),r=this.metrics.filter(e=>new Date(e.timestamp)>t);return 0===r.length?0:r.reduce((e,t)=>e+t.responseTime,0)/r.length}getSlowestQueries(e=10){return[...this.queryMetrics].sort((e,t)=>t.duration-e.duration).slice(0,e)}getMetricsSummary(){let e=this.getAverageResponseTime(),t=this.metrics.length>0?this.metrics.reduce((e,t)=>e+t.memoryUsage,0)/this.metrics.length:0,r=this.queryMetrics.filter(e=>e.duration>1e3).length;return{avgResponseTime:e,avgMemoryUsage:t,totalQueries:this.queryMetrics.length,slowQueries:r}}clearOldMetrics(e=24){let t=new Date(Date.now()-36e5*e);this.metrics=this.metrics.filter(e=>new Date(e.timestamp)>t),this.queryMetrics=this.queryMetrics.filter(e=>new Date(e.timestamp)>t)}constructor(){this.metrics=[],this.queryMetrics=[],this.maxMetrics=1e3}}let a=new s;function n(){let e=a.getMetricsSummary();return{totalQueries:e.totalQueries,averageQueryTime:e.avgResponseTime,slowQueries:e.slowQueries}}function i(e,t){return new Promise(async(t,r)=>{let s=Date.now(),n=process.memoryUsage().heapUsed;try{let r=await e(),i=Date.now(),o=process.memoryUsage().heapUsed;a.recordMetric({responseTime:i-s,memoryUsage:(o-n)/1024/1024,timestamp:new Date().toISOString()}),t(r)}catch(e){r(e)}})}function o(e,t){return new Promise(async(r,s)=>{let n=Date.now();try{let s=await e(),i=Date.now()-n;a.recordQuery({query:t.substring(0,100),duration:i,rows:Array.isArray(s)?s.length:1,timestamp:new Date().toISOString()}),r(s)}catch(e){s(e)}})}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[3271,8107],()=>r(55074));module.exports=s})();