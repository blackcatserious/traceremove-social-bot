"use strict";(()=>{var e={};e.id=3868,e.ids=[3868],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7282:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>w,originalPathname:()=>v,patchFetch:()=>S,requestAsyncStorage:()=>y,routeModule:()=>d,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f,staticGenerationBailout:()=>R});var a={};r.r(a),r.d(a,{GET:()=>l,POST:()=>p,dynamic:()=>h,runtime:()=>u});var s=r(10884),n=r(16132),i=r(21040),o=r(95798),c=r(73228),m=r(28977);let u="nodejs",h="force-dynamic";async function l(e){try{let{searchParams:t}=new URL(e.url),r=t.get("action")||"status";switch(r){case"status":let a=await (0,c.I)();return o.Z.json({status:"active",optimization:a,timestamp:new Date().toISOString()});case"optimize":let s=await (0,c.I)();return o.Z.json({message:"Cache optimization completed",result:s,timestamp:new Date().toISOString()});default:return o.Z.json({error:"Invalid action. Use: status, optimize"},{status:400})}}catch(r){console.error("Cache management API error:",r);let{response:e,status:t}=(0,m.$G)(r);return o.Z.json(e,{status:t})}}async function p(e){try{let{action:t,keys:a,metrics:s}=await e.json();switch(t){case"record_metrics":if(s&&Array.isArray(s)){for(let e of s)(0,c.Z)(e.key,e.hit,e.responseTime);return o.Z.json({message:"Metrics recorded successfully"})}return o.Z.json({error:"Invalid metrics data"},{status:400});case"warm_cache":if(a&&Array.isArray(a)){let{cacheOptimizer:e}=await Promise.resolve().then(r.bind(r,73228)),t=await e.warmCache(a);return o.Z.json({message:"Cache warming completed",result:t})}return o.Z.json({error:"Invalid keys data"},{status:400});case"maintenance":let{cacheOptimizer:n}=await Promise.resolve().then(r.bind(r,73228)),i=await n.performMaintenance();return o.Z.json({message:"Cache maintenance completed",result:i});default:return o.Z.json({error:"Invalid action. Use: record_metrics, warm_cache, maintenance"},{status:400})}}catch(r){console.error("Cache management POST error:",r);let{response:e,status:t}=(0,m.$G)(r);return o.Z.json(e,{status:t})}}let d=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/system/cache/management/route",pathname:"/api/system/cache/management",filename:"route",bundlePath:"app/api/system/cache/management/route"},resolvedPagePath:"/workspaces/traceremove-social-bot/src/app/api/system/cache/management/route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:y,staticGenerationAsyncStorage:f,serverHooks:g,headerHooks:w,staticGenerationBailout:R}=d,v="/api/system/cache/management/route";function S(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},73228:(e,t,r)=>{r.d(t,{I:()=>n,Z:()=>i,cacheOptimizer:()=>s});class a{recordCacheAccess(e,t,r){let a=this.patterns.get(e)||{key:e,frequency:0,lastAccess:new Date,hitRate:0,avgResponseTime:0};a.frequency+=1,a.lastAccess=new Date,a.hitRate=t?(a.hitRate*(a.frequency-1)+1)/a.frequency:a.hitRate*(a.frequency-1)/a.frequency,a.avgResponseTime=(a.avgResponseTime*(a.frequency-1)+r)/a.frequency,this.patterns.set(e,a)}async generateRecommendations(){let e=[],t=new Date;for(let[r,a]of this.patterns.entries()){let s=(t.getTime()-a.lastAccess.getTime())/36e5;a.frequency>=this.MIN_FREQUENCY_THRESHOLD&&a.hitRate<this.LOW_HIT_RATE_THRESHOLD&&e.push({type:"warm",key:r,reason:`High frequency (${a.frequency}) but low hit rate (${(100*a.hitRate).toFixed(1)}%)`,priority:"high",estimatedImpact:`Could reduce response time by ${Math.round(.8*a.avgResponseTime)}ms`}),s>24&&a.frequency<2&&e.push({type:"evict",key:r,reason:`Low usage (${a.frequency} accesses) and stale (${Math.round(s)}h old)`,priority:"medium",estimatedImpact:"Free up cache memory for more active data"}),a.avgResponseTime>2e3&&a.frequency>10&&e.push({type:"optimize",key:r,reason:`High response time (${Math.round(a.avgResponseTime)}ms) with frequent access`,priority:"high",estimatedImpact:"Consider query optimization or data structure improvements"})}return e.sort((e,t)=>{let r={high:3,medium:2,low:1};return r[t.priority]-r[e.priority]})}async warmCache(e){let t=0,r=0;for(let a of e)try{if(a.startsWith("search_")){let e=this.parseSearchKey(a);e&&(await this.warmSearchCache(e),t++)}else a.startsWith("query_")&&(await this.warmQueryCache(a),t++)}catch(e){console.error(`Failed to warm cache for key ${a}:`,e),r++}return{success:t,failed:r}}parseSearchKey(e){try{let t=Buffer.from(e.replace("search_",""),"base64").toString(),r=JSON.parse(t);return{query:r.filter?.keywords?.join(" ")||"",persona:r.filter?.visibility||"public"}}catch{return null}}async warmSearchCache(e){console.log(`Warming search cache for query: ${e.query}, persona: ${e.persona}`)}async warmQueryCache(e){console.log(`Warming query cache for ${e}`)}getCacheStats(){let e=Array.from(this.patterns.values());return{totalPatterns:e.length,avgHitRate:e.reduce((e,t)=>e+t.hitRate,0)/e.length||0,avgResponseTime:e.reduce((e,t)=>e+t.avgResponseTime,0)/e.length||0,topPatterns:e.sort((e,t)=>t.frequency-e.frequency).slice(0,10)}}async performMaintenance(){let e=await this.generateRecommendations(),t=e.filter(e=>"evict"===e.type).map(e=>e.key),r=e.filter(e=>"warm"===e.type).map(e=>e.key),a=e.filter(e=>"optimize"===e.type).map(e=>e.key),s=await this.warmCache(r);for(let e of t)this.patterns.delete(e);return{evicted:t.length,warmed:s.success,optimized:a.length}}constructor(){this.patterns=new Map,this.PATTERN_WINDOW=864e5,this.MIN_FREQUENCY_THRESHOLD=5,this.LOW_HIT_RATE_THRESHOLD=.3}}let s=new a;async function n(){let e=await s.generateRecommendations(),t=s.getCacheStats(),r=await s.performMaintenance();return{recommendations:e,stats:t,maintenance:r,timestamp:new Date().toISOString()}}function i(e,t,r){s.recordCacheAccess(e,t,r)}},28977:(e,t,r)=>{r.d(t,{$G:()=>o,JN:()=>c,id:()=>n,p8:()=>s});class a extends Error{constructor(e,t=500,r,a){super(e),this.statusCode=t,this.code=r,this.details=a,this.name="APIError"}}class s extends a{constructor(e,t){super(e,400,"VALIDATION_ERROR",t),this.name="ValidationError"}}class n extends a{constructor(e,t,r){super(`${e} service error: ${t}`,502,"EXTERNAL_SERVICE_ERROR",r),this.name="ExternalServiceError"}}function i(e,t){let r={error:e.message,timestamp:new Date().toISOString()};return t&&(r.requestId=t),e instanceof a&&(r.code=e.code,r.details=e.details),r}function o(e){return(console.error("API Error:",e),e instanceof a)?{response:i(e),status:e.statusCode}:e instanceof Error?{response:i(e),status:500}:{response:{error:"An unexpected error occurred",timestamp:new Date().toISOString()},status:500}}async function c(e,t=3,r=1e3,a=2){let s;for(let n=1;n<=t;n++)try{return await e()}catch(i){if(s=i instanceof Error?i:Error(String(i)),n===t)throw s;let e=r*Math.pow(a,n-1);console.warn(`Attempt ${n} failed, retrying in ${e}ms:`,s.message),await new Promise(t=>setTimeout(t,e))}throw s}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[3271,8107],()=>r(7282));module.exports=a})();