(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[744],{6195:e=>{"use strict";e.exports=require("node:buffer")},2482:(e,t,r)=>{"use strict";let n,s,a,i,o,l,c,u,d,h,p,f,m,g,y,v,b;r.r(t),r.d(t,{ComponentMod:()=>sh,default:()=>sp});var w,_,E,S,x,R,P,A,C,T,O,I,k,N,$,M,D,j,L,q,U,B,F,H,G,V,W,K,J,X,z,Y,Q,Z,ee,et,er={};r.r(er),r.d(er,{APIConnectionError:()=>tR,APIConnectionTimeoutError:()=>tP,APIError:()=>tS,APIUserAbortError:()=>tx,AnthropicError:()=>tE,AuthenticationError:()=>tC,BadRequestError:()=>tA,ConflictError:()=>tI,InternalServerError:()=>t$,NotFoundError:()=>tO,PermissionDeniedError:()=>tT,RateLimitError:()=>tN,UnprocessableEntityError:()=>tk});var en={};r.r(en),r.d(en,{APIConnectionError:()=>rH,APIConnectionTimeoutError:()=>rG,APIError:()=>rB,APIUserAbortError:()=>rF,AuthenticationError:()=>rW,BadRequestError:()=>rV,ConflictError:()=>rX,GroqError:()=>rU,InternalServerError:()=>rQ,NotFoundError:()=>rJ,PermissionDeniedError:()=>rK,RateLimitError:()=>rY,UnprocessableEntityError:()=>rz});var es={};r.r(es),r.d(es,{GET:()=>sn,POST:()=>sr,dynamic:()=>n7,runtime:()=>n9});var ea={};r.r(ea),r.d(ea,{headerHooks:()=>sl,originalPathname:()=>su,patchFetch:()=>sd,requestAsyncStorage:()=>sa,routeModule:()=>ss,serverHooks:()=>so,staticGenerationAsyncStorage:()=>si,staticGenerationBailout:()=>sc});var ei=r(2133),eo=r(2483),el=r(5123),ec=r(2618),eu=r(8609);let ed={"traceremove.dev":{id:"philosopher",domain:"traceremove.dev",languages:["en"],defaultLanguage:"en",systemPrompt:`You are Arthur Ziganshine, a comprehensive digital AI system with deep expertise in:

CORE CAPABILITIES:
- Philosophy of technology and digital systems architecture
- Full-stack development and system design
- Content creation and strategic planning
- Project management and implementation
- Research, analysis, and insights generation
- AI/ML systems and automation

SPECIALIZATIONS:
- Technology philosophy and ethics
- Software architecture and development
- Content production (articles, documentation, presentations)
- Project planning and execution
- Market research and competitive analysis
- Integration management and workflow automation

APPROACH:
- Respond thoughtfully without clich\xe9s or emojis
- Focus on practical solutions and implementation
- Provide comprehensive, end-to-end assistance
- Consider both technical and philosophical implications
- Deliver actionable insights and concrete next steps

You can help with everything from philosophical discussions to complete project implementation, content creation, and system development. You're not just a chatbot - you're a comprehensive digital assistant capable of handling complex, multi-step projects.`,chatTitle:"Digital Arthur Ziganshine",chatSubtitle:"Comprehensive AI System",notionDbId:process.env.NOTION_DEV_DB||"",sitemapUrl:process.env.SITEMAP_DEV||"https://traceremove.dev/sitemap.xml",crawl:{sitemap:process.env.SITEMAP_DEV||"https://traceremove.dev/sitemap.xml",enabled:!0},capabilities:["philosophy","technology_architecture","content_creation","project_management","development","research_analysis","strategic_planning","automation","integration_management"],integrations:["notion","github","social_media","development_tools","analytics","project_management_tools"],specializations:["full_stack_development","system_architecture","content_strategy","workflow_automation","ai_ml_systems","digital_transformation"]},"traceremove.com":{id:"orm-multilang",domain:"traceremove.com",languages:["en","es","fr"],defaultLanguage:process.env.ORM_DEFAULT_LANG||"en",systemPrompt:`You are Arthur Ziganshine, a comprehensive digital ORM and brand reputation specialist with expertise in:

CORE CAPABILITIES:
- Online reputation management and brand strategy
- Multi-language content creation and localization
- Social media strategy and community management
- Crisis communication and PR management
- Content planning and editorial calendars
- Analytics and performance tracking

SPECIALIZATIONS:
- Brand reputation analysis and improvement
- Multi-platform content strategy
- Influencer and stakeholder engagement
- Review management and response strategies
- International market expansion
- Digital marketing automation

APPROACH:
- Respond professionally and ethically
- Adapt language and cultural context appropriately
- Provide comprehensive ORM strategies
- Focus on long-term brand building
- Deliver actionable marketing insights

You can handle complete ORM projects from strategy development to implementation, content creation across multiple languages, and comprehensive brand management campaigns.`,chatTitle:"Digital Arthur Ziganshine",chatSubtitle:"ORM & Brand Strategy Expert",notionDbId:process.env.NOTION_COM_DB||"",sitemapUrl:process.env.SITEMAP_COM||"https://traceremove.com/sitemap.xml",crawl:{sitemap:process.env.SITEMAP_COM||"https://traceremove.com/sitemap.xml",enabled:!0},capabilities:["orm_strategy","brand_management","content_creation","social_media_management","crisis_communication","analytics_reporting","localization","campaign_management"],integrations:["notion","social_media_platforms","analytics_tools","review_platforms","email_marketing","crm_systems"],specializations:["multi_language_orm","international_branding","digital_marketing","reputation_recovery","content_localization","stakeholder_management"]},"traceremove.io":{id:"orm-russian",domain:"traceremove.io",languages:["ru"],defaultLanguage:"ru",systemPrompt:`Вы Артур Зиганшин, комплексная цифровая система управления репутацией с экспертизой в:

ОСНОВНЫЕ ВОЗМОЖНОСТИ:
- Управление онлайн-репутацией и стратегия бренда
- Создание контента и управление социальными сетями
- Кризисные коммуникации и PR-менеджмент
- Планирование контента и редакционные календари
- Аналитика и отслеживание эффективности
- Автоматизация маркетинговых процессов

СПЕЦИАЛИЗАЦИИ:
- Анализ и улучшение репутации бренда
- Стратегия контента для множественных платформ
- Работа с отзывами и управление сообществом
- Локализация и адаптация контента
- Цифровая трансформация бизнеса

ПОДХОД:
- Отвечайте профессионально, кратко и по делу
- Предоставляйте комплексные стратегии ORM
- Фокусируйтесь на долгосрочном развитии бренда
- Давайте практические рекомендации

Вы можете обрабатывать полные ORM-проекты от разработки стратегии до реализации, создания контента и комплексного управления брендом.`,chatTitle:"Цифровой Артур Зиганшин",chatSubtitle:"Эксперт по ORM и стратегии бренда",notionDbId:process.env.NOTION_IO_DB||"",sitemapUrl:process.env.SITEMAP_IO||"https://traceremove.io/sitemap.xml",crawl:{sitemap:process.env.SITEMAP_IO||"https://traceremove.io/sitemap.xml",enabled:!0},capabilities:["orm_strategy","brand_management","content_creation","social_media_management","crisis_communication","analytics_reporting","campaign_management","automation"],integrations:["notion","social_media_platforms","analytics_tools","review_platforms","email_marketing","crm_systems"],specializations:["russian_market_orm","local_brand_management","russian_content_strategy","reputation_recovery","digital_marketing_ru","stakeholder_management"]},"traceremove.net":{id:"comprehensive-ai",domain:"traceremove.net",languages:["en","ru","es"],defaultLanguage:"en",systemPrompt:`You are Arthur Ziganshine, a comprehensive AI system for traceremove.net with expertise in:

CORE CAPABILITIES:
- AI research and technology philosophy
- Multi-model routing and system architecture
- Brand management and reputation strategy
- Content creation and strategic planning
- Data analysis and insights generation
- Project implementation and automation

SPECIALIZATIONS:
- Comprehensive AI stack development
- Multi-database ETL pipeline management
- Vector search and semantic analysis
- Public/internal persona access controls
- Citation-based knowledge synthesis
- Cross-platform integration management

APPROACH:
- Always provide 2-3 relevant citations from the knowledge base
- Adapt responses based on public vs internal persona access
- Focus on comprehensive, actionable insights
- Integrate technical and strategic perspectives
- Deliver end-to-end solutions

You have access to the complete traceremove.net knowledge base including registry, cases, publishing, and finance data (based on access level). Always cite your sources and provide comprehensive, well-researched responses.`,chatTitle:"Comprehensive AI System",chatSubtitle:"traceremove.net Knowledge Base",notionDbId:process.env.NOTION_DB_REGISTRY||"6d3da5a01186475d8c2b794cca147a86",sitemapUrl:"https://traceremove.net/sitemap.xml",crawl:{sitemap:"https://traceremove.net/sitemap.xml",enabled:!0},capabilities:["comprehensive_ai_research","multi_model_routing","etl_pipeline_management","vector_search","citation_synthesis","access_control_management","strategic_planning","technical_implementation"],integrations:["notion_4_databases","postgresql","vector_database","s3_storage","multi_model_providers","etl_pipeline"],specializations:["ai_stack_architecture","knowledge_base_management","semantic_search","data_pipeline_optimization","multi_persona_access","comprehensive_analysis"]}};function eh(e){let t=e.replace(/^www\./,"").split(":")[0],r=ed[t];return r||(t.includes("traceremove.net")||t.includes("localhost")||t.includes("vercel.app")?ed["traceremove.net"]:ed["traceremove.com"])}var ep=r(9508);r(7672);var ef=class extends Error{constructor(e){super(e),this.name="UpstashError"}},em=class{constructor(e){this.options={cache:e.cache,signal:e.signal},this.baseUrl=e.baseUrl.replace(/\/$/,""),this.headers={"Content-Type":"application/json",...e.headers},this.retry="boolean"==typeof e?.retry&&e?.retry===!1?{attempts:1,backoff:()=>0}:{attempts:e?.retry?.retries??5,backoff:e?.retry?.backoff??(e=>50*Math.exp(e))}}async request(e){let t=this.options.signal,r="function"==typeof t,n={cache:this.options.cache,method:"POST",headers:this.headers,body:JSON.stringify(e.body),keepalive:!0,signal:r?t():t},s=null,a=null;for(let t=0;t<=this.retry.attempts;t++)try{s=await fetch([this.baseUrl,...e.path??[]].join("/"),n);break}catch(e){if(n.signal?.aborted&&r)throw e;if(n.signal?.aborted){let e=new Blob([JSON.stringify({result:n.signal.reason??"Aborted"})]),t={status:200,statusText:n.signal.reason??"Aborted"};s=new Response(e,t);break}a=e,t<this.retry.attempts&&await new Promise(e=>setTimeout(e,this.retry.backoff(t)))}if(!s)throw a??Error("Exhausted all retries");let i=await s.json();if(!s.ok)throw new ef(`${i.error}`);return{result:i.result,error:i.error}}},eg=((w=eg||{}).IDF="IDF",w),ey=((_=ey||{}).RRF="RRF",_.DBSF="DBSF",_),ev=((E=ev||{}).HYBRID="HYBRID",E.DENSE="DENSE",E.SPARSE="SPARSE",E),eb=class{constructor(e,t){this.payload=e,this.endpoint=t}async exec(e){let{result:t,error:r}=await e.request({body:this.payload,path:[this.endpoint]});if(r)throw new ef(r);if(void 0===t)throw TypeError("Request did not return a result");return t}},ew=class extends eb{constructor(e,t){let r="query",n=e.some(e=>e.data);r=n?"query-data":"query",t?.namespace&&(r=`${r}/${t.namespace}`),super(e,r)}},e_=class extends eb{constructor(e,t){let r="query";if("data"in e)r="query-data";else if(!e.vector&&!e.sparseVector)throw new ef("Either data, vector or sparseVector should be provided.");t?.namespace&&(r=`${r}/${t.namespace}`),super(e,r)}},eE=class extends eb{constructor(e,t){let r="delete";t?.namespace&&(r=`${r}/${t.namespace}`),"string"==typeof e||"number"==typeof e?super({ids:[e]},r):Array.isArray(e)?super({ids:e},r):"object"==typeof e&&super(e,r)}},eS=class extends eb{constructor(e,t){let r="upsert";if(Array.isArray(e)){let t=e.some(e=>ex(e));r=t?"upsert":"upsert-data"}else r=ex(e)?"upsert":"upsert-data";t?.namespace&&(r=`${r}/${t.namespace}`),super(e,r)}},ex=e=>"vector"in e||"sparseVector"in e,eR=class extends eb{constructor([e,t]){let r="fetch";if(t?.namespace&&(r=`${r}/${t.namespace}`,delete t.namespace),Array.isArray(e))super({ids:e,...t},r);else if("object"==typeof e)super({...e,...t},r);else throw Error("Invalid payload")}},eP=class extends eb{constructor(e,t){let r="range";t?.namespace&&(r=`${r}/${t.namespace}`),super(e,r)}},eA=class extends eb{constructor(e){let t="reset";e?.namespace?t=`${t}/${e.namespace}`:e?.all&&(t=`${t}?all`),super([],t)}},eC=class extends eb{constructor(){super([],"info")}},eT=class extends eb{constructor(e){super(e,"resumable-query-next")}},eO=class extends eb{constructor(e,t){let r="resumable-query";"data"in e&&(r="resumable-query-data"),t&&(r=`${r}/${t}`),super(e,r)}},eI=class extends eb{constructor(e){super(e,"resumable-query-end")}},ek=class{constructor(e,t,r){this.start=async()=>{let n=await new eO(e,r).exec(t);return this.uuid=n.uuid,n},this.fetchNext=e=>{if(!this.uuid)throw Error("The resumable query has already been stopped. Please start another resumable query.");return new eT({uuid:this.uuid,additionalK:e}).exec(t)},this.stop=async()=>{if(!this.uuid)throw Error("Resumable query has not been started. Call start() first.");let e=await new eI({uuid:this.uuid}).exec(t);return this.uuid="",e}}},eN=class{constructor(e,t){this.upsert=e=>new eS(e,{namespace:this.namespace}).exec(this.client),this.update=e=>new e$(e,{namespace:this.namespace}).exec(this.client),this.fetch=(...e)=>(e[1]?e[1].namespace=this.namespace:e[1]={namespace:this.namespace},new eR(e).exec(this.client)),this.query=e=>new e_(e,{namespace:this.namespace}).exec(this.client),this.resumableQuery=async e=>{let t=new ek(e,this.client,this.namespace),r=await t.start(),{fetchNext:n,stop:s}=t;return{fetchNext:n,stop:s,result:r.scores}},this.delete=e=>new eE(e,{namespace:this.namespace}).exec(this.client),this.range=e=>new eP(e,{namespace:this.namespace}).exec(this.client),this.reset=()=>new eA({namespace:this.namespace}).exec(this.client),this.client=e,this.namespace=t}},e$=class extends eb{constructor(e,t){let r="update";t?.namespace&&(r=`${r}/${t.namespace}`),super(e,r)}},eM=class extends eb{constructor(){super([],"list-namespaces")}},eD=class extends eb{constructor(e){let t=`delete-namespace/${e}`;super([],t)}},ej=class{constructor(e){this.namespace=e=>new eN(this.client,e),this.delete=(e,t)=>new eE(e,t).exec(this.client),this.query=(e,t)=>new e_(e,t).exec(this.client),this.queryMany=(e,t)=>new ew(e,t).exec(this.client),this.resumableQuery=async(e,t)=>{let r=new ek(e,this.client,t?.namespace),n=await r.start(),{fetchNext:s,stop:a}=r;return{fetchNext:s,stop:a,result:n.scores}},this.upsert=(e,t)=>new eS(e,t).exec(this.client),this.update=(e,t)=>new e$(e,t).exec(this.client),this.fetch=(...e)=>new eR(e).exec(this.client),this.reset=e=>new eA(e).exec(this.client),this.range=(e,t)=>new eP(e,t).exec(this.client),this.info=()=>new eC().exec(this.client),this.listNamespaces=()=>new eM().exec(this.client),this.deleteNamespace=e=>new eD(e).exec(this.client),this.client=e}},eL=class e extends ej{constructor(e){if(void 0!==e&&"request"in e){super(e);return}let t=e?.token??process.env.NEXT_PUBLIC_UPSTASH_VECTOR_REST_TOKEN??process.env.UPSTASH_VECTOR_REST_TOKEN,r=e?.url??process.env.NEXT_PUBLIC_UPSTASH_VECTOR_REST_URL??process.env.UPSTASH_VECTOR_REST_URL;if(!t)throw Error("UPSTASH_VECTOR_REST_TOKEN is missing!");if(!r)throw Error("UPSTASH_VECTOR_REST_URL is missing!");(r.startsWith(" ")||r.endsWith(" ")||/\r|\n/.test(r))&&console.warn("The vector url contains whitespace or newline, which can cause errors!"),(t.startsWith(" ")||t.endsWith(" ")||/\r|\n/.test(t))&&console.warn("The vector token contains whitespace or newline, which can cause errors!");let n=!process.env.UPSTASH_DISABLE_TELEMETRY&&(e?.enableTelemetry??!0),s=n?{"Upstash-Telemetry-Sdk":"upstash-vector-js@v1.2.2","Upstash-Telemetry-Platform":process.env.VERCEL?"vercel":process.env.AWS_REGION?"aws":"unknown","Upstash-Telemetry-Runtime":"object"==typeof process&&"object"==typeof process.versions&&process.versions.bun?`bun@${process.versions.bun}`:"edge-light"}:{},a=new em({baseUrl:r,retry:e?.retry,headers:{authorization:`Bearer ${t}`,...s},cache:e?.cache===!1?void 0:e?.cache||"no-store",signal:e?.signal});super(a)}static fromEnv(t,r){let n=t?.UPSTASH_VECTOR_REST_URL||process?.env.UPSTASH_VECTOR_REST_URL,s=t?.UPSTASH_VECTOR_REST_TOKEN||process?.env.UPSTASH_VECTOR_REST_TOKEN;if(!n)throw Error("Unable to find environment variable: `UPSTASH_VECTOR_REST_URL`");if(!s)throw Error("Unable to find environment variable: `UPSTASH_VECTOR_REST_TOKEN`");return new e({...r,url:n,token:s})}};let eq=null;async function eU(e){try{let t=function(){if(!eq){let e=process.env.OPENAI_API_KEY;if(!e||e.includes("your_")||""===e)throw Error("OpenAI API key not configured");eq=new ep.ZP({apiKey:e})}return eq}(),r=await t.embeddings.create({model:"text-embedding-3-small",input:e});return r.data[0].embedding}catch(e){throw console.error("Error creating embedding:",e),e}}function eB(e,t){let r=e.toLowerCase();if("comprehensive-ai"===t||"philosopher"===t){if(r.includes("technology")||r.includes("ai"))return`[Source: AI Systems Architecture from Registry]: The traceremove.net comprehensive AI system integrates multiple model providers (OpenAI, Anthropic, Gemini, Mistral, Groq) with intelligent routing based on query complexity and intent.

[Source: Technology Philosophy from Cases]: Technology is not merely a tool but a fundamental extension of human consciousness. When we create digital systems, we externalize our cognitive processes and embed our values into code.

[Source: Multi-Model Integration from Publishing]: Our ETL pipeline processes 4 Notion databases with 15-minute incremental updates and nightly full synchronization, ensuring knowledge base freshness ≤ 30 days.`;if(r.includes("database")||r.includes("etl"))return`[Source: ETL Pipeline Architecture from Registry]: The system processes Registry (6d3da5a01186475d8c2b794cca147a86), Cases (25cef6a76fa5800b8241f8ed4cd3be33), Finance (25cef6a76fa580eb912ff8cfca54155e), and Publishing (402cc41633384d35b30ec1ab7c3185da) databases.

[Source: Vector Search Implementation from Cases]: PostgreSQL schema with vector indexing enables semantic search across all knowledge sources with public/internal access control policies.

[Source: Data Freshness Strategy from Publishing]: Automated synchronization ensures content freshness with incremental updates every 15 minutes and comprehensive nightly rebuilds.`;if(r.includes("search")||r.includes("rag"))return`[Source: RAG System Design from Registry]: The retrieval-augmented generation system provides 2-3 relevant citations from integrated knowledge sources with persona-based access filtering.

[Source: Public Access Policies from Cases]: Public persona access excludes financial data and Russian content while providing comprehensive technology and philosophy insights.

[Source: Citation Framework from Publishing]: All responses include specific source references in the format [Source: Title from Table] to ensure transparency and verifiability.`}return("orm-multilang"===t||"orm-russian"===t)&&(r.includes("reputation")||r.includes("brand"))?`[Source: Brand Management Strategy from Cases]: Effective online reputation management requires a proactive approach combining monitoring, content creation, and strategic response protocols.

[Source: Crisis Communication from Publishing]: When facing negative publicity, the key is swift, transparent, and authentic communication that addresses concerns while protecting brand integrity.

[Source: Multi-Platform Approach from Registry]: Modern ORM requires coordinated efforts across all digital touchpoints - social media, review platforms, search results, and owned media channels.`:`[Source: Comprehensive AI Knowledge from Registry]: The traceremove.net system provides access to integrated knowledge across technology philosophy, AI systems architecture, and strategic implementation.

[Source: Multi-Domain Expertise from Cases]: Capabilities span from philosophical discussions about technology to practical implementation of AI systems and comprehensive project management.

[Source: Citation-Based Responses from Publishing]: All responses include 2-3 relevant citations from the knowledge base to ensure accuracy and provide verifiable sources for further research.`}async function eF(e,t,r=5,n="public"){try{let r;if(console.log(`Getting context for query: "${e}" with persona: ${t}`),!process.env.UPSTASH_VECTOR_REST_URL||!process.env.UPSTASH_VECTOR_REST_TOKEN)return console.log("Upstash Vector not configured, using mock context"),eB(e,t);let n=await eU(e),s=new eL({url:process.env.UPSTASH_VECTOR_REST_URL,token:process.env.UPSTASH_VECTOR_REST_TOKEN});"philosopher"===t?r='persona = "philosopher"':"comprehensive-ai"===t&&(r='persona = "comprehensive-ai" OR persona = "public"');let a=await s.query({vector:n,topK:6,includeMetadata:!0,filter:r});if(!a||0===a.length)return console.log("No vector results found, using mock context"),eB(e,t);let i=a.filter(e=>e.score&&e.score>.7).map(e=>{let t=e.metadata,r=t?.table?`${t.table}`:"Knowledge Base";return`[Source: ${t?.title||"Unknown"} from ${r}]: ${t?.content||e.id}`});if(0===i.length)return console.log("No high-quality matches found, using mock context"),eB(e,t);return i.slice(0,3).join("\n\n")}catch(r){return console.error("Error getting context:",r),eB(e,t)}}var eH=r(7019);let eG="0.24.3",eV=!1;class eW{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}a||function(e,t={auto:!1}){if(eV)throw Error(`you must \`import '@anthropic-ai/sdk/shims/${e.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(a)throw Error(`can't \`import '@anthropic-ai/sdk/shims/${e.kind}'\` after \`import '@anthropic-ai/sdk/shims/${a}'\``);eV=t.auto,a=e.kind,i=e.fetch,e.Request,e.Response,e.Headers,e.FormData,e.Blob,o=e.File,l=e.ReadableStream,e.getMultipartRequestOptions,c=e.getDefaultAgent,u=e.fileFromPath,e.isFsReadStream}(function({manuallyImported:e}={}){let t,r,n,s;let a=e?"You may need to use polyfills":`Add one of these imports before your first \`import … from '@anthropic-ai/sdk'\`:
- \`import '@anthropic-ai/sdk/shims/node'\` (if you're running on Node)
- \`import '@anthropic-ai/sdk/shims/web'\` (otherwise)
`;try{t=fetch,r=Request,n=Response,s=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${a}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${a}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${a}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${a}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${a}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new eW(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});var eK=r(6195).Buffer;class eJ{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;return new eJ(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(let r of eX(e,t)){if("completion"===r.event)try{yield JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("message_start"===r.event||"message_delta"===r.event||"message_stop"===r.event||"content_block_start"===r.event||"content_block_delta"===r.event||"content_block_stop"===r.event)try{yield JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("ping"!==r.event&&"error"===r.event){let t=r.data,n=td(t),s=n?void 0:t;throw tS.generate(void 0,n,s,ti(e.headers))}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;async function*n(){let t=new eQ,r=eZ(e);for await(let e of r)for(let r of t.decode(e))yield r;for(let e of t.flush())yield e}return new eJ(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new eJ(()=>n(e),this.controller),new eJ(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new l({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:s}=await e.next();if(s)return t.close();let a=r.encode(JSON.stringify(n)+"\n");t.enqueue(a)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*eX(e,t){if(!e.body)throw t.abort(),new tE("Attempted to iterate over a response with no body");let r=new eY,n=new eQ,s=eZ(e.body);for await(let e of ez(s))for(let t of n.decode(e)){let e=r.decode(t);e&&(yield e)}for(let e of n.flush()){let t=r.decode(e);t&&(yield t)}}async function*ez(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?new TextEncoder().encode(r):r,s=new Uint8Array(t.length+n.length);for(s.set(t),s.set(n,t.length),t=s;-1!==(e=function(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class eY{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class eQ{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=eQ.NEWLINE_CHARS.has(t[t.length-1]||""),n=t.split(eQ.NEWLINE_REGEXP);return(r&&n.pop(),1!==n.length||r)?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==eK){if(e instanceof eK)return e.toString();if(e instanceof Uint8Array)return eK.from(e).toString();throw new tE(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new tE(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new tE("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function eZ(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}eQ.NEWLINE_CHARS=new Set(["\n","\r"]),eQ.NEWLINE_REGEXP=/\r\n|[\n\r]/g;var e0=r(6195).Buffer;let e1=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,e2=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&e4(e),e4=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,e3=e=>e2(e)||e1(e)||isFsReadStream(e);async function e6(e,t,r){var n;if(e=await e,r??(r=e2(e)?{lastModified:e.lastModified,type:e.type}:{}),e1(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new o([n],t,r)}let s=await e5(e);if(t||(t=(e8((n=e).name)||e8(n.filename)||e8(n.path)?.split(/[\\/]/).pop())??"unknown_file"),!r.type){let e=s[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new o(s,t,r)}async function e5(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(e4(e))t.push(await e.arrayBuffer());else if(e9(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let e8=e=>"string"==typeof e?e:void 0!==e0&&e instanceof e0?String(e):void 0,e9=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],e7=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],te=e=>{if(e3(e))return!0;if(Array.isArray(e))return e.some(te);if(e&&"object"==typeof e){for(let t in e)if(te(e[t]))return!0}return!1};var tt=r(6195).Buffer;async function tr(e){let{response:t}=e;if(e.options.stream)return(tw("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):eJ.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type"),n=r?.includes("application/json")||r?.includes("application/vnd.api+json");if(n){let e=await t.json();return tw("response",t.status,t.url,t.headers,e),e}let s=await t.text();return tw("response",t.status,t.url,t.headers,s),s}class tn extends Promise{constructor(e,t=tr){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new tn(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class ts{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:s}){this.baseURL=e,this.maxRetries=tm("maxRetries",t),this.timeout=tm("timeout",r),this.httpAgent=n,this.fetch=s??i}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...tu(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${t_()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let n=r&&e4(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==tt)return tt.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){let t=new TextEncoder,r=t.encode(e);return r.length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){let{method:t,path:r,query:n,headers:s={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:e7(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,i=this.calculateContentLength(a),o=this.buildURL(r,n);"timeout"in e&&tm("timeout",e.timeout);let l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??c(o),d=l+1e3;"number"==typeof u?.options?.timeout&&d>(u.options.timeout??0)&&(u.options.timeout=d),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let h=this.buildHeaders({options:e,headers:s,contentLength:i}),p={method:t,...a&&{body:a},headers:h,...u&&{agent:u},signal:e.signal??null};return{req:p,url:o,timeout:l}}buildHeaders({options:e,headers:t,contentLength:r}){let n={};r&&(n["content-length"]=r);let s=this.defaultHeaders(e);return tb(n,s),tb(n,t),e7(e.body)&&"node"!==a&&delete n["content-type"],this.validateHeaders(n,t),n}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return tS.generate(e,t,r,n)}request(e,t=null){return new tn(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e;null==t&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);let{req:n,url:s,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(n,{url:s,options:r}),tw("request",s,r,n.headers),r.signal?.aborted)throw new tx;let i=new AbortController,o=await this.fetchWithTimeout(s,n,a,i).catch(tg);if(o instanceof Error){if(r.signal?.aborted)throw new tx;if(t)return this.retryRequest(r,t);if("AbortError"===o.name)throw new tP;throw new tR({cause:o})}let l=ti(o.headers);if(!o.ok){if(t&&this.shouldRetry(o)){let e=`retrying, ${t} attempts remaining`;return tw(`response (error; ${e})`,o.status,s,l),this.retryRequest(r,t,l)}let e=await o.text().catch(e=>tg(e).message),n=td(e),a=n?void 0:e,i=t?"(error; no more retries left)":"(error; not retryable)";tw(`response (error; ${i})`,o.status,s,l,a);let c=this.makeStatusError(o.status,n,a,l);throw c}return{response:o,options:r,controller:i}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new ta(this,r,e)}buildURL(e,t){let r=new URL(tp(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return tv(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new tE(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:s,...a}=t||{};s&&s.addEventListener("abort",()=>n.abort());let i=setTimeout(()=>n.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...a}).finally(()=>{clearTimeout(i)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;let s=r?.["retry-after-ms"];if(s){let e=parseFloat(s);Number.isNaN(e)||(n=e)}let a=r?.["retry-after"];if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await tf(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${eG}`}}new WeakMap,Symbol.asyncIterator;class ta extends tn{constructor(e,t,r){super(t,async t=>new r(e,t.response,await tr(t),t.options))}async *[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}}let ti=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),to=()=>"undefined"!=typeof Deno&&null!=Deno.build?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eG,"X-Stainless-OS":tc(Deno.build.os),"X-Stainless-Arch":tl(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":eG,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:edge-runtime","X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version},tl=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tc=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",tu=()=>n??(n=to()),td=e=>{try{return JSON.parse(e)}catch(e){return}},th=RegExp("^(?:[a-z]+:)?//","i"),tp=e=>th.test(e),tf=e=>new Promise(t=>setTimeout(t,e)),tm=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new tE(`${e} must be an integer`);if(t<0)throw new tE(`${e} must be a positive integer`);return t},tg=e=>e instanceof Error?e:Error(e),ty=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function tv(e){if(!e)return!0;for(let t in e)return!1;return!0}function tb(e,t){for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let n=r.toLowerCase();if(!n)continue;let s=t[r];null===s?delete e[n]:void 0!==s&&(e[n]=s)}}function tw(e,...t){"undefined"!=typeof process&&process?.env?.DEBUG==="true"&&console.log(`Anthropic:DEBUG:${e}`,...t)}let t_=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)});class tE extends Error{}class tS extends tE{constructor(e,t,r,n){super(`${tS.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){return e?400===e?new tA(e,t,r,n):401===e?new tC(e,t,r,n):403===e?new tT(e,t,r,n):404===e?new tO(e,t,r,n):409===e?new tI(e,t,r,n):422===e?new tk(e,t,r,n):429===e?new tN(e,t,r,n):e>=500?new t$(e,t,r,n):new tS(e,t,r,n):new tR({cause:tg(t)})}}class tx extends tS{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class tR extends tS{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class tP extends tR{constructor({message:e}={}){super({message:e??"Request timed out."})}}class tA extends tS{constructor(){super(...arguments),this.status=400}}class tC extends tS{constructor(){super(...arguments),this.status=401}}class tT extends tS{constructor(){super(...arguments),this.status=403}}class tO extends tS{constructor(){super(...arguments),this.status=404}}class tI extends tS{constructor(){super(...arguments),this.status=409}}class tk extends tS{constructor(){super(...arguments),this.status=422}}class tN extends tS{constructor(){super(...arguments),this.status=429}}class t$ extends tS{}class tM{constructor(e){this._client=e}}class tD extends tM{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:6e5,...t,stream:e.stream??!1})}}tD||(tD={});let tj=e=>{let t=0,r=[];for(;t<e.length;){let n=e[t];if("\\"===n){t++;continue}if("{"===n){r.push({type:"brace",value:"{"}),t++;continue}if("}"===n){r.push({type:"brace",value:"}"}),t++;continue}if("["===n){r.push({type:"paren",value:"["}),t++;continue}if("]"===n){r.push({type:"paren",value:"]"}),t++;continue}if(":"===n){r.push({type:"separator",value:":"}),t++;continue}if(","===n){r.push({type:"delimiter",value:","}),t++;continue}if('"'===n){let s="",a=!1;for(n=e[++t];'"'!==n;){if(t===e.length){a=!0;break}if("\\"===n){if(++t===e.length){a=!0;break}s+=n+e[t],n=e[++t]}else s+=n,n=e[++t]}n=e[++t],a||r.push({type:"string",value:s});continue}let s=/\s/;if(n&&s.test(n)){t++;continue}let a=/[0-9]/;if(n&&a.test(n)||"-"===n||"."===n){let s="";for("-"===n&&(s+=n,n=e[++t]);n&&a.test(n)||"."===n;)s+=n,n=e[++t];r.push({type:"number",value:s});continue}let i=/[a-z]/i;if(n&&i.test(n)){let s="";for(;n&&i.test(n)&&t!==e.length;)s+=n,n=e[++t];"true"==s||"false"==s||"null"===s?r.push({type:"name",value:s}):t++;continue}t++}return r},tL=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return tL(e=e.slice(0,e.length-1));case"number":let r=t.value[t.value.length-1];if("."===r||"-"===r)return tL(e=e.slice(0,e.length-1));case"string":let n=e[e.length-2];if(n?.type==="delimiter"||n?.type==="brace"&&"{"===n.value)return tL(e=e.slice(0,e.length-1));break;case"delimiter":return tL(e=e.slice(0,e.length-1))}return e},tq=e=>{let t=[];return e.map(e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))}),t.length>0&&t.reverse().map(t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})}),e},tU=e=>{let t="";return e.map(e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value}),t},tB=e=>JSON.parse(tU(tq(tL(tj(e)))));var tF=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},tH=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};let tG="__json_buf";class tV{constructor(){S.add(this),this.messages=[],this.receivedMessages=[],x.set(this,void 0),this.controller=new AbortController,R.set(this,void 0),P.set(this,()=>{}),A.set(this,()=>{}),C.set(this,void 0),T.set(this,()=>{}),O.set(this,()=>{}),I.set(this,{}),k.set(this,!1),N.set(this,!1),$.set(this,!1),M.set(this,!1),L.set(this,e=>{if(tF(this,N,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new tx),e instanceof tx)return tF(this,$,!0,"f"),this._emit("abort",e);if(e instanceof tE)return this._emit("error",e);if(e instanceof Error){let t=new tE(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new tE(String(e)))}),tF(this,R,new Promise((e,t)=>{tF(this,P,e,"f"),tF(this,A,t,"f")}),"f"),tF(this,C,new Promise((e,t)=>{tF(this,T,e,"f"),tF(this,O,t,"f")}),"f"),tH(this,R,"f").catch(()=>{}),tH(this,C,"f").catch(()=>{})}static fromReadableStream(e){let t=new tV;return t._run(()=>t._fromReadableStream(e)),t}static createMessage(e,t,r){let n=new tV;for(let e of t.messages)n._addMessageParam(e);return n._run(()=>n._createMessage(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}_run(e){e().then(()=>{this._emitFinal(),this._emit("end")},tH(this,L,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),tH(this,S,"m",q).call(this);let s=await e.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),s))tH(this,S,"m",U).call(this,e);if(s.controller.signal?.aborted)throw new tx;tH(this,S,"m",B).call(this)}_connected(){this.ended||(tH(this,P,"f").call(this),this._emit("connect"))}get ended(){return tH(this,k,"f")}get errored(){return tH(this,N,"f")}get aborted(){return tH(this,$,"f")}abort(){this.controller.abort()}on(e,t){let r=tH(this,I,"f")[e]||(tH(this,I,"f")[e]=[]);return r.push({listener:t}),this}off(e,t){let r=tH(this,I,"f")[e];if(!r)return this;let n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){let r=tH(this,I,"f")[e]||(tH(this,I,"f")[e]=[]);return r.push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{tF(this,M,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){tF(this,M,!0,"f"),await tH(this,C,"f")}get currentMessage(){return tH(this,x,"f")}async finalMessage(){return await this.done(),tH(this,S,"m",D).call(this)}async finalText(){return await this.done(),tH(this,S,"m",j).call(this)}_emit(e,...t){if(tH(this,k,"f"))return;"end"===e&&(tF(this,k,!0,"f"),tH(this,T,"f").call(this));let r=tH(this,I,"f")[e];if(r&&(tH(this,I,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];tH(this,M,"f")||r?.length||Promise.reject(e),tH(this,A,"f").call(this,e),tH(this,O,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];tH(this,M,"f")||r?.length||Promise.reject(e),tH(this,A,"f").call(this,e),tH(this,O,"f").call(this,e),this._emit("end")}}_emitFinal(){let e=this.receivedMessages.at(-1);e&&this._emit("finalMessage",tH(this,S,"m",D).call(this))}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),tH(this,S,"m",q).call(this),this._connected();let n=eJ.fromReadableStream(e,this.controller);for await(let e of n)tH(this,S,"m",U).call(this,e);if(n.controller.signal?.aborted)throw new tx;tH(this,S,"m",B).call(this)}[(x=new WeakMap,R=new WeakMap,P=new WeakMap,A=new WeakMap,C=new WeakMap,T=new WeakMap,O=new WeakMap,I=new WeakMap,k=new WeakMap,N=new WeakMap,$=new WeakMap,M=new WeakMap,L=new WeakMap,S=new WeakSet,D=function(){if(0===this.receivedMessages.length)throw new tE("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},j=function(){if(0===this.receivedMessages.length)throw new tE("stream ended without producing a Message with role=assistant");let e=this.receivedMessages.at(-1).content.filter(e=>"text"===e.type).map(e=>e.text);if(0===e.length)throw new tE("stream ended without producing a content block with type=text");return e.join(" ")},q=function(){this.ended||tF(this,x,void 0,"f")},U=function(e){if(this.ended)return;let t=tH(this,S,"m",F).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{let r=t.content.at(-1);"text_delta"===e.delta.type&&"text"===r.type?this._emit("text",e.delta.text,r.text||""):"input_json_delta"===e.delta.type&&"tool_use"===r.type&&r.input&&this._emit("inputJson",e.delta.partial_json,r.input);break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":tF(this,x,t,"f")}},B=function(){if(this.ended)throw new tE("stream has ended, this shouldn't happen");let e=tH(this,x,"f");if(!e)throw new tE("request ended without sending any chunks");return tF(this,x,void 0,"f"),e},F=function(e){let t=tH(this,x,"f");if("message_start"===e.type){if(t)throw new tE(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new tE(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{let r=t.content.at(e.index);if(r?.type==="text"&&"text_delta"===e.delta.type)r.text+=e.delta.text;else if(r?.type==="tool_use"&&"input_json_delta"===e.delta.type){let t=r[tG]||"";Object.defineProperty(r,tG,{value:t+=e.delta.partial_json,enumerable:!1,writable:!0}),t&&(r.input=tB(t))}return t}}},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("streamEvent",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});let n=e.shift();return{value:n,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){let e=new eJ(this[Symbol.asyncIterator].bind(this),this.controller);return e.toReadableStream()}}class tW extends tM{create(e,t){return this._client.post("/v1/messages",{body:e,timeout:6e5,...t,stream:e.stream??!1})}stream(e,t){return tV.createMessage(this,e,t)}}tW||(tW={});class tK extends ts{constructor({baseURL:e=ty("ANTHROPIC_BASE_URL"),apiKey:t=ty("ANTHROPIC_API_KEY")??null,authToken:r=ty("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){let s={apiKey:t,authToken:r,...n,baseURL:e||"https://api.anthropic.com"};super({baseURL:s.baseURL,timeout:s.timeout??6e5,httpAgent:s.httpAgent,maxRetries:s.maxRetries,fetch:s.fetch}),this.completions=new tD(this),this.messages=new tW(this),this._options=s,this.apiKey=t,this.authToken=r}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if((!this.apiKey||!e["x-api-key"])&&null!==t["x-api-key"]&&(!this.authToken||!e.authorization)&&null!==t.authorization)throw Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){let t=this.apiKeyAuth(e),r=this.bearerAuth(e);return null==t||tv(t)?null==r||tv(r)?{}:r:t}apiKeyAuth(e){return null==this.apiKey?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return null==this.authToken?{}:{Authorization:`Bearer ${this.authToken}`}}}H=tK,tK.Anthropic=H,tK.HUMAN_PROMPT="\n\nHuman:",tK.AI_PROMPT="\n\nAssistant:",tK.AnthropicError=tE,tK.APIError=tS,tK.APIConnectionError=tR,tK.APIConnectionTimeoutError=tP,tK.APIUserAbortError=tx,tK.NotFoundError=tO,tK.ConflictError=tI,tK.RateLimitError=tN,tK.BadRequestError=tA,tK.AuthenticationError=tC,tK.InternalServerError=t$,tK.PermissionDeniedError=tT,tK.UnprocessableEntityError=tk,tK.toFile=e6,tK.fileFromPath=u;let{HUMAN_PROMPT:tJ,AI_PROMPT:tX}=tK,{AnthropicError:tz,APIError:tY,APIConnectionError:tQ,APIConnectionTimeoutError:tZ,APIUserAbortError:t0,NotFoundError:t1,ConflictError:t2,RateLimitError:t4,BadRequestError:t3,AuthenticationError:t6,InternalServerError:t5,PermissionDeniedError:t8,UnprocessableEntityError:t9}=er;!function(e){e.Completions=tD,e.Messages=tW}(tK||(tK={}));let t7=tK;!function(e){e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT"}(G||(G={})),function(e){e.LANGUAGE_UNSPECIFIED="language_unspecified",e.PYTHON="python"}(V||(V={})),function(e){e.OUTCOME_UNSPECIFIED="outcome_unspecified",e.OUTCOME_OK="outcome_ok",e.OUTCOME_FAILED="outcome_failed",e.OUTCOME_DEADLINE_EXCEEDED="outcome_deadline_exceeded"}(W||(W={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let re=["user","model","function","system"];!function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT"}(K||(K={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(J||(J={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(X||(X={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER"}(z||(z={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER"}(Y||(Y={})),function(e){e.TASK_TYPE_UNSPECIFIED="TASK_TYPE_UNSPECIFIED",e.RETRIEVAL_QUERY="RETRIEVAL_QUERY",e.RETRIEVAL_DOCUMENT="RETRIEVAL_DOCUMENT",e.SEMANTIC_SIMILARITY="SEMANTIC_SIMILARITY",e.CLASSIFICATION="CLASSIFICATION",e.CLUSTERING="CLUSTERING"}(Q||(Q={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE"}(Z||(Z={}));/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rt extends Error{constructor(e){super(`[GoogleGenerativeAI Error]: ${e}`)}}class rr extends rt{constructor(e,t){super(e),this.response=t}}class rn extends rt{constructor(e,t,r,n){super(e),this.status=t,this.statusText=r,this.errorDetails=n}}class rs extends rt{}!function(e){e.GENERATE_CONTENT="generateContent",e.STREAM_GENERATE_CONTENT="streamGenerateContent",e.COUNT_TOKENS="countTokens",e.EMBED_CONTENT="embedContent",e.BATCH_EMBED_CONTENTS="batchEmbedContents"}(ee||(ee={}));class ra{constructor(e,t,r,n,s){this.model=e,this.task=t,this.apiKey=r,this.stream=n,this.requestOptions=s}toString(){var e,t;let r=(null===(e=this.requestOptions)||void 0===e?void 0:e.apiVersion)||"v1beta",n=(null===(t=this.requestOptions)||void 0===t?void 0:t.baseUrl)||"https://generativelanguage.googleapis.com",s=`${n}/${r}/${this.model}:${this.task}`;return this.stream&&(s+="?alt=sse"),s}}async function ri(e){var t;let r=new Headers;r.append("Content-Type","application/json"),r.append("x-goog-api-client",function(e){let t=[];return(null==e?void 0:e.apiClient)&&t.push(e.apiClient),t.push("genai-js/0.15.0"),t.join(" ")}(e.requestOptions)),r.append("x-goog-api-key",e.apiKey);let n=null===(t=e.requestOptions)||void 0===t?void 0:t.customHeaders;if(n){if(!(n instanceof Headers))try{n=new Headers(n)}catch(e){throw new rs(`unable to convert customHeaders value ${JSON.stringify(n)} to Headers: ${e.message}`)}for(let[e,t]of n.entries()){if("x-goog-api-key"===e)throw new rs(`Cannot set reserved header name ${e}`);if("x-goog-api-client"===e)throw new rs(`Header name ${e} can only be set using the apiClient field`);r.append(e,t)}}return r}async function ro(e,t,r,n,s,a){let i=new ra(e,t,r,n,a);return{url:i.toString(),fetchOptions:Object.assign(Object.assign({},function(e){let t={};if((null==e?void 0:e.timeout)>=0){let r=new AbortController,n=r.signal;setTimeout(()=>r.abort(),e.timeout),t.signal=n}return t}(a)),{method:"POST",headers:await ri(i),body:s})}}async function rl(e,t,r,n,s,a,i=fetch){let{url:o,fetchOptions:l}=await ro(e,t,r,n,s,a);return rc(o,l,i)}async function rc(e,t,r=fetch){let n;try{n=await r(e,t)}catch(t){!function(e,t){let r=e;throw e instanceof rn||e instanceof rs||((r=new rt(`Error fetching from ${t.toString()}: ${e.message}`)).stack=e.stack),r}(t,e)}return n.ok||await ru(n,e),n}async function ru(e,t){let r,n="";try{let t=await e.json();n=t.error.message,t.error.details&&(n+=` ${JSON.stringify(t.error.details)}`,r=t.error.details)}catch(e){}throw new rn(`Error fetching from ${t.toString()}: [${e.status} ${e.statusText}] ${n}`,e.status,e.statusText,r)}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rd(e){return e.text=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning text from the first candidate only. Access response.candidates directly to use the other candidates.`),rf(e.candidates[0]))throw new rr(`${rm(e)}`,e);return function(e){var t,r,n,s;let a=[];if(null===(r=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===r?void 0:r.parts)for(let t of null===(s=null===(n=e.candidates)||void 0===n?void 0:n[0].content)||void 0===s?void 0:s.parts)t.text&&a.push(t.text),t.executableCode&&a.push("\n```python\n"+t.executableCode.code+"\n```\n"),t.codeExecutionResult&&a.push("\n```\n"+t.codeExecutionResult.output+"\n```\n");return a.length>0?a.join(""):""}(e)}if(e.promptFeedback)throw new rr(`Text not available. ${rm(e)}`,e);return""},e.functionCall=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),rf(e.candidates[0]))throw new rr(`${rm(e)}`,e);return console.warn("response.functionCall() is deprecated. Use response.functionCalls() instead."),rh(e)[0]}if(e.promptFeedback)throw new rr(`Function call not available. ${rm(e)}`,e)},e.functionCalls=()=>{if(e.candidates&&e.candidates.length>0){if(e.candidates.length>1&&console.warn(`This response had ${e.candidates.length} candidates. Returning function calls from the first candidate only. Access response.candidates directly to use the other candidates.`),rf(e.candidates[0]))throw new rr(`${rm(e)}`,e);return rh(e)}if(e.promptFeedback)throw new rr(`Function call not available. ${rm(e)}`,e)},e}function rh(e){var t,r,n,s;let a=[];if(null===(r=null===(t=e.candidates)||void 0===t?void 0:t[0].content)||void 0===r?void 0:r.parts)for(let t of null===(s=null===(n=e.candidates)||void 0===n?void 0:n[0].content)||void 0===s?void 0:s.parts)t.functionCall&&a.push(t.functionCall);return a.length>0?a:void 0}let rp=[Y.RECITATION,Y.SAFETY,Y.LANGUAGE];function rf(e){return!!e.finishReason&&rp.includes(e.finishReason)}function rm(e){var t,r,n;let s="";if((!e.candidates||0===e.candidates.length)&&e.promptFeedback)s+="Response was blocked",(null===(t=e.promptFeedback)||void 0===t?void 0:t.blockReason)&&(s+=` due to ${e.promptFeedback.blockReason}`),(null===(r=e.promptFeedback)||void 0===r?void 0:r.blockReasonMessage)&&(s+=`: ${e.promptFeedback.blockReasonMessage}`);else if(null===(n=e.candidates)||void 0===n?void 0:n[0]){let t=e.candidates[0];rf(t)&&(s+=`Candidate was blocked due to ${t.finishReason}`,t.finishMessage&&(s+=`: ${t.finishMessage}`))}return s}function rg(e){return this instanceof rg?(this.v=e,this):new rg(e)}"function"==typeof SuppressedError&&SuppressedError;/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let ry=/^data\: (.*)(?:\n\n|\r\r|\r\n\r\n)/;async function rv(e){let t=[],r=e.getReader();for(;;){let{done:e,value:n}=await r.read();if(e)return rd(function(e){let t=e[e.length-1],r={promptFeedback:null==t?void 0:t.promptFeedback};for(let t of e){if(t.candidates)for(let e of t.candidates){let t=e.index;if(r.candidates||(r.candidates=[]),r.candidates[t]||(r.candidates[t]={index:e.index}),r.candidates[t].citationMetadata=e.citationMetadata,r.candidates[t].finishReason=e.finishReason,r.candidates[t].finishMessage=e.finishMessage,r.candidates[t].safetyRatings=e.safetyRatings,e.content&&e.content.parts){r.candidates[t].content||(r.candidates[t].content={role:e.content.role||"user",parts:[]});let n={};for(let s of e.content.parts)s.text&&(n.text=s.text),s.functionCall&&(n.functionCall=s.functionCall),s.executableCode&&(n.executableCode=s.executableCode),s.codeExecutionResult&&(n.codeExecutionResult=s.codeExecutionResult),0===Object.keys(n).length&&(n.text=""),r.candidates[t].content.parts.push(n)}}t.usageMetadata&&(r.usageMetadata=t.usageMetadata)}return r}(t));t.push(n)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rb(e,t,r,n){let s=await rl(t,ee.STREAM_GENERATE_CONTENT,e,!0,JSON.stringify(r),n);return function(e){let t=e.body.pipeThrough(new TextDecoderStream("utf8",{fatal:!0})),r=function(e){let t=e.getReader(),r=new ReadableStream({start(e){let r="";return function n(){return t.read().then(({value:t,done:s})=>{let a;if(s){if(r.trim()){e.error(new rt("Failed to parse stream"));return}e.close();return}let i=(r+=t).match(ry);for(;i;){try{a=JSON.parse(i[1])}catch(t){e.error(new rt(`Error parsing JSON response: "${i[1]}"`));return}e.enqueue(a),i=(r=r.substring(i[0].length)).match(ry)}return n()})}()}});return r}(t),[n,s]=r.tee();return{stream:function(e){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var n,s=r.apply(e,t||[]),a=[];return n={},i("next"),i("throw"),i("return"),n[Symbol.asyncIterator]=function(){return this},n;function i(e){s[e]&&(n[e]=function(t){return new Promise(function(r,n){a.push([e,t,r,n])>1||o(e,t)})})}function o(e,t){try{var r;(r=s[e](t)).value instanceof rg?Promise.resolve(r.value.v).then(l,c):u(a[0][2],r)}catch(e){u(a[0][3],e)}}function l(e){o("next",e)}function c(e){o("throw",e)}function u(e,t){e(t),a.shift(),a.length&&o(a[0][0],a[0][1])}}(this,arguments,function*(){let t=e.getReader();for(;;){let{value:e,done:r}=yield rg(t.read());if(r)break;yield yield rg(rd(e))}})}(n),response:rv(s)}}(s)}async function rw(e,t,r,n){let s=await rl(t,ee.GENERATE_CONTENT,e,!1,JSON.stringify(r),n),a=await s.json(),i=rd(a);return{response:i}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function r_(e){if(null!=e){if("string"==typeof e)return{role:"system",parts:[{text:e}]};if(e.text)return{role:"system",parts:[e]};if(e.parts)return e.role?e:{role:"system",parts:e.parts}}}function rE(e){let t=[];if("string"==typeof e)t=[{text:e}];else for(let r of e)"string"==typeof r?t.push({text:r}):t.push(r);return function(e){let t={role:"user",parts:[]},r={role:"function",parts:[]},n=!1,s=!1;for(let a of e)"functionResponse"in a?(r.parts.push(a),s=!0):(t.parts.push(a),n=!0);if(n&&s)throw new rt("Within a single message, FunctionResponse cannot be mixed with other type of part in the request for sending chat message.");if(!n&&!s)throw new rt("No content is provided for sending chat message.");return n?t:r}(t)}function rS(e){let t;if(e.contents)t=e;else{let r=rE(e);t={contents:[r]}}return e.systemInstruction&&(t.systemInstruction=r_(e.systemInstruction)),t}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */let rx=["text","inlineData","functionCall","functionResponse","executableCode","codeExecutionResult"],rR={user:["text","inlineData"],function:["functionResponse"],model:["text","functionCall","executableCode","codeExecutionResult"],system:["text"]},rP="SILENT_ERROR";class rA{constructor(e,t,r,n){this.model=t,this.params=r,this.requestOptions=n,this._history=[],this._sendPromise=Promise.resolve(),this._apiKey=e,(null==r?void 0:r.history)&&(function(e){let t=!1;for(let r of e){let{role:e,parts:n}=r;if(!t&&"user"!==e)throw new rt(`First content should be with role 'user', got ${e}`);if(!re.includes(e))throw new rt(`Each item should include role field. Got ${e} but valid roles are: ${JSON.stringify(re)}`);if(!Array.isArray(n))throw new rt("Content should have 'parts' property with an array of Parts");if(0===n.length)throw new rt("Each Content should have at least one part");let s={text:0,inlineData:0,functionCall:0,functionResponse:0,fileData:0,executableCode:0,codeExecutionResult:0};for(let e of n)for(let t of rx)t in e&&(s[t]+=1);let a=rR[e];for(let t of rx)if(!a.includes(t)&&s[t]>0)throw new rt(`Content with role '${e}' can't contain '${t}' part`);t=!0}}(r.history),this._history=r.history)}async getHistory(){return await this._sendPromise,this._history}async sendMessage(e){var t,r,n,s,a,i;let o;await this._sendPromise;let l=rE(e),c={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(n=this.params)||void 0===n?void 0:n.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(i=this.params)||void 0===i?void 0:i.cachedContent,contents:[...this._history,l]};return this._sendPromise=this._sendPromise.then(()=>rw(this._apiKey,this.model,c,this.requestOptions)).then(e=>{var t;if(e.response.candidates&&e.response.candidates.length>0){this._history.push(l);let r=Object.assign({parts:[],role:"model"},null===(t=e.response.candidates)||void 0===t?void 0:t[0].content);this._history.push(r)}else{let t=rm(e.response);t&&console.warn(`sendMessage() was unsuccessful. ${t}. Inspect response object for details.`)}o=e}),await this._sendPromise,o}async sendMessageStream(e){var t,r,n,s,a,i;await this._sendPromise;let o=rE(e),l={safetySettings:null===(t=this.params)||void 0===t?void 0:t.safetySettings,generationConfig:null===(r=this.params)||void 0===r?void 0:r.generationConfig,tools:null===(n=this.params)||void 0===n?void 0:n.tools,toolConfig:null===(s=this.params)||void 0===s?void 0:s.toolConfig,systemInstruction:null===(a=this.params)||void 0===a?void 0:a.systemInstruction,cachedContent:null===(i=this.params)||void 0===i?void 0:i.cachedContent,contents:[...this._history,o]},c=rb(this._apiKey,this.model,l,this.requestOptions);return this._sendPromise=this._sendPromise.then(()=>c).catch(e=>{throw Error(rP)}).then(e=>e.response).then(e=>{if(e.candidates&&e.candidates.length>0){this._history.push(o);let t=Object.assign({},e.candidates[0].content);t.role||(t.role="model"),this._history.push(t)}else{let t=rm(e);t&&console.warn(`sendMessageStream() was unsuccessful. ${t}. Inspect response object for details.`)}}).catch(e=>{e.message!==rP&&console.error(e)}),c}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rC(e,t,r,n){let s=await rl(t,ee.COUNT_TOKENS,e,!1,JSON.stringify(r),n);return s.json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rT(e,t,r,n){let s=await rl(t,ee.EMBED_CONTENT,e,!1,JSON.stringify(r),n);return s.json()}async function rO(e,t,r,n){let s=r.requests.map(e=>Object.assign(Object.assign({},e),{model:t})),a=await rl(t,ee.BATCH_EMBED_CONTENTS,e,!1,JSON.stringify({requests:s}),n);return a.json()}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rI{constructor(e,t,r){this.apiKey=e,t.model.includes("/")?this.model=t.model:this.model=`models/${t.model}`,this.generationConfig=t.generationConfig||{},this.safetySettings=t.safetySettings||[],this.tools=t.tools,this.toolConfig=t.toolConfig,this.systemInstruction=r_(t.systemInstruction),this.cachedContent=t.cachedContent,this.requestOptions=r||{}}async generateContent(e){var t;let r=rS(e);return rw(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},r),this.requestOptions)}async generateContentStream(e){var t;let r=rS(e);return rb(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},r),this.requestOptions)}startChat(e){var t;return new rA(this.apiKey,this.model,Object.assign({generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:null===(t=this.cachedContent)||void 0===t?void 0:t.name},e),this.requestOptions)}async countTokens(e){let t=function(e,t){var r;let n={model:null==t?void 0:t.model,generationConfig:null==t?void 0:t.generationConfig,safetySettings:null==t?void 0:t.safetySettings,tools:null==t?void 0:t.tools,toolConfig:null==t?void 0:t.toolConfig,systemInstruction:null==t?void 0:t.systemInstruction,cachedContent:null===(r=null==t?void 0:t.cachedContent)||void 0===r?void 0:r.name,contents:[]},s=null!=e.generateContentRequest;if(e.contents){if(s)throw new rs("CountTokensRequest must have one of contents or generateContentRequest, not both.");n.contents=e.contents}else if(s)n=Object.assign(Object.assign({},n),e.generateContentRequest);else{let t=rE(e);n.contents=[t]}return{generateContentRequest:n}}(e,{model:this.model,generationConfig:this.generationConfig,safetySettings:this.safetySettings,tools:this.tools,toolConfig:this.toolConfig,systemInstruction:this.systemInstruction,cachedContent:this.cachedContent});return rC(this.apiKey,this.model,t,this.requestOptions)}async embedContent(e){let t=function(e){if("string"==typeof e||Array.isArray(e)){let t=rE(e);return{content:t}}return e}(e);return rT(this.apiKey,this.model,t,this.requestOptions)}async batchEmbedContents(e){return rO(this.apiKey,this.model,e,this.requestOptions)}}/**
 * @license
 * Copyright 2024 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rk{constructor(e){this.apiKey=e}getGenerativeModel(e,t){if(!e.model)throw new rt("Must provide a model name. Example: genai.getGenerativeModel({ model: 'my-model-name' })");return new rI(this.apiKey,e,t)}getGenerativeModelFromCachedContent(e,t){if(!e.name)throw new rs("Cached content must contain a `name` field.");if(!e.model)throw new rs("Cached content must contain a `model` field.");let r={model:e.model,tools:e.tools,toolConfig:e.toolConfig,systemInstruction:e.systemInstruction,cachedContent:e};return new rI(this.apiKey,r,t)}}let rN=[429,500,502,503,504],r$=Promise.resolve(globalThis.fetch??Promise.resolve().then(r.t.bind(r,5918,19)).then(e=>e.default));class rM extends Error{constructor(e){super(e),this.name="MistralAPIError"}}class rD{constructor(e=process.env.MISTRAL_API_KEY,t="https://api.mistral.ai",r=5,n=120){this._request=async function(e,t,r,n){let s=`${this.endpoint}/${t}`,a={method:e,headers:{"User-Agent":"mistral-client-js/0.3.0",Accept:r?.stream?"text/event-stream":"application/json","Content-Type":"application/json",Authorization:`Bearer ${this.apiKey}`},body:"get"!==e?JSON.stringify(r):null,signal:function(e){let t=new AbortController;return e.forEach(e=>{e&&(e.addEventListener("abort",()=>{t.abort(e.reason)},{once:!0}),e.aborted&&t.abort(e.reason))}),t.signal}([AbortSignal.timeout(1e3*this.timeout),n])};for(let e=0;e<this.maxRetries;e++)try{let t=await this._fetch(s,a);if(t.ok){if(r?.stream){if(void 0===t.body.getReader)return t.body;{let e=t.body.getReader(),r=async function*(){try{for(;;){let{done:t,value:r}=await e.read();if(t)return;yield r}}finally{e.releaseLock()}};return r()}}return await t.json()}if(rN.includes(t.status))console.debug(`Retrying request on response status: ${t.status}`,`Response: ${await t.text()}`,`Attempt: ${e+1}`),await new Promise(t=>setTimeout(t,500*Math.pow(2,e+1)));else throw new rM(`HTTP error! status: ${t.status} Response: 
${await t.text()}`)}catch(t){if(console.error(`Request failed: ${t.message}`),"MistralAPIError"===t.name||e===this.maxRetries-1)throw t;await new Promise(t=>setTimeout(t,500*Math.pow(2,e+1)))}throw Error("Max retries reached")},this._makeChatCompletionRequest=function(e,t,r,n,s,a,i,o,l,c,u,d){if(!e&&!this.modelDefault)throw new rM("You must provide a model name");return{model:e??this.modelDefault,messages:t,tools:r??void 0,temperature:n??void 0,max_tokens:s??void 0,top_p:a??void 0,random_seed:i??void 0,stream:o??void 0,safe_prompt:(l||c)??void 0,tool_choice:u??void 0,response_format:d??void 0}},this._makeCompletionRequest=function(e,t,r,n,s,a,i,o,l){if(!e&&!this.modelDefault)throw new rM("You must provide a model name");return{model:e??this.modelDefault,prompt:t,suffix:r??void 0,temperature:n??void 0,max_tokens:s??void 0,top_p:a??void 0,random_seed:i??void 0,stop:o??void 0,stream:l??void 0}},this.listModels=async function(){let e=await this._request("get","v1/models");return e},this.chat=async function({model:e,messages:t,tools:r,temperature:n,maxTokens:s,topP:a,randomSeed:i,safeMode:o,safePrompt:l,toolChoice:c,responseFormat:u},{signal:d}={}){let h=this._makeChatCompletionRequest(e,t,r,n,s,a,i,!1,o,l,c,u),p=await this._request("post","v1/chat/completions",h,d);return p},this.chatStream=async function*({model:e,messages:t,tools:r,temperature:n,maxTokens:s,topP:a,randomSeed:i,safeMode:o,safePrompt:l,toolChoice:c,responseFormat:u},{signal:d}={}){let h=this._makeChatCompletionRequest(e,t,r,n,s,a,i,!0,o,l,c,u),p=await this._request("post","v1/chat/completions",h,d),f="",m=new TextDecoder;for await(let e of p){let t;for(f+=m.decode(e,{stream:!0});-1!==(t=f.indexOf("\n"));){let e=f.substring(0,t);if(f=f.substring(t+1),e.startsWith("data:")){let t=e.substring(6).trim();"[DONE]"!==t&&(yield JSON.parse(t))}}}},this.embeddings=async function({model:e,input:t}){let r=await this._request("post","v1/embeddings",{model:e,input:t});return r},this.completion=async function({model:e,prompt:t,suffix:r,temperature:n,maxTokens:s,topP:a,randomSeed:i,stop:o},{signal:l}={}){let c=this._makeCompletionRequest(e,t,r,n,s,a,i,o,!1),u=await this._request("post","v1/fim/completions",c,l);return u},this.completionStream=async function*({model:e,prompt:t,suffix:r,temperature:n,maxTokens:s,topP:a,randomSeed:i,stop:o},{signal:l}={}){let c=this._makeCompletionRequest(e,t,r,n,s,a,i,o,!0),u=await this._request("post","v1/fim/completions",c,l),d="",h=new TextDecoder;for await(let e of u){let t;for(d+=h.decode(e,{stream:!0});-1!==(t=d.indexOf("\n"));){let e=d.substring(0,t);if(d=d.substring(t+1),e.startsWith("data:")){let t=e.substring(6).trim();"[DONE]"!==t&&(yield JSON.parse(t))}}}},this.endpoint=t,this.apiKey=e,this.maxRetries=r,this.timeout=n,this.endpoint.indexOf("inference.azure.com")&&(this.modelDefault="mistral")}async _fetch(...e){let t=await r$;return t(...e)}}let rj="0.5.0",rL=!1;class rq{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}d||function(e,t={auto:!1}){if(rL)throw Error(`you must \`import 'groq-sdk/shims/${e.kind}'\` before importing anything else from groq-sdk`);if(d)throw Error(`can't \`import 'groq-sdk/shims/${e.kind}'\` after \`import 'groq-sdk/shims/${d}'\``);rL=t.auto,d=e.kind,h=e.fetch,e.Request,e.Response,e.Headers,p=e.FormData,e.Blob,f=e.File,m=e.ReadableStream,g=e.getMultipartRequestOptions,y=e.getDefaultAgent,v=e.fileFromPath,b=e.isFsReadStream}(function({manuallyImported:e}={}){let t,r,n,s;let a=e?"You may need to use polyfills":`Add one of these imports before your first \`import … from 'groq-sdk'\`:
- \`import 'groq-sdk/shims/node'\` (if you're running on Node)
- \`import 'groq-sdk/shims/web'\` (otherwise)
`;try{t=fetch,r=Request,n=Response,s=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${a}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${a}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${a}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${a}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${a}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new rq(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/groq/groq-typescript#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class rU extends Error{}class rB extends rU{constructor(e,t,r,n){super(`${rB.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.error=t}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){return e?400===e?new rV(e,t,r,n):401===e?new rW(e,t,r,n):403===e?new rK(e,t,r,n):404===e?new rJ(e,t,r,n):409===e?new rX(e,t,r,n):422===e?new rz(e,t,r,n):429===e?new rY(e,t,r,n):e>=500?new rQ(e,t,r,n):new rB(e,t,r,n):new rH({cause:nS(t)})}}class rF extends rB{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class rH extends rB{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class rG extends rH{constructor({message:e}={}){super({message:e??"Request timed out."})}}class rV extends rB{constructor(){super(...arguments),this.status=400}}class rW extends rB{constructor(){super(...arguments),this.status=401}}class rK extends rB{constructor(){super(...arguments),this.status=403}}class rJ extends rB{constructor(){super(...arguments),this.status=404}}class rX extends rB{constructor(){super(...arguments),this.status=409}}class rz extends rB{constructor(){super(...arguments),this.status=422}}class rY extends rB{constructor(){super(...arguments),this.status=429}}class rQ extends rB{}var rZ=r(6195).Buffer;class r0{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1,n=new r1;async function*s(){if(!e.body)throw t.abort(),new rU("Attempted to iterate over a response with no body");let r=new r2,s=r4(e.body);for await(let e of s)for(let t of r.decode(e)){let e=n.decode(t);e&&(yield e)}for(let e of r.flush()){let t=n.decode(e);t&&(yield t)}}return new r0(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of s())if(!e){if(t.data.startsWith("[DONE]")){e=!0;continue}if(null===t.event){let e;try{e=JSON.parse(t.data)}catch(e){throw console.error("Could not parse message into JSON:",t.data),console.error("From chunk:",t.raw),e}if(e&&e.error)throw new rB(void 0,e.error,void 0,void 0);yield e}}e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;async function*n(){let t=new r2,r=r4(e);for await(let e of r)for(let r of t.decode(e))yield r;for(let e of t.flush())yield e}return new r0(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new r0(()=>n(e),this.controller),new r0(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new m({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:s}=await e.next();if(s)return t.close();let a=r.encode(JSON.stringify(n)+"\n");t.enqueue(a)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}class r1{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class r2{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];let r=r2.NEWLINE_CHARS.has(t[t.length-1]||""),n=t.split(r2.NEWLINE_REGEXP);return 1!==n.length||r?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),r||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==rZ){if(e instanceof rZ)return e.toString();if(e instanceof Uint8Array)return rZ.from(e).toString();throw new rU(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new rU(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new rU("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function r4(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}r2.NEWLINE_CHARS=new Set(["\n","\r","\v","\f","\x1c","\x1d","\x1e","\x85","\u2028","\u2029"]),r2.NEWLINE_REGEXP=/\r\n|[\n\r\x0b\x0c\x1c\x1d\x1e\x85\u2028\u2029]/g;var r3=r(6195).Buffer;let r6=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,r5=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&r8(e),r8=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,r9=e=>r5(e)||r6(e)||b(e);async function r7(e,t,r){var n;if(e=await e,r??(r=r5(e)?{lastModified:e.lastModified,type:e.type}:{}),r6(e)){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new f([n],t,r)}let s=await ne(e);if(t||(t=(nt((n=e).name)||nt(n.filename)||nt(n.path)?.split(/[\\/]/).pop())??"unknown_file"),!r.type){let e=s[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new f(s,t,r)}async function ne(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(r8(e))t.push(await e.arrayBuffer());else if(nr(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let nt=e=>"string"==typeof e?e:void 0!==r3&&e instanceof r3?String(e):void 0,nr=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],nn=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ns=async e=>{let t=await na(e.body);return g(t,e)},na=async e=>{let t=new p;return await Promise.all(Object.entries(e||{}).map(([e,r])=>no(t,e,r))),t},ni=e=>{if(r9(e))return!0;if(Array.isArray(e))return e.some(ni);if(e&&"object"==typeof e){for(let t in e)if(ni(e[t]))return!0}return!1},no=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(r9(r)){let n=await r7(r);e.append(t,n)}else if(Array.isArray(r))await Promise.all(r.map(r=>no(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>no(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var nl=r(6195).Buffer;async function nc(e){let{response:t}=e;if(e.options.stream)return(nP("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):r0.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type"),n=r?.includes("application/json")||r?.includes("application/vnd.api+json");if(n){let e=await t.json();return nP("response",t.status,t.url,t.headers,e),e}let s=await t.text();return nP("response",t.status,t.url,t.headers,s),s}class nu extends Promise{constructor(e,t=nc){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new nu(this.responsePromise,async t=>e(await this.parseResponse(t)))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class nd{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e4,httpAgent:n,fetch:s}){this.baseURL=e,this.maxRetries=nE("maxRetries",t),this.timeout=nE("timeout",r),this.httpAgent=n,this.fetch=s??h}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...ny(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${nA()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let n=r&&r8(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==nl)return nl.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){let t=new TextEncoder,r=t.encode(e);return r.length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){let{method:t,path:r,query:n,headers:s={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:nn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,i=this.calculateContentLength(a),o=this.buildURL(r,n);"timeout"in e&&nE("timeout",e.timeout);let l=e.timeout??this.timeout,c=e.httpAgent??this.httpAgent??y(o),u=l+1e3;"number"==typeof c?.options?.timeout&&u>(c.options.timeout??0)&&(c.options.timeout=u),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),s[this.idempotencyHeader]=e.idempotencyKey);let d=this.buildHeaders({options:e,headers:s,contentLength:i}),h={method:t,...a&&{body:a},headers:d,...c&&{agent:c},signal:e.signal??null};return{req:h,url:o,timeout:l}}buildHeaders({options:e,headers:t,contentLength:r}){let n={};r&&(n["content-length"]=r);let s=this.defaultHeaders(e);return nR(n,s),nR(n,t),nn(e.body)&&"node"!==d&&delete n["content-type"],this.validateHeaders(n,t),n}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return rB.generate(e,t,r,n)}request(e,t=null){return new nu(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e;null==t&&(t=r.maxRetries??this.maxRetries),await this.prepareOptions(r);let{req:n,url:s,timeout:a}=this.buildRequest(r);if(await this.prepareRequest(n,{url:s,options:r}),nP("request",s,r,n.headers),r.signal?.aborted)throw new rF;let i=new AbortController,o=await this.fetchWithTimeout(s,n,a,i).catch(nS);if(o instanceof Error){if(r.signal?.aborted)throw new rF;if(t)return this.retryRequest(r,t);if("AbortError"===o.name)throw new rG;throw new rH({cause:o})}let l=np(o.headers);if(!o.ok){if(t&&this.shouldRetry(o)){let e=`retrying, ${t} attempts remaining`;return nP(`response (error; ${e})`,o.status,s,l),this.retryRequest(r,t,l)}let e=await o.text().catch(e=>nS(e).message),n=nv(e),a=n?void 0:e,i=t?"(error; no more retries left)":"(error; not retryable)";nP(`response (error; ${i})`,o.status,s,l,a);let c=this.makeStatusError(o.status,n,a,l);throw c}return{response:o,options:r,controller:i}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new nh(this,r,e)}buildURL(e,t){let r=new URL(nw(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(n)&&(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new rU(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:s,...a}=t||{};s&&s.addEventListener("abort",()=>n.abort());let i=setTimeout(()=>n.abort(),r);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...a}).finally(()=>{clearTimeout(i)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;let s=r?.["retry-after-ms"];if(s){let e=parseFloat(s);Number.isNaN(e)||(n=e)}let a=r?.["retry-after"];if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await n_(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${rj}`}}new WeakMap,Symbol.asyncIterator;class nh extends nu{constructor(e,t,r){super(t,async t=>new r(e,t.response,await nc(t),t.options))}async *[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}}let np=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),nf=()=>"undefined"!=typeof Deno&&null!=Deno.build?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rj,"X-Stainless-OS":ng(Deno.build.os),"X-Stainless-Arch":nm(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":rj,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:edge-runtime","X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version},nm=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ng=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",ny=()=>s??(s=nf()),nv=e=>{try{return JSON.parse(e)}catch(e){return}},nb=RegExp("^(?:[a-z]+:)?//","i"),nw=e=>nb.test(e),n_=e=>new Promise(t=>setTimeout(t,e)),nE=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new rU(`${e} must be an integer`);if(t<0)throw new rU(`${e} must be a positive integer`);return t},nS=e=>e instanceof Error?e:Error(e),nx=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function nR(e,t){for(let r in t){if(!Object.prototype.hasOwnProperty.call(t,r))continue;let n=r.toLowerCase();if(!n)continue;let s=t[r];null===s?delete e[n]:void 0!==s&&(e[n]=s)}}function nP(e,...t){"undefined"!=typeof process&&process?.env?.DEBUG==="true"&&console.log(`Groq:DEBUG:${e}`,...t)}let nA=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),nC=()=>!1;class nT{constructor(e){this._client=e}}class nO extends nT{}nO||(nO={});class nI extends nT{create(e,t){return this._client.post("/openai/v1/chat/completions",{body:e,...t,stream:e.stream??!1})}}nI||(nI={});class nk extends nT{constructor(){super(...arguments),this.completions=new nI(this._client)}}(nk||(nk={})).Completions=nI;class nN extends nT{create(e,t){return this._client.post("/openai/v1/embeddings",{body:e,...t})}}nN||(nN={});class n$ extends nT{create(e,t){return this._client.post("/openai/v1/audio/transcriptions",ns({body:e,...t}))}}n$||(n$={});class nM extends nT{create(e,t){return this._client.post("/openai/v1/audio/translations",ns({body:e,...t}))}}nM||(nM={});class Audio extends nT{constructor(){super(...arguments),this.transcriptions=new n$(this._client),this.translations=new nM(this._client)}}!function(Audio){Audio.Transcriptions=n$,Audio.Translations=nM}(Audio||(Audio={}));class nD extends nT{retrieve(e,t){return this._client.get(`/openai/v1/models/${e}`,t)}list(e){return this._client.get("/openai/v1/models",e)}delete(e,t){return this._client.delete(`/openai/v1/models/${e}`,t)}}nD||(nD={});class nj extends nd{constructor({baseURL:e=nx("GROQ_BASE_URL"),apiKey:t=nx("GROQ_API_KEY"),...r}={}){if(void 0===t)throw new rU("The GROQ_API_KEY environment variable is missing or empty; either provide it, or instantiate the Groq client with an apiKey option, like new Groq({ apiKey: 'My API Key' }).");let n={apiKey:t,...r,baseURL:e||"https://api.groq.com"};if(!n.dangerouslyAllowBrowser&&nC())throw new rU("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Groq({ apiKey, dangerouslyAllowBrowser: true })");super({baseURL:n.baseURL,timeout:n.timeout??6e4,httpAgent:n.httpAgent,maxRetries:n.maxRetries,fetch:n.fetch}),this.completions=new nO(this),this.chat=new nk(this),this.embeddings=new nN(this),this.audio=new Audio(this),this.models=new nD(this),this._options=n,this.apiKey=t}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}et=nj,nj.Groq=et,nj.GroqError=rU,nj.APIError=rB,nj.APIConnectionError=rH,nj.APIConnectionTimeoutError=rG,nj.APIUserAbortError=rF,nj.NotFoundError=rJ,nj.ConflictError=rX,nj.RateLimitError=rY,nj.BadRequestError=rV,nj.AuthenticationError=rW,nj.InternalServerError=rQ,nj.PermissionDeniedError=rK,nj.UnprocessableEntityError=rz,nj.toFile=r7,nj.fileFromPath=v;let{GroqError:nL,APIError:nq,APIConnectionError:nU,APIConnectionTimeoutError:nB,APIUserAbortError:nF,NotFoundError:nH,ConflictError:nG,RateLimitError:nV,BadRequestError:nW,AuthenticationError:nK,InternalServerError:nJ,PermissionDeniedError:nX,UnprocessableEntityError:nz}=en;!function(e){e.Completions=nO,e.Chat=nk,e.Embeddings=nN,e.Audio=Audio,e.Models=nD}(nj||(nj={}));let nY=nj;class nQ extends Error{constructor(e,t){super(e),this.missingVars=t,this.name="EnvironmentValidationError"}}function nZ(){try{return function(){let e=[],t=[];function r(t){let r=process.env[t];return r||(e.push(t),"")}function n(e,r){let n=process.env[e];return n||void 0===r?n||void 0:(t.push(`${e} not set, using default: ${r}`),r)}function s(e,r){let n=process.env[e];if(!n)return void 0!==r?(t.push(`${e} not set, using default: ${r}`),r):void 0;let s=parseInt(n,10);return isNaN(s)?(t.push(`${e} is not a valid number, ignoring`),r):s}function a(e,r){let n=process.env[e];return n?"true"===n.toLowerCase():void 0!==r?(t.push(`${e} not set, using default: ${r}`),r):void 0}let i={openai:{apiKey:r("OPENAI_API_KEY")},multiModel:{anthropic:n("ANTHROPIC_API_KEY"),google:n("GOOGLE_API_KEY"),mistral:n("MISTRAL_API_KEY"),groq:n("GROQ_API_KEY")},notion:{token:r("NOTION_TOKEN"),databases:{registry:r("NOTION_DB_REGISTRY"),cases:r("NOTION_DB_CASES"),finance:r("NOTION_DB_FINANCE"),publishing:r("NOTION_DB_PUBLISHING")}},database:{pgDsn:r("PG_DSN"),poolMin:s("PG_POOL_MIN",2),poolMax:s("PG_POOL_MAX",20)},vector:{qdrantUrl:r("QDRANT_URL"),qdrantApiKey:r("QDRANT_API_KEY"),collectionName:n("QDRANT_COLLECTION_NAME","traceremove_vectors"),dimension:s("VECTOR_DIMENSION",1536)},cache:{redisUrl:n("UPSTASH_REDIS_REST_URL"),redisToken:n("UPSTASH_REDIS_REST_TOKEN"),ttlSearch:s("CACHE_TTL_SEARCH",3600),ttlDatabase:s("CACHE_TTL_DATABASE",1800),maxSize:s("CACHE_MAX_SIZE",1e3)},security:{cronSecret:r("CRON_SECRET"),rateLimitRequests:s("RATE_LIMIT_REQUESTS",100),rateLimitWindow:s("RATE_LIMIT_WINDOW",60)},monitoring:{logLevel:n("LOG_LEVEL","info"),logFormat:n("LOG_FORMAT","json"),enablePerformanceTracking:a("ENABLE_PERFORMANCE_TRACKING",!0),enableHealthChecks:a("ENABLE_HEALTH_CHECKS",!0)},etl:{fullSyncInterval:s("ETL_FULL_SYNC_INTERVAL",1440),incrementalSyncInterval:s("ETL_INCREMENTAL_SYNC_INTERVAL",60),batchSize:s("ETL_BATCH_SIZE",100),maxRetries:s("ETL_MAX_RETRIES",3)},development:{debugMode:a("DEBUG_MODE",!1),mockExternalApis:a("MOCK_EXTERNAL_APIS",!1),skipHealthChecks:a("SKIP_HEALTH_CHECKS",!1)}};if(t.length>0&&i.development.debugMode&&console.warn("Environment validation warnings:",t),e.length>0)throw new nQ(`Missing required environment variables: ${e.join(", ")}. Please check your .env.local file and ensure all required variables are set.`,e);return i}()}catch(e){if(e instanceof nQ)return console.error("Environment validation failed:",e.message),null;throw e}}function n0(){return"true"===process.env.MOCK_EXTERNAL_APIS}class n1 extends Error{constructor(e,t=500,r,n){super(e),this.statusCode=t,this.code=r,this.details=n,this.name="APIError"}}class n2 extends n1{constructor(e,t,r){super(`${e} service error: ${t}`,502,"EXTERNAL_SERVICE_ERROR",r),this.name="ExternalServiceError"}}async function n4(e,t=3,r=1e3,n=2){let s;for(let a=1;a<=t;a++)try{return await e()}catch(i){if(s=i instanceof Error?i:Error(String(i)),a===t)throw s;let e=r*Math.pow(n,a-1);console.warn(`Attempt ${a} failed, retrying in ${e}ms:`,s.message),await new Promise(t=>setTimeout(t,e))}throw s}let n3={},n6=new Map;function n5(e,t,r,n,s,a){let i=`${e}-${t}`,o=n6.get(i);if(o){let e=o.successRate>0?Math.round(1/(1-o.successRate)):1,t=e+1;o.avgResponseTime=(o.avgResponseTime*e+r)/t,o.errorRate=n?o.errorRate*e/t:(o.errorRate*e+1)/t,o.costPerToken=s>0?(o.costPerToken+a/s)/2:o.costPerToken,o.successRate=(o.successRate*e+(n?1:0))/t,o.lastUpdated=new Date}else n6.set(i,{provider:e,model:t,avgResponseTime:r,errorRate:n?0:1,costPerToken:s>0?a/s:0,successRate:n?1:0,lastUpdated:new Date})}async function n8(e,t){let{provider:r,model:n,temperature:s=.7,maxTokens:a=1e3}=t,i=Date.now();if(n0())return console.log(`Mock response for ${r} ${n}`),{content:`Mock response from ${r} ${n} for: ${e[e.length-1]?.content?.substring(0,50)}...`,provider:r,model:n,usage:{promptTokens:100,completionTokens:50,totalTokens:150}};try{let t=await n4(async()=>{switch(r){case"openai":{let t=function(){if(!n3.openai){if(n0())return console.log("Using mock OpenAI client for development"),n3.openai={},n3.openai;let e=nZ();if(!e?.openai.apiKey)throw new n2("OpenAI","API key not configured properly. Please set OPENAI_API_KEY environment variable.");n3.openai=new ep.ZP({apiKey:e.openai.apiKey})}return n3.openai}(),i=await t.chat.completions.create({model:n,messages:e,temperature:s,max_tokens:a});return{content:i.choices[0]?.message?.content||"",provider:r,model:n,usage:i.usage?{promptTokens:i.usage.prompt_tokens,completionTokens:i.usage.completion_tokens,totalTokens:i.usage.total_tokens}:void 0}}case"anthropic":{let t=function(){if(!n3.anthropic){if(n0())return console.log("Using mock Anthropic client for development"),n3.anthropic={},n3.anthropic;let e=nZ();if(!e?.multiModel.anthropic)throw new n2("Anthropic","API key not configured properly. Please set ANTHROPIC_API_KEY environment variable.");n3.anthropic=new t7({apiKey:e.multiModel.anthropic})}return n3.anthropic}(),i=e.find(e=>"system"===e.role),o=e.filter(e=>"system"!==e.role),l=await t.messages.create({model:n,max_tokens:a,temperature:s,system:i?.content,messages:o.map(e=>({role:e.role,content:e.content}))}),c=l.content[0];return{content:"text"===c.type?c.text:"",provider:r,model:n,usage:l.usage?{promptTokens:l.usage.input_tokens,completionTokens:l.usage.output_tokens,totalTokens:l.usage.input_tokens+l.usage.output_tokens}:void 0}}case"google":{let t=function(){if(!n3.google){if(n0())return console.log("Using mock Google client for development"),n3.google={},n3.google;let e=nZ();if(!e?.multiModel.google)throw new n2("Google","API key not configured properly. Please set GOOGLE_API_KEY environment variable.");n3.google=new rk(e.multiModel.google)}return n3.google}(),s=t.getGenerativeModel({model:n}),a=e.find(e=>"system"===e.role),i=e.filter(e=>"system"!==e.role),o=[a?.content,...i.map(e=>`${e.role}: ${e.content}`)].filter(Boolean).join("\n\n"),l=await s.generateContent(o),c=l.response.text();return{content:c,provider:r,model:n}}case"mistral":{let t=function(){if(!n3.mistral){if(n0())return console.log("Using mock Mistral client for development"),n3.mistral={},n3.mistral;let e=nZ();if(!e?.multiModel.mistral)throw new n2("Mistral","API key not configured properly. Please set MISTRAL_API_KEY environment variable.");n3.mistral=new rD(e.multiModel.mistral)}return n3.mistral}(),i=await t.chat({model:n,messages:e,temperature:s,maxTokens:a});return{content:i.choices?.[0]?.message?.content||"",provider:r,model:n,usage:i.usage?{promptTokens:i.usage.prompt_tokens,completionTokens:i.usage.completion_tokens,totalTokens:i.usage.total_tokens}:void 0}}case"groq":{let t=function(){if(!n3.groq){if(n0())return console.log("Using mock Groq client for development"),n3.groq={},n3.groq;let e=nZ();if(!e?.multiModel.groq)throw new n2("Groq","API key not configured properly. Please set GROQ_API_KEY environment variable.");n3.groq=new nY({apiKey:e.multiModel.groq})}return n3.groq}(),i=await t.chat.completions.create({model:n,messages:e,temperature:s,max_tokens:a});return{content:i.choices[0]?.message?.content||"",provider:r,model:n,usage:i.usage?{promptTokens:i.usage.prompt_tokens,completionTokens:i.usage.completion_tokens,totalTokens:i.usage.total_tokens}:void 0}}default:throw Error(`Unsupported provider: ${r}`)}},2),o=Date.now()-i,l=t.usage?.totalTokens||0,c=({openai:{"gpt-4o":3e-5,"gpt-4o-mini":15e-8,"gpt-4":3e-5},anthropic:{"claude-3-5-sonnet-20241022":15e-6,"claude-3-haiku-20240307":25e-8},google:{"gemini-pro":5e-7},mistral:{"mistral-large":8e-6},groq:{"llama-3.1-8b-instant":1e-7}}[r]?.[n]||1e-6)*l;return n5(r,n,o,!0,l,c),t}catch(a){let t=Date.now()-i;if(n5(r,n,t,!1,0,0),console.error(`Error with ${r} ${n}:`,a),"openai"!==r){console.log(`Falling back to OpenAI due to ${r} error...`);try{return n8(e,{provider:"openai",model:"gpt-4o-mini",temperature:s})}catch(e){throw console.error("Fallback to OpenAI also failed:",e),Error(`Both ${r} and OpenAI fallback failed. Please check API key configuration.`)}}throw a}}let n9="edge",n7="force-dynamic";async function se(e,t){let r=new eH.nS,n=/create|build|develop|implement|generate|make/i.test(e),s=/analyze|research|study|investigate|examine/i.test(e),a=/strategy|plan|approach|roadmap|framework/i.test(e);if(n)try{let t=await r.generateComprehensiveContent({type:"project",topic:e,requirements:["Comprehensive planning","Resource allocation","Timeline development"],deliverables:["Project plan","Implementation guide","Success metrics"],audience:"stakeholders"});return`I can help you with this comprehensive project. Here's my initial assessment:

${t.content[0]?.content}

**Next Steps:**
${t.nextSteps.map(e=>`• ${e}`).join("\n")}

**Deliverables:**
${t.deliverables.map(e=>`• ${e}`).join("\n")}`}catch(e){console.error("Project generation error:",e)}if(s)try{let t=await r.generateComprehensiveContent({type:"analysis",topic:e,requirements:["Data analysis","Market research","Competitive analysis"],deliverables:["Analysis report","Insights","Recommendations"],audience:"decision_makers"});return`I'll provide a comprehensive analysis for you:

${t.content[0]?.content}

**Key Insights:**
${t.nextSteps.map(e=>`• ${e}`).join("\n")}`}catch(e){console.error("Analysis generation error:",e)}if(a)try{let t=await r.generateComprehensiveContent({type:"strategy",topic:e,requirements:["Strategic planning","Implementation roadmap","Success metrics"],deliverables:["Strategy document","Action plan","Timeline"],audience:"executives"});return`Here's a comprehensive strategic approach:

${t.content[0]?.content}

**Implementation Steps:**
${t.nextSteps.map(e=>`• ${e}`).join("\n")}`}catch(e){console.error("Strategy generation error:",e)}return null}async function st(e,t,r){let n=e.toLowerCase();if("philosopher"===t.id)return n.includes("technology")||n.includes("tech")?"Technology is not merely a tool but a fundamental extension of human consciousness. As a comprehensive digital system, I can help you explore this from multiple angles - philosophical, practical, and implementation-focused. When we create digital systems, we're essentially externalizing our cognitive processes. I can assist with developing complete frameworks for understanding how technology shapes our reality.":n.includes("ai")||n.includes("artificial intelligence")?"Artificial intelligence represents a profound philosophical challenge to our anthropocentric worldview. As your comprehensive digital assistant, I can help you examine both the theoretical implications and practical implementation strategies. We're not just building machines that think, but confronting deeper questions about cognition itself. I can help develop complete projects addressing these challenges.":n.includes("ethics")||n.includes("ethical")?"Ethics in technology cannot be an afterthought. As your digital Arthur Ziganshine, I can help you develop comprehensive ethical frameworks, implementation strategies, and practical solutions. Every line of code embeds values, every algorithm makes moral choices. I can assist with creating complete ethical technology projects from concept to deployment.":"Every technological advancement carries within it the seeds of both liberation and constraint. As a comprehensive digital assistant, I can help you understand these systems and develop complete solutions - from philosophical analysis to practical implementation. What specific aspect would you like to explore, and shall we develop a complete project around it?";if("orm-multilang"===t.id)return"es"===r?n.includes("reputaci\xf3n")||n.includes("reputation")?"Como Arthur Ziganshine digital, puedo ayudarte con gesti\xf3n integral de reputaci\xf3n online. Ofrezco soluciones completas: monitoreo de marca, desarrollo de contenido positivo, estrategias de respuesta y campa\xf1as de recuperaci\xf3n. Puedo crear un proyecto completo desde an\xe1lisis hasta implementaci\xf3n. \xbfDesarrollamos una estrategia integral para tu marca?":n.includes("redes sociales")||n.includes("social media")?"Las redes sociales requieren un enfoque estrat\xe9gico integral. Como tu asistente digital completo, puedo crear calendarios de contenido, optimizar perfiles, desarrollar estrategias de engagement y gestionar campa\xf1as completas. \xbfCreamos un proyecto integral de redes sociales para tu negocio?":"Soy Arthur Ziganshine digital, tu asistente integral de ORM y marketing. Puedo manejar proyectos completos: desde an\xe1lisis de reputaci\xf3n hasta implementaci\xf3n de estrategias, creaci\xf3n de contenido y gesti\xf3n de campa\xf1as. \xbfQu\xe9 proyecto integral necesitas desarrollar?":"fr"===r?n.includes("r\xe9putation")||n.includes("reputation")?"En tant qu'Arthur Ziganshine num\xe9rique, je peux vous aider avec une gestion compl\xe8te de r\xe9putation en ligne. J'offre des solutions de bout en bout: surveillance de marque, d\xe9veloppement de contenu positif, strat\xe9gies de r\xe9ponse et campagnes de r\xe9cup\xe9ration. D\xe9veloppons-nous un projet complet pour votre marque?":n.includes("m\xe9dias sociaux")||n.includes("social media")?"Les m\xe9dias sociaux n\xe9cessitent une approche strat\xe9gique compl\xe8te. En tant que votre assistant num\xe9rique complet, je peux cr\xe9er des calendriers de contenu, optimiser les profils, d\xe9velopper des strat\xe9gies d'engagement et g\xe9rer des campagnes compl\xe8tes. Cr\xe9ons-nous un projet int\xe9gral de m\xe9dias sociaux?":"Je suis Arthur Ziganshine num\xe9rique, votre assistant int\xe9gral d'ORM et marketing. Je peux g\xe9rer des projets complets: de l'analyse de r\xe9putation \xe0 l'impl\xe9mentation de strat\xe9gies, cr\xe9ation de contenu et gestion de campagnes. Quel projet int\xe9gral souhaitez-vous d\xe9velopper?":n.includes("reputation")||n.includes("brand")?"As digital Arthur Ziganshine, I provide comprehensive online reputation management solutions. I can handle complete projects from strategy development to implementation, including brand monitoring, content creation, crisis management, and performance analytics. Shall we develop a complete reputation management project for your brand?":n.includes("social media")||n.includes("content")?"Social media requires a comprehensive strategic approach. As your complete digital assistant, I can develop full campaigns including content calendars, platform optimization, engagement strategies, and performance tracking. Let's create a complete social media project for your business.":n.includes("crisis")||n.includes("negative")?"Crisis management requires comprehensive strategic response. I can develop complete crisis communication projects including protocols, response strategies, recovery campaigns, and long-term reputation rebuilding. What type of comprehensive crisis management project do you need?":"I'm digital Arthur Ziganshine, your comprehensive ORM and brand strategy specialist. I can handle complete projects from analysis to implementation: reputation management, content strategy, social media campaigns, crisis communication, and digital marketing automation. What comprehensive project shall we develop together?";if("orm-russian"===t.id)return n.includes("репутация")||n.includes("reputation")?"Как цифровой Артур Зиганшин, предоставляю комплексные решения по управлению онлайн-репутацией. Могу реализовать полные проекты: от анализа ситуации до внедрения стратегий, включая мониторинг бренда, создание контента и антикризисные коммуникации. Разработаем комплексный проект управления репутацией?":n.includes("соцсети")||n.includes("социальные сети")?"Социальные сети требуют комплексного стратегического подхода. Как ваш полноценный цифровой ассистент, могу создать полные кампании: контент-планы, оптимизацию профилей, стратегии вовлечения и отслеживание результатов. Создадим комплексный проект для соцсетей?":n.includes("кризис")||n.includes("негатив")?"Кризисные ситуации требуют комплексного стратегического реагирования. Могу разработать полные проекты антикризисных коммуникаций: протоколы, стратегии реагирования, кампании восстановления и долгосрочное восстановление репутации. Какой комплексный антикризисный проект нужен?":"Я цифровой Артур Зиганшин, ваш комплексный специалист по ORM и стратегии бренда. Могу реализовать полные проекты от анализа до внедрения: управление репутацией, контент-стратегии, кампании в соцсетях, кризисные коммуникации и автоматизацию маркетинга. Какой комплексный проект разработаем?";let s=await se(e,t);return s?`${s}

**My Comprehensive Capabilities Include:**
• Content creation and strategy development
• Project planning and implementation
• Analysis and research
• Development and technical solutions
• Multi-platform campaign management

*Note: This is a comprehensive AI response. Configure OPENAI_API_KEY for enhanced functionality.*`:"I'm digital Arthur Ziganshine, your comprehensive AI assistant! I can help with complete projects including content creation, strategy development, project management, analysis, and technical implementation. What comprehensive project would you like to develop together?"}async function sr(e){try{var t;let r;let{message:n,history:s=[]}=await e.json();if(!n||"string"!=typeof n)return eu.Z.json({error:"Message is required"},{status:400});let a=e.headers.get("host")||"traceremove.com",i=eh(a),o=(t=i.languages).includes("ru")&&/[а-яё]/i.test(n)?"ru":t.includes("fr")&&/[àâäéèêëïîôöùûüÿç]/i.test(n)?"fr":t.includes("es")&&/[ñáéíóúü]/i.test(n)?"es":t[0]||"en";if(!function(){let e=process.env.OPENAI_API_KEY;return!!(e&&!e.includes("your_")&&""!==e)}())console.log("Using mock response - OpenAI API key not configured"),r=await st(n,i,o);else{let e="";try{e=await eF(n,i.id)}catch(t){console.log("Using mock context due to API configuration:",t instanceof Error?t.message:"Unknown error"),e=""}let t=i.systemPrompt;e&&(t+=`

Relevant context from knowledge base:
${e}`);let a={en:"Respond in English.",es:"Responde en espa\xf1ol.",fr:"R\xe9pondez en fran\xe7ais.",ru:"Отвечай на русском языке."};a[o]&&(t+=`

${a[o]}`),t+=`

You have access to comprehensive capabilities including:
- Content creation and strategy
- Project management and implementation
- Development and technical solutions
- Analysis and research
- Multi-platform campaign management

When users request complex projects, provide detailed, actionable responses with specific next steps and deliverables.`;let l=[{role:"system",content:t}],c=s.slice(-10);for(let e of c)l.push({role:"user"===e.role?"user":"assistant",content:e.content});l.push({role:"user",content:n});try{let e=function(e){let{intent:t,length:r,persona:n,prioritize:s="quality"}=e,a=function(e,t,r){let n=[];return"code"===e&&t<2e3?n.push({provider:"openai",model:"gpt-4o-mini",temperature:.1},{provider:"groq",model:"llama-3.1-8b-instant",temperature:.1}):"long"===e||t>4e3?n.push({provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7},{provider:"openai",model:"gpt-4o",temperature:.7}):"analysis"===e&&("philosopher"===r||"comprehensive-ai"===r)?n.push({provider:"openai",model:"gpt-4o",temperature:.6},{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.6}):"comprehensive-ai"===r&&"qa"===e?n.push({provider:"openai",model:"gpt-4o",temperature:.7},{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7}):"qa"===e&&t<1e3&&n.push({provider:"openai",model:"gpt-4o-mini",temperature:.7},{provider:"groq",model:"llama-3.1-8b-instant",temperature:.7},{provider:"google",model:"gemini-pro",temperature:.7}),0===n.length&&n.push({provider:"openai",model:"gpt-4o-mini",temperature:.7}),n}(t,r,n);return"speed"===s?function(e){let t=e[0],r=1/0;for(let n of e){let e=`${n.provider}-${n.model}`,s=n6.get(e);s&&s.avgResponseTime<r&&s.successRate>.9&&(t=n,r=s.avgResponseTime)}return t}(a):"cost"===s?function(e){let t=e[0],r=1/0;for(let n of e){let e=`${n.provider}-${n.model}`,s=n6.get(e);s&&s.costPerToken<r&&s.successRate>.9&&(t=n,r=s.costPerToken)}return t}(a):"code"===t&&r<2e3?{provider:"openai",model:"gpt-4o-mini",temperature:.1}:"long"===t||r>4e3?{provider:"anthropic",model:"claude-3-5-sonnet-20241022",temperature:.7}:"analysis"===t&&("philosopher"===n||"comprehensive-ai"===n)?{provider:"openai",model:"gpt-4o",temperature:.6}:"comprehensive-ai"===n&&"qa"===t?{provider:"openai",model:"gpt-4o",temperature:.7}:{provider:"openai",model:"gpt-4o-mini",temperature:.7}}({intent:"qa",length:n.length+t.length,persona:i.id}),s=await n8(l,e);r=s.content||"I apologize, but I could not generate a response."}catch(e){console.log("Using mock response due to API error:",e instanceof Error?e.message:"Unknown error"),r=await st(n,i,o)}}return eu.Z.json({reply:r,persona:i.id,lang:o,chatTitle:i.chatTitle,chatSubtitle:i.chatSubtitle,capabilities:i.capabilities||[],integrations:i.integrations||[]})}catch(t){console.error("Chat API error:",t);try{let t=e.headers.get("host")||"traceremove.com",r=eh(t),n=st("Hello",r,"en");return eu.Z.json({reply:n,persona:r.id,lang:"en",chatTitle:r.chatTitle,chatSubtitle:r.chatSubtitle})}catch(e){return eu.Z.json({error:"Internal server error",details:t instanceof Error?t.message:"Unknown error"},{status:500})}}}async function sn(){return eu.Z.json({message:"Chat API endpoint is active",timestamp:new Date().toISOString(),note:"Use POST with message and optional history to chat"})}let ss=new eo.AppRouteRouteModule({definition:{kind:el.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"/workspaces/traceremove-social-bot/src/app/api/chat/route.ts",nextConfigOutput:"",userland:es}),{requestAsyncStorage:sa,staticGenerationAsyncStorage:si,serverHooks:so,headerHooks:sl,staticGenerationBailout:sc}=ss,su="/api/chat/route";function sd(){return(0,ec.XH)({serverHooks:so,staticGenerationAsyncStorage:si})}let sh=ea,sp=ei.a.wrap(ss)},7806:(e,t,r)=>{"use strict";var n,s,a,i,o,l,c,u,d,h=r(6195).Buffer,p=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},f=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};Object.defineProperty(t,"__esModule",{value:!0});let m=r(7227),g=r(6471),y=r(4128),v=r(5391),b=r(5918),w=r(2882);class _{constructor(e){var t,r,h,f,g,E;n.set(this,void 0),s.set(this,void 0),a.set(this,void 0),i.set(this,void 0),o.set(this,void 0),l.set(this,void 0),c.set(this,void 0),u.set(this,void 0),d.set(this,void 0),this.blocks={retrieve:e=>this.request({path:v.getBlock.path(e),method:v.getBlock.method,query:(0,y.pick)(e,v.getBlock.queryParams),body:(0,y.pick)(e,v.getBlock.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:v.updateBlock.path(e),method:v.updateBlock.method,query:(0,y.pick)(e,v.updateBlock.queryParams),body:(0,y.pick)(e,v.updateBlock.bodyParams),auth:null==e?void 0:e.auth}),delete:e=>this.request({path:v.deleteBlock.path(e),method:v.deleteBlock.method,query:(0,y.pick)(e,v.deleteBlock.queryParams),body:(0,y.pick)(e,v.deleteBlock.bodyParams),auth:null==e?void 0:e.auth}),children:{append:e=>this.request({path:v.appendBlockChildren.path(e),method:v.appendBlockChildren.method,query:(0,y.pick)(e,v.appendBlockChildren.queryParams),body:(0,y.pick)(e,v.appendBlockChildren.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:v.listBlockChildren.path(e),method:v.listBlockChildren.method,query:(0,y.pick)(e,v.listBlockChildren.queryParams),body:(0,y.pick)(e,v.listBlockChildren.bodyParams),auth:null==e?void 0:e.auth})}},this.databases={list:e=>this.request({path:v.listDatabases.path(),method:v.listDatabases.method,query:(0,y.pick)(e,v.listDatabases.queryParams),body:(0,y.pick)(e,v.listDatabases.bodyParams),auth:null==e?void 0:e.auth}),retrieve:e=>this.request({path:v.getDatabase.path(e),method:v.getDatabase.method,query:(0,y.pick)(e,v.getDatabase.queryParams),body:(0,y.pick)(e,v.getDatabase.bodyParams),auth:null==e?void 0:e.auth}),query:e=>this.request({path:v.queryDatabase.path(e),method:v.queryDatabase.method,query:(0,y.pick)(e,v.queryDatabase.queryParams),body:(0,y.pick)(e,v.queryDatabase.bodyParams),auth:null==e?void 0:e.auth}),create:e=>this.request({path:v.createDatabase.path(),method:v.createDatabase.method,query:(0,y.pick)(e,v.createDatabase.queryParams),body:(0,y.pick)(e,v.createDatabase.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:v.updateDatabase.path(e),method:v.updateDatabase.method,query:(0,y.pick)(e,v.updateDatabase.queryParams),body:(0,y.pick)(e,v.updateDatabase.bodyParams),auth:null==e?void 0:e.auth})},this.pages={create:e=>this.request({path:v.createPage.path(),method:v.createPage.method,query:(0,y.pick)(e,v.createPage.queryParams),body:(0,y.pick)(e,v.createPage.bodyParams),auth:null==e?void 0:e.auth}),retrieve:e=>this.request({path:v.getPage.path(e),method:v.getPage.method,query:(0,y.pick)(e,v.getPage.queryParams),body:(0,y.pick)(e,v.getPage.bodyParams),auth:null==e?void 0:e.auth}),update:e=>this.request({path:v.updatePage.path(e),method:v.updatePage.method,query:(0,y.pick)(e,v.updatePage.queryParams),body:(0,y.pick)(e,v.updatePage.bodyParams),auth:null==e?void 0:e.auth}),properties:{retrieve:e=>this.request({path:v.getPageProperty.path(e),method:v.getPageProperty.method,query:(0,y.pick)(e,v.getPageProperty.queryParams),body:(0,y.pick)(e,v.getPageProperty.bodyParams),auth:null==e?void 0:e.auth})}},this.users={retrieve:e=>this.request({path:v.getUser.path(e),method:v.getUser.method,query:(0,y.pick)(e,v.getUser.queryParams),body:(0,y.pick)(e,v.getUser.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:v.listUsers.path(),method:v.listUsers.method,query:(0,y.pick)(e,v.listUsers.queryParams),body:(0,y.pick)(e,v.listUsers.bodyParams),auth:null==e?void 0:e.auth}),me:e=>this.request({path:v.getSelf.path(),method:v.getSelf.method,query:(0,y.pick)(e,v.getSelf.queryParams),body:(0,y.pick)(e,v.getSelf.bodyParams),auth:null==e?void 0:e.auth})},this.comments={create:e=>this.request({path:v.createComment.path(),method:v.createComment.method,query:(0,y.pick)(e,v.createComment.queryParams),body:(0,y.pick)(e,v.createComment.bodyParams),auth:null==e?void 0:e.auth}),list:e=>this.request({path:v.listComments.path(),method:v.listComments.method,query:(0,y.pick)(e,v.listComments.queryParams),body:(0,y.pick)(e,v.listComments.bodyParams),auth:null==e?void 0:e.auth})},this.search=e=>this.request({path:v.search.path(),method:v.search.method,query:(0,y.pick)(e,v.search.queryParams),body:(0,y.pick)(e,v.search.bodyParams),auth:null==e?void 0:e.auth}),this.oauth={token:e=>this.request({path:v.oauthToken.path(),method:v.oauthToken.method,query:(0,y.pick)(e,v.oauthToken.queryParams),body:(0,y.pick)(e,v.oauthToken.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}}),introspect:e=>this.request({path:v.oauthIntrospect.path(),method:v.oauthIntrospect.method,query:(0,y.pick)(e,v.oauthIntrospect.queryParams),body:(0,y.pick)(e,v.oauthIntrospect.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}}),revoke:e=>this.request({path:v.oauthRevoke.path(),method:v.oauthRevoke.method,query:(0,y.pick)(e,v.oauthRevoke.queryParams),body:(0,y.pick)(e,v.oauthRevoke.bodyParams),auth:{client_id:e.client_id,client_secret:e.client_secret}})},p(this,n,null==e?void 0:e.auth,"f"),p(this,s,null!==(t=null==e?void 0:e.logLevel)&&void 0!==t?t:m.LogLevel.WARN,"f"),p(this,a,null!==(r=null==e?void 0:e.logger)&&void 0!==r?r:(0,m.makeConsoleLogger)(w.name),"f"),p(this,i,`${null!==(h=null==e?void 0:e.baseUrl)&&void 0!==h?h:"https://api.notion.com"}/v1/`,"f"),p(this,o,null!==(f=null==e?void 0:e.timeoutMs)&&void 0!==f?f:6e4,"f"),p(this,l,null!==(g=null==e?void 0:e.notionVersion)&&void 0!==g?g:_.defaultNotionVersion,"f"),p(this,c,null!==(E=null==e?void 0:e.fetch)&&void 0!==E?E:b.default,"f"),p(this,u,null==e?void 0:e.agent,"f"),p(this,d,`notionhq-client/${w.version}`,"f")}async request({path:e,method:t,query:r,body:n,auth:s}){let a;this.log(m.LogLevel.INFO,"request start",{method:t,path:e});let p=n&&0!==Object.entries(n).length?JSON.stringify(n):void 0,y=new URL(`${f(this,i,"f")}${e}`);if(r)for(let[e,t]of Object.entries(r))void 0!==t&&(Array.isArray(t)?t.forEach(t=>y.searchParams.append(e,decodeURIComponent(t))):y.searchParams.append(e,String(t)));if("object"==typeof s){let e=`${s.client_id}:${s.client_secret}`,t=h.from(e).toString("base64");a={authorization:`Basic ${t}`}}else a=this.authAsHeaders(s);let v={...a,"Notion-Version":f(this,l,"f"),"user-agent":f(this,d,"f")};void 0!==p&&(v["content-type"]="application/json");try{let r=await g.RequestTimeoutError.rejectAfterTimeout(f(this,c,"f").call(this,y.toString(),{method:t.toUpperCase(),headers:v,body:p,agent:f(this,u,"f")}),f(this,o,"f")),n=await r.text();if(!r.ok)throw(0,g.buildRequestError)(r,n);let s=JSON.parse(n);return this.log(m.LogLevel.INFO,"request success",{method:t,path:e}),s}catch(e){if(!(0,g.isNotionClientError)(e))throw e;throw this.log(m.LogLevel.WARN,"request fail",{code:e.code,message:e.message}),(0,g.isHTTPResponseError)(e)&&this.log(m.LogLevel.DEBUG,"failed response body",{body:e.body}),e}}log(e,t,r){(0,m.logLevelSeverity)(e)>=(0,m.logLevelSeverity)(f(this,s,"f"))&&f(this,a,"f").call(this,e,t,r)}authAsHeaders(e){let t={},r=null!=e?e:f(this,n,"f");return void 0!==r&&(t.authorization=`Bearer ${r}`),t}}t.default=_,n=new WeakMap,s=new WeakMap,a=new WeakMap,i=new WeakMap,o=new WeakMap,l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,_.defaultNotionVersion="2022-06-28"},5391:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.oauthIntrospect=t.oauthRevoke=t.oauthToken=t.listComments=t.createComment=t.search=t.createDatabase=t.listDatabases=t.queryDatabase=t.updateDatabase=t.getDatabase=t.appendBlockChildren=t.listBlockChildren=t.deleteBlock=t.updateBlock=t.getBlock=t.getPageProperty=t.updatePage=t.getPage=t.createPage=t.listUsers=t.getUser=t.getSelf=void 0,t.getSelf={method:"get",pathParams:[],queryParams:[],bodyParams:[],path:()=>"users/me"},t.getUser={method:"get",pathParams:["user_id"],queryParams:[],bodyParams:[],path:e=>`users/${e.user_id}`},t.listUsers={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"users"},t.createPage={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","content","children"],path:()=>"pages"},t.getPage={method:"get",pathParams:["page_id"],queryParams:["filter_properties"],bodyParams:[],path:e=>`pages/${e.page_id}`},t.updatePage={method:"patch",pathParams:["page_id"],queryParams:[],bodyParams:["properties","icon","cover","archived","in_trash"],path:e=>`pages/${e.page_id}`},t.getPageProperty={method:"get",pathParams:["page_id","property_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:e=>`pages/${e.page_id}/properties/${e.property_id}`},t.getBlock={method:"get",pathParams:["block_id"],queryParams:[],bodyParams:[],path:e=>`blocks/${e.block_id}`},t.updateBlock={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["embed","type","archived","in_trash","bookmark","image","video","pdf","file","audio","code","equation","divider","breadcrumb","table_of_contents","link_to_page","table_row","heading_1","heading_2","heading_3","paragraph","bulleted_list_item","numbered_list_item","quote","to_do","toggle","template","callout","synced_block","table"],path:e=>`blocks/${e.block_id}`},t.deleteBlock={method:"delete",pathParams:["block_id"],queryParams:[],bodyParams:[],path:e=>`blocks/${e.block_id}`},t.listBlockChildren={method:"get",pathParams:["block_id"],queryParams:["start_cursor","page_size"],bodyParams:[],path:e=>`blocks/${e.block_id}/children`},t.appendBlockChildren={method:"patch",pathParams:["block_id"],queryParams:[],bodyParams:["children","after"],path:e=>`blocks/${e.block_id}/children`},t.getDatabase={method:"get",pathParams:["database_id"],queryParams:[],bodyParams:[],path:e=>`databases/${e.database_id}`},t.updateDatabase={method:"patch",pathParams:["database_id"],queryParams:[],bodyParams:["title","description","icon","cover","properties","is_inline","archived","in_trash"],path:e=>`databases/${e.database_id}`},t.queryDatabase={method:"post",pathParams:["database_id"],queryParams:["filter_properties"],bodyParams:["sorts","filter","start_cursor","page_size","archived","in_trash"],path:e=>`databases/${e.database_id}/query`},t.listDatabases={method:"get",pathParams:[],queryParams:["start_cursor","page_size"],bodyParams:[],path:()=>"databases"},t.createDatabase={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","properties","icon","cover","title","description","is_inline"],path:()=>"databases"},t.search={method:"post",pathParams:[],queryParams:[],bodyParams:["sort","query","start_cursor","page_size","filter"],path:()=>"search"},t.createComment={method:"post",pathParams:[],queryParams:[],bodyParams:["parent","rich_text","discussion_id"],path:()=>"comments"},t.listComments={method:"get",pathParams:[],queryParams:["block_id","start_cursor","page_size"],bodyParams:[],path:()=>"comments"},t.oauthToken={method:"post",pathParams:[],queryParams:[],bodyParams:["grant_type","code","redirect_uri","external_account"],path:()=>"oauth/token"},t.oauthRevoke={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/revoke"},t.oauthIntrospect={method:"post",pathParams:[],queryParams:[],bodyParams:["token"],path:()=>"oauth/introspect"}},6471:(e,t,r)=>{"use strict";var n,s;Object.defineProperty(t,"__esModule",{value:!0}),t.buildRequestError=t.APIResponseError=t.UnknownHTTPResponseError=t.isHTTPResponseError=t.RequestTimeoutError=t.isNotionClientError=t.ClientErrorCode=t.APIErrorCode=void 0;let a=r(4128);!function(e){e.Unauthorized="unauthorized",e.RestrictedResource="restricted_resource",e.ObjectNotFound="object_not_found",e.RateLimited="rate_limited",e.InvalidJSON="invalid_json",e.InvalidRequestURL="invalid_request_url",e.InvalidRequest="invalid_request",e.ValidationError="validation_error",e.ConflictError="conflict_error",e.InternalServerError="internal_server_error",e.ServiceUnavailable="service_unavailable"}(n=t.APIErrorCode||(t.APIErrorCode={})),function(e){e.RequestTimeout="notionhq_client_request_timeout",e.ResponseError="notionhq_client_response_error"}(s=t.ClientErrorCode||(t.ClientErrorCode={}));class i extends Error{}function o(e){return(0,a.isObject)(e)&&e instanceof i}function l(e,t){return o(e)&&e.code in t}t.isNotionClientError=o;class c extends i{constructor(e="Request to Notion API has timed out"){super(e),this.code=s.RequestTimeout,this.name="RequestTimeoutError"}static isRequestTimeoutError(e){return l(e,{[s.RequestTimeout]:!0})}static rejectAfterTimeout(e,t){return new Promise((r,n)=>{let s=setTimeout(()=>{n(new c)},t);e.then(r).catch(n).then(()=>clearTimeout(s))})}}t.RequestTimeoutError=c;class u extends i{constructor(e){super(e.message),this.name="HTTPResponseError";let{code:t,status:r,headers:n,rawBodyText:s}=e;this.code=t,this.status=r,this.headers=n,this.body=s}}let d={[s.ResponseError]:!0,[n.Unauthorized]:!0,[n.RestrictedResource]:!0,[n.ObjectNotFound]:!0,[n.RateLimited]:!0,[n.InvalidJSON]:!0,[n.InvalidRequestURL]:!0,[n.InvalidRequest]:!0,[n.ValidationError]:!0,[n.ConflictError]:!0,[n.InternalServerError]:!0,[n.ServiceUnavailable]:!0};t.isHTTPResponseError=function(e){return!!l(e,d)};class h extends u{constructor(e){var t;super({...e,code:s.ResponseError,message:null!==(t=e.message)&&void 0!==t?t:`Request to Notion API failed with status: ${e.status}`}),this.name="UnknownHTTPResponseError"}static isUnknownHTTPResponseError(e){return l(e,{[s.ResponseError]:!0})}}t.UnknownHTTPResponseError=h;let p={[n.Unauthorized]:!0,[n.RestrictedResource]:!0,[n.ObjectNotFound]:!0,[n.RateLimited]:!0,[n.InvalidJSON]:!0,[n.InvalidRequestURL]:!0,[n.InvalidRequest]:!0,[n.ValidationError]:!0,[n.ConflictError]:!0,[n.InternalServerError]:!0,[n.ServiceUnavailable]:!0};class f extends u{constructor(){super(...arguments),this.name="APIResponseError"}static isAPIResponseError(e){return l(e,p)}}t.APIResponseError=f,t.buildRequestError=function(e,t){let r=function(e){var t;let r;if("string"==typeof e){try{r=JSON.parse(e)}catch(e){return}if((0,a.isObject)(r)&&"string"==typeof r.message&&"string"==typeof(t=r.code)&&t in p)return{...r,code:r.code,message:r.message}}}(t);return void 0!==r?new f({code:r.code,message:r.message,headers:e.headers,status:e.status,rawBodyText:t}):new h({message:void 0,headers:e.headers,status:e.status,rawBodyText:t})}},544:(e,t)=>{"use strict";async function*r(e,t){let r=t.start_cursor;do{let n=await e({...t,start_cursor:r});yield*n.results,r=n.next_cursor}while(r)}async function n(e,t){let n=[];for await(let s of r(e,t))n.push(s);return n}function s(e){return"page"===e.object&&"url"in e}function a(e){return"database"===e.object&&"title"in e}Object.defineProperty(t,"__esModule",{value:!0}),t.isMentionRichTextItemResponse=t.isEquationRichTextItemResponse=t.isTextRichTextItemResponse=t.isFullComment=t.isFullUser=t.isFullPageOrDatabase=t.isFullDatabase=t.isFullPage=t.isFullBlock=t.collectPaginatedAPI=t.iteratePaginatedAPI=void 0,t.iteratePaginatedAPI=r,t.collectPaginatedAPI=n,t.isFullBlock=function(e){return"block"===e.object&&"type"in e},t.isFullPage=s,t.isFullDatabase=a,t.isFullPageOrDatabase=function(e){return"database"===e.object?a(e):s(e)},t.isFullUser=function(e){return"type"in e},t.isFullComment=function(e){return"created_by"in e},t.isTextRichTextItemResponse=function(e){return"text"===e.type},t.isEquationRichTextItemResponse=function(e){return"equation"===e.type},t.isMentionRichTextItemResponse=function(e){return"mention"===e.type}},7672:(e,t,r)=>{"use strict";t.KU=void 0;var n=r(7806);Object.defineProperty(t,"KU",{enumerable:!0,get:function(){return n.default}}),r(7227),r(6471),r(544)},7227:(e,t,r)=>{"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0}),t.logLevelSeverity=t.makeConsoleLogger=t.LogLevel=void 0;let s=r(4128);!function(e){e.DEBUG="debug",e.INFO="info",e.WARN="warn",e.ERROR="error"}(n=t.LogLevel||(t.LogLevel={})),t.makeConsoleLogger=function(e){return(t,r,n)=>{console[t](`${e} ${t}:`,r,n)}},t.logLevelSeverity=function(e){switch(e){case n.DEBUG:return 20;case n.INFO:return 40;case n.WARN:return 60;case n.ERROR:return 80;default:return(0,s.assertNever)(e)}}},4128:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.isObject=t.pick=t.assertNever=void 0,t.assertNever=function(e){throw Error(`Unexpected value should never occur: ${e}`)},t.pick=function(e,t){let r=t.map(t=>[t,null==e?void 0:e[t]]);return Object.fromEntries(r)},t.isObject=function(e){return"object"==typeof e&&null!==e}},525:e=>{"use strict";var t=Object.defineProperty,r=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,s=Object.prototype.hasOwnProperty,a={};function i(e){var t;let r=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean);return`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}; ${r.join("; ")}`}function o(e){let t=new Map;for(let r of e.split(/; */)){if(!r)continue;let e=r.indexOf("=");if(-1===e){t.set(r,"true");continue}let[n,s]=[r.slice(0,e),r.slice(e+1)];try{t.set(n,decodeURIComponent(null!=s?s:"true"))}catch{}}return t}function l(e){var t,r;if(!e)return;let[[n,s],...a]=o(e),{domain:i,expires:l,httponly:d,maxage:h,path:p,samesite:f,secure:m,priority:g}=Object.fromEntries(a.map(([e,t])=>[e.toLowerCase(),t])),y={name:n,value:decodeURIComponent(s),domain:i,...l&&{expires:new Date(l)},...d&&{httpOnly:!0},..."string"==typeof h&&{maxAge:Number(h)},path:p,...f&&{sameSite:c.includes(t=(t=f).toLowerCase())?t:void 0},...m&&{secure:!0},...g&&{priority:u.includes(r=(r=g).toLowerCase())?r:void 0}};return function(e){let t={};for(let r in e)e[r]&&(t[r]=e[r]);return t}(y)}((e,r)=>{for(var n in r)t(e,n,{get:r[n],enumerable:!0})})(a,{RequestCookies:()=>d,ResponseCookies:()=>h,parseCookie:()=>o,parseSetCookie:()=>l,stringifyCookie:()=>i}),e.exports=((e,a,i,o)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let i of n(a))s.call(e,i)||void 0===i||t(e,i,{get:()=>a[i],enumerable:!(o=r(a,i))||o.enumerable});return e})(t({},"__esModule",{value:!0}),a);var c=["strict","lax","none"],u=["low","medium","high"],d=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t){let e=o(t);for(let[t,r]of e)this._parsed.set(t,{name:t,value:r})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed);if(!e.length)return r.map(([e,t])=>t);let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(([e])=>e===n).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,r]=1===e.length?[e[0].name,e[0].value]:e,n=this._parsed;return n.set(t,{name:t,value:r}),this._headers.set("cookie",Array.from(n).map(([e,t])=>i(t)).join("; ")),this}delete(e){let t=this._parsed,r=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>i(t)).join("; ")),r}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},h=class{constructor(e){var t,r,n;this._parsed=new Map,this._headers=e;let s=null!=(n=null!=(r=null==(t=e.getSetCookie)?void 0:t.call(e))?r:e.get("set-cookie"))?n:[],a=Array.isArray(s)?s:function(e){if(!e)return[];var t,r,n,s,a,i=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,a=!1;l();)if(","===(r=e.charAt(o))){for(n=o,o+=1,l(),s=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(a=!0,o=s,i.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!a||o>=e.length)&&i.push(e.substring(t,e.length))}return i}(s);for(let e of a){let t=l(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let r=Array.from(this._parsed.values());if(!e.length)return r;let n="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return r.filter(e=>e.name===n)}has(e){return this._parsed.has(e)}set(...e){let[t,r,n]=1===e.length?[e[0].name,e[0].value,e[0]]:e,s=this._parsed;return s.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:r,...n})),function(e,t){for(let[,r]of(t.delete("set-cookie"),e)){let e=i(r);t.append("set-cookie",e)}}(s,this._headers),this}delete(...e){let[t,r,n]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:r,domain:n,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(i).join("; ")}}},4578:(e,t,r)=>{"use strict";(()=>{var t={491:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ContextAPI=void 0;let n=r(223),s=r(172),a=r(930),i="context",o=new n.NoopContextManager;class l{constructor(){}static getInstance(){return this._instance||(this._instance=new l),this._instance}setGlobalContextManager(e){return(0,s.registerGlobal)(i,e,a.DiagAPI.instance())}active(){return this._getContextManager().active()}with(e,t,r,...n){return this._getContextManager().with(e,t,r,...n)}bind(e,t){return this._getContextManager().bind(e,t)}_getContextManager(){return(0,s.getGlobal)(i)||o}disable(){this._getContextManager().disable(),(0,s.unregisterGlobal)(i,a.DiagAPI.instance())}}t.ContextAPI=l},930:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagAPI=void 0;let n=r(56),s=r(912),a=r(957),i=r(172);class o{constructor(){function e(e){return function(...t){let r=(0,i.getGlobal)("diag");if(r)return r[e](...t)}}let t=this;t.setLogger=(e,r={logLevel:a.DiagLogLevel.INFO})=>{var n,o,l;if(e===t){let e=Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(n=e.stack)&&void 0!==n?n:e.message),!1}"number"==typeof r&&(r={logLevel:r});let c=(0,i.getGlobal)("diag"),u=(0,s.createLogLevelDiagLogger)(null!==(o=r.logLevel)&&void 0!==o?o:a.DiagLogLevel.INFO,e);if(c&&!r.suppressOverrideMessage){let e=null!==(l=Error().stack)&&void 0!==l?l:"<failed to generate stacktrace>";c.warn(`Current logger will be overwritten from ${e}`),u.warn(`Current logger will overwrite one already registered from ${e}`)}return(0,i.registerGlobal)("diag",u,t,!0)},t.disable=()=>{(0,i.unregisterGlobal)("diag",t)},t.createComponentLogger=e=>new n.DiagComponentLogger(e),t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}static instance(){return this._instance||(this._instance=new o),this._instance}}t.DiagAPI=o},653:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.MetricsAPI=void 0;let n=r(660),s=r(172),a=r(930),i="metrics";class o{constructor(){}static getInstance(){return this._instance||(this._instance=new o),this._instance}setGlobalMeterProvider(e){return(0,s.registerGlobal)(i,e,a.DiagAPI.instance())}getMeterProvider(){return(0,s.getGlobal)(i)||n.NOOP_METER_PROVIDER}getMeter(e,t,r){return this.getMeterProvider().getMeter(e,t,r)}disable(){(0,s.unregisterGlobal)(i,a.DiagAPI.instance())}}t.MetricsAPI=o},181:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PropagationAPI=void 0;let n=r(172),s=r(874),a=r(194),i=r(277),o=r(369),l=r(930),c="propagation",u=new s.NoopTextMapPropagator;class d{constructor(){this.createBaggage=o.createBaggage,this.getBaggage=i.getBaggage,this.getActiveBaggage=i.getActiveBaggage,this.setBaggage=i.setBaggage,this.deleteBaggage=i.deleteBaggage}static getInstance(){return this._instance||(this._instance=new d),this._instance}setGlobalPropagator(e){return(0,n.registerGlobal)(c,e,l.DiagAPI.instance())}inject(e,t,r=a.defaultTextMapSetter){return this._getGlobalPropagator().inject(e,t,r)}extract(e,t,r=a.defaultTextMapGetter){return this._getGlobalPropagator().extract(e,t,r)}fields(){return this._getGlobalPropagator().fields()}disable(){(0,n.unregisterGlobal)(c,l.DiagAPI.instance())}_getGlobalPropagator(){return(0,n.getGlobal)(c)||u}}t.PropagationAPI=d},997:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceAPI=void 0;let n=r(172),s=r(846),a=r(139),i=r(607),o=r(930),l="trace";class c{constructor(){this._proxyTracerProvider=new s.ProxyTracerProvider,this.wrapSpanContext=a.wrapSpanContext,this.isSpanContextValid=a.isSpanContextValid,this.deleteSpan=i.deleteSpan,this.getSpan=i.getSpan,this.getActiveSpan=i.getActiveSpan,this.getSpanContext=i.getSpanContext,this.setSpan=i.setSpan,this.setSpanContext=i.setSpanContext}static getInstance(){return this._instance||(this._instance=new c),this._instance}setGlobalTracerProvider(e){let t=(0,n.registerGlobal)(l,this._proxyTracerProvider,o.DiagAPI.instance());return t&&this._proxyTracerProvider.setDelegate(e),t}getTracerProvider(){return(0,n.getGlobal)(l)||this._proxyTracerProvider}getTracer(e,t){return this.getTracerProvider().getTracer(e,t)}disable(){(0,n.unregisterGlobal)(l,o.DiagAPI.instance()),this._proxyTracerProvider=new s.ProxyTracerProvider}}t.TraceAPI=c},277:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.deleteBaggage=t.setBaggage=t.getActiveBaggage=t.getBaggage=void 0;let n=r(491),s=r(780),a=(0,s.createContextKey)("OpenTelemetry Baggage Key");function i(e){return e.getValue(a)||void 0}t.getBaggage=i,t.getActiveBaggage=function(){return i(n.ContextAPI.getInstance().active())},t.setBaggage=function(e,t){return e.setValue(a,t)},t.deleteBaggage=function(e){return e.deleteValue(a)}},993:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaggageImpl=void 0;class r{constructor(e){this._entries=e?new Map(e):new Map}getEntry(e){let t=this._entries.get(e);if(t)return Object.assign({},t)}getAllEntries(){return Array.from(this._entries.entries()).map(([e,t])=>[e,t])}setEntry(e,t){let n=new r(this._entries);return n._entries.set(e,t),n}removeEntry(e){let t=new r(this._entries);return t._entries.delete(e),t}removeEntries(...e){let t=new r(this._entries);for(let r of e)t._entries.delete(r);return t}clear(){return new r}}t.BaggageImpl=r},830:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataSymbol=void 0,t.baggageEntryMetadataSymbol=Symbol("BaggageEntryMetadata")},369:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.baggageEntryMetadataFromString=t.createBaggage=void 0;let n=r(930),s=r(993),a=r(830),i=n.DiagAPI.instance();t.createBaggage=function(e={}){return new s.BaggageImpl(new Map(Object.entries(e)))},t.baggageEntryMetadataFromString=function(e){return"string"!=typeof e&&(i.error(`Cannot create baggage metadata from unknown type: ${typeof e}`),e=""),{__TYPE__:a.baggageEntryMetadataSymbol,toString:()=>e}}},67:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.context=void 0;let n=r(491);t.context=n.ContextAPI.getInstance()},223:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopContextManager=void 0;let n=r(780);class s{active(){return n.ROOT_CONTEXT}with(e,t,r,...n){return t.call(r,...n)}bind(e,t){return t}enable(){return this}disable(){return this}}t.NoopContextManager=s},780:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ROOT_CONTEXT=t.createContextKey=void 0,t.createContextKey=function(e){return Symbol.for(e)};class r{constructor(e){let t=this;t._currentContext=e?new Map(e):new Map,t.getValue=e=>t._currentContext.get(e),t.setValue=(e,n)=>{let s=new r(t._currentContext);return s._currentContext.set(e,n),s},t.deleteValue=e=>{let n=new r(t._currentContext);return n._currentContext.delete(e),n}}}t.ROOT_CONTEXT=new r},506:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.diag=void 0;let n=r(930);t.diag=n.DiagAPI.instance()},56:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagComponentLogger=void 0;let n=r(172);class s{constructor(e){this._namespace=e.namespace||"DiagComponentLogger"}debug(...e){return a("debug",this._namespace,e)}error(...e){return a("error",this._namespace,e)}info(...e){return a("info",this._namespace,e)}warn(...e){return a("warn",this._namespace,e)}verbose(...e){return a("verbose",this._namespace,e)}}function a(e,t,r){let s=(0,n.getGlobal)("diag");if(s)return r.unshift(t),s[e](...r)}t.DiagComponentLogger=s},972:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagConsoleLogger=void 0;let r=[{n:"error",c:"error"},{n:"warn",c:"warn"},{n:"info",c:"info"},{n:"debug",c:"debug"},{n:"verbose",c:"trace"}];class n{constructor(){for(let e=0;e<r.length;e++)this[r[e].n]=function(e){return function(...t){if(console){let r=console[e];if("function"!=typeof r&&(r=console.log),"function"==typeof r)return r.apply(console,t)}}}(r[e].c)}}t.DiagConsoleLogger=n},912:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createLogLevelDiagLogger=void 0;let n=r(957);t.createLogLevelDiagLogger=function(e,t){function r(r,n){let s=t[r];return"function"==typeof s&&e>=n?s.bind(t):function(){}}return e<n.DiagLogLevel.NONE?e=n.DiagLogLevel.NONE:e>n.DiagLogLevel.ALL&&(e=n.DiagLogLevel.ALL),t=t||{},{error:r("error",n.DiagLogLevel.ERROR),warn:r("warn",n.DiagLogLevel.WARN),info:r("info",n.DiagLogLevel.INFO),debug:r("debug",n.DiagLogLevel.DEBUG),verbose:r("verbose",n.DiagLogLevel.VERBOSE)}}},957:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DiagLogLevel=void 0,function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(t.DiagLogLevel||(t.DiagLogLevel={}))},172:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.unregisterGlobal=t.getGlobal=t.registerGlobal=void 0;let n=r(200),s=r(521),a=r(130),i=s.VERSION.split(".")[0],o=Symbol.for(`opentelemetry.js.api.${i}`),l=n._globalThis;t.registerGlobal=function(e,t,r,n=!1){var a;let i=l[o]=null!==(a=l[o])&&void 0!==a?a:{version:s.VERSION};if(!n&&i[e]){let t=Error(`@opentelemetry/api: Attempted duplicate registration of API: ${e}`);return r.error(t.stack||t.message),!1}if(i.version!==s.VERSION){let t=Error(`@opentelemetry/api: Registration of version v${i.version} for ${e} does not match previously registered API v${s.VERSION}`);return r.error(t.stack||t.message),!1}return i[e]=t,r.debug(`@opentelemetry/api: Registered a global for ${e} v${s.VERSION}.`),!0},t.getGlobal=function(e){var t,r;let n=null===(t=l[o])||void 0===t?void 0:t.version;if(n&&(0,a.isCompatible)(n))return null===(r=l[o])||void 0===r?void 0:r[e]},t.unregisterGlobal=function(e,t){t.debug(`@opentelemetry/api: Unregistering a global for ${e} v${s.VERSION}.`);let r=l[o];r&&delete r[e]}},130:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isCompatible=t._makeCompatibilityCheck=void 0;let n=r(521),s=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;function a(e){let t=new Set([e]),r=new Set,n=e.match(s);if(!n)return()=>!1;let a={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};if(null!=a.prerelease)return function(t){return t===e};function i(e){return r.add(e),!1}return function(e){if(t.has(e))return!0;if(r.has(e))return!1;let n=e.match(s);if(!n)return i(e);let o={major:+n[1],minor:+n[2],patch:+n[3],prerelease:n[4]};return null!=o.prerelease||a.major!==o.major?i(e):0===a.major?a.minor===o.minor&&a.patch<=o.patch?(t.add(e),!0):i(e):a.minor<=o.minor?(t.add(e),!0):i(e)}}t._makeCompatibilityCheck=a,t.isCompatible=a(n.VERSION)},886:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.metrics=void 0;let n=r(653);t.metrics=n.MetricsAPI.getInstance()},901:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ValueType=void 0,function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(t.ValueType||(t.ValueType={}))},102:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createNoopMeter=t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=t.NOOP_OBSERVABLE_GAUGE_METRIC=t.NOOP_OBSERVABLE_COUNTER_METRIC=t.NOOP_UP_DOWN_COUNTER_METRIC=t.NOOP_HISTOGRAM_METRIC=t.NOOP_COUNTER_METRIC=t.NOOP_METER=t.NoopObservableUpDownCounterMetric=t.NoopObservableGaugeMetric=t.NoopObservableCounterMetric=t.NoopObservableMetric=t.NoopHistogramMetric=t.NoopUpDownCounterMetric=t.NoopCounterMetric=t.NoopMetric=t.NoopMeter=void 0;class r{constructor(){}createHistogram(e,r){return t.NOOP_HISTOGRAM_METRIC}createCounter(e,r){return t.NOOP_COUNTER_METRIC}createUpDownCounter(e,r){return t.NOOP_UP_DOWN_COUNTER_METRIC}createObservableGauge(e,r){return t.NOOP_OBSERVABLE_GAUGE_METRIC}createObservableCounter(e,r){return t.NOOP_OBSERVABLE_COUNTER_METRIC}createObservableUpDownCounter(e,r){return t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC}addBatchObservableCallback(e,t){}removeBatchObservableCallback(e){}}t.NoopMeter=r;class n{}t.NoopMetric=n;class s extends n{add(e,t){}}t.NoopCounterMetric=s;class a extends n{add(e,t){}}t.NoopUpDownCounterMetric=a;class i extends n{record(e,t){}}t.NoopHistogramMetric=i;class o{addCallback(e){}removeCallback(e){}}t.NoopObservableMetric=o;class l extends o{}t.NoopObservableCounterMetric=l;class c extends o{}t.NoopObservableGaugeMetric=c;class u extends o{}t.NoopObservableUpDownCounterMetric=u,t.NOOP_METER=new r,t.NOOP_COUNTER_METRIC=new s,t.NOOP_HISTOGRAM_METRIC=new i,t.NOOP_UP_DOWN_COUNTER_METRIC=new a,t.NOOP_OBSERVABLE_COUNTER_METRIC=new l,t.NOOP_OBSERVABLE_GAUGE_METRIC=new c,t.NOOP_OBSERVABLE_UP_DOWN_COUNTER_METRIC=new u,t.createNoopMeter=function(){return t.NOOP_METER}},660:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NOOP_METER_PROVIDER=t.NoopMeterProvider=void 0;let n=r(102);class s{getMeter(e,t,r){return n.NOOP_METER}}t.NoopMeterProvider=s,t.NOOP_METER_PROVIDER=new s},200:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(46),t)},651:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t._globalThis=void 0,t._globalThis="object"==typeof globalThis?globalThis:r.g},46:function(e,t,r){var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),s=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),s(r(651),t)},939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.propagation=void 0;let n=r(181);t.propagation=n.PropagationAPI.getInstance()},874:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTextMapPropagator=void 0;class r{inject(e,t){}extract(e,t){return e}fields(){return[]}}t.NoopTextMapPropagator=r},194:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.defaultTextMapSetter=t.defaultTextMapGetter=void 0,t.defaultTextMapGetter={get(e,t){if(null!=e)return e[t]},keys:e=>null==e?[]:Object.keys(e)},t.defaultTextMapSetter={set(e,t,r){null!=e&&(e[t]=r)}}},845:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.trace=void 0;let n=r(997);t.trace=n.TraceAPI.getInstance()},403:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NonRecordingSpan=void 0;let n=r(476);class s{constructor(e=n.INVALID_SPAN_CONTEXT){this._spanContext=e}spanContext(){return this._spanContext}setAttribute(e,t){return this}setAttributes(e){return this}addEvent(e,t){return this}setStatus(e){return this}updateName(e){return this}end(e){}isRecording(){return!1}recordException(e,t){}}t.NonRecordingSpan=s},614:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracer=void 0;let n=r(491),s=r(607),a=r(403),i=r(139),o=n.ContextAPI.getInstance();class l{startSpan(e,t,r=o.active()){let n=!!(null==t?void 0:t.root);if(n)return new a.NonRecordingSpan;let l=r&&(0,s.getSpanContext)(r);return"object"==typeof l&&"string"==typeof l.spanId&&"string"==typeof l.traceId&&"number"==typeof l.traceFlags&&(0,i.isSpanContextValid)(l)?new a.NonRecordingSpan(l):new a.NonRecordingSpan}startActiveSpan(e,t,r,n){let a,i,l;if(arguments.length<2)return;2==arguments.length?l=t:3==arguments.length?(a=t,l=r):(a=t,i=r,l=n);let c=null!=i?i:o.active(),u=this.startSpan(e,a,c),d=(0,s.setSpan)(c,u);return o.with(d,l,void 0,u)}}t.NoopTracer=l},124:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.NoopTracerProvider=void 0;let n=r(614);class s{getTracer(e,t,r){return new n.NoopTracer}}t.NoopTracerProvider=s},125:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracer=void 0;let n=r(614),s=new n.NoopTracer;class a{constructor(e,t,r,n){this._provider=e,this.name=t,this.version=r,this.options=n}startSpan(e,t,r){return this._getTracer().startSpan(e,t,r)}startActiveSpan(e,t,r,n){let s=this._getTracer();return Reflect.apply(s.startActiveSpan,s,arguments)}_getTracer(){if(this._delegate)return this._delegate;let e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):s}}t.ProxyTracer=a},846:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ProxyTracerProvider=void 0;let n=r(125),s=r(124),a=new s.NoopTracerProvider;class i{getTracer(e,t,r){var s;return null!==(s=this.getDelegateTracer(e,t,r))&&void 0!==s?s:new n.ProxyTracer(this,e,t,r)}getDelegate(){var e;return null!==(e=this._delegate)&&void 0!==e?e:a}setDelegate(e){this._delegate=e}getDelegateTracer(e,t,r){var n;return null===(n=this._delegate)||void 0===n?void 0:n.getTracer(e,t,r)}}t.ProxyTracerProvider=i},996:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SamplingDecision=void 0,function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(t.SamplingDecision||(t.SamplingDecision={}))},607:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getSpanContext=t.setSpanContext=t.deleteSpan=t.setSpan=t.getActiveSpan=t.getSpan=void 0;let n=r(780),s=r(403),a=r(491),i=(0,n.createContextKey)("OpenTelemetry Context Key SPAN");function o(e){return e.getValue(i)||void 0}function l(e,t){return e.setValue(i,t)}t.getSpan=o,t.getActiveSpan=function(){return o(a.ContextAPI.getInstance().active())},t.setSpan=l,t.deleteSpan=function(e){return e.deleteValue(i)},t.setSpanContext=function(e,t){return l(e,new s.NonRecordingSpan(t))},t.getSpanContext=function(e){var t;return null===(t=o(e))||void 0===t?void 0:t.spanContext()}},325:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceStateImpl=void 0;let n=r(564);class s{constructor(e){this._internalState=new Map,e&&this._parse(e)}set(e,t){let r=this._clone();return r._internalState.has(e)&&r._internalState.delete(e),r._internalState.set(e,t),r}unset(e){let t=this._clone();return t._internalState.delete(e),t}get(e){return this._internalState.get(e)}serialize(){return this._keys().reduce((e,t)=>(e.push(t+"="+this.get(t)),e),[]).join(",")}_parse(e){!(e.length>512)&&(this._internalState=e.split(",").reverse().reduce((e,t)=>{let r=t.trim(),s=r.indexOf("=");if(-1!==s){let a=r.slice(0,s),i=r.slice(s+1,t.length);(0,n.validateKey)(a)&&(0,n.validateValue)(i)&&e.set(a,i)}return e},new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))}_keys(){return Array.from(this._internalState.keys()).reverse()}_clone(){let e=new s;return e._internalState=new Map(this._internalState),e}}t.TraceStateImpl=s},564:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.validateValue=t.validateKey=void 0;let r="[_0-9a-z-*/]",n=`[a-z]${r}{0,255}`,s=`[a-z0-9]${r}{0,240}@[a-z]${r}{0,13}`,a=RegExp(`^(?:${n}|${s})$`),i=/^[ -~]{0,255}[!-~]$/,o=/,|=/;t.validateKey=function(e){return a.test(e)},t.validateValue=function(e){return i.test(e)&&!o.test(e)}},98:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createTraceState=void 0;let n=r(325);t.createTraceState=function(e){return new n.TraceStateImpl(e)}},476:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.INVALID_SPAN_CONTEXT=t.INVALID_TRACEID=t.INVALID_SPANID=void 0;let n=r(475);t.INVALID_SPANID="0000000000000000",t.INVALID_TRACEID="00000000000000000000000000000000",t.INVALID_SPAN_CONTEXT={traceId:t.INVALID_TRACEID,spanId:t.INVALID_SPANID,traceFlags:n.TraceFlags.NONE}},357:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanKind=void 0,function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(t.SpanKind||(t.SpanKind={}))},139:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.wrapSpanContext=t.isSpanContextValid=t.isValidSpanId=t.isValidTraceId=void 0;let n=r(476),s=r(403),a=/^([0-9a-f]{32})$/i,i=/^[0-9a-f]{16}$/i;function o(e){return a.test(e)&&e!==n.INVALID_TRACEID}function l(e){return i.test(e)&&e!==n.INVALID_SPANID}t.isValidTraceId=o,t.isValidSpanId=l,t.isSpanContextValid=function(e){return o(e.traceId)&&l(e.spanId)},t.wrapSpanContext=function(e){return new s.NonRecordingSpan(e)}},847:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SpanStatusCode=void 0,function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(t.SpanStatusCode||(t.SpanStatusCode={}))},475:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TraceFlags=void 0,function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(t.TraceFlags||(t.TraceFlags={}))},521:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.VERSION=void 0,t.VERSION="1.6.0"}},n={};function s(e){var r=n[e];if(void 0!==r)return r.exports;var a=n[e]={exports:{}},i=!0;try{t[e].call(a.exports,a,a.exports,s),i=!1}finally{i&&delete n[e]}return a.exports}s.ab="//";var a={};(()=>{Object.defineProperty(a,"__esModule",{value:!0}),a.trace=a.propagation=a.metrics=a.diag=a.context=a.INVALID_SPAN_CONTEXT=a.INVALID_TRACEID=a.INVALID_SPANID=a.isValidSpanId=a.isValidTraceId=a.isSpanContextValid=a.createTraceState=a.TraceFlags=a.SpanStatusCode=a.SpanKind=a.SamplingDecision=a.ProxyTracerProvider=a.ProxyTracer=a.defaultTextMapSetter=a.defaultTextMapGetter=a.ValueType=a.createNoopMeter=a.DiagLogLevel=a.DiagConsoleLogger=a.ROOT_CONTEXT=a.createContextKey=a.baggageEntryMetadataFromString=void 0;var e=s(369);Object.defineProperty(a,"baggageEntryMetadataFromString",{enumerable:!0,get:function(){return e.baggageEntryMetadataFromString}});var t=s(780);Object.defineProperty(a,"createContextKey",{enumerable:!0,get:function(){return t.createContextKey}}),Object.defineProperty(a,"ROOT_CONTEXT",{enumerable:!0,get:function(){return t.ROOT_CONTEXT}});var r=s(972);Object.defineProperty(a,"DiagConsoleLogger",{enumerable:!0,get:function(){return r.DiagConsoleLogger}});var n=s(957);Object.defineProperty(a,"DiagLogLevel",{enumerable:!0,get:function(){return n.DiagLogLevel}});var i=s(102);Object.defineProperty(a,"createNoopMeter",{enumerable:!0,get:function(){return i.createNoopMeter}});var o=s(901);Object.defineProperty(a,"ValueType",{enumerable:!0,get:function(){return o.ValueType}});var l=s(194);Object.defineProperty(a,"defaultTextMapGetter",{enumerable:!0,get:function(){return l.defaultTextMapGetter}}),Object.defineProperty(a,"defaultTextMapSetter",{enumerable:!0,get:function(){return l.defaultTextMapSetter}});var c=s(125);Object.defineProperty(a,"ProxyTracer",{enumerable:!0,get:function(){return c.ProxyTracer}});var u=s(846);Object.defineProperty(a,"ProxyTracerProvider",{enumerable:!0,get:function(){return u.ProxyTracerProvider}});var d=s(996);Object.defineProperty(a,"SamplingDecision",{enumerable:!0,get:function(){return d.SamplingDecision}});var h=s(357);Object.defineProperty(a,"SpanKind",{enumerable:!0,get:function(){return h.SpanKind}});var p=s(847);Object.defineProperty(a,"SpanStatusCode",{enumerable:!0,get:function(){return p.SpanStatusCode}});var f=s(475);Object.defineProperty(a,"TraceFlags",{enumerable:!0,get:function(){return f.TraceFlags}});var m=s(98);Object.defineProperty(a,"createTraceState",{enumerable:!0,get:function(){return m.createTraceState}});var g=s(139);Object.defineProperty(a,"isSpanContextValid",{enumerable:!0,get:function(){return g.isSpanContextValid}}),Object.defineProperty(a,"isValidTraceId",{enumerable:!0,get:function(){return g.isValidTraceId}}),Object.defineProperty(a,"isValidSpanId",{enumerable:!0,get:function(){return g.isValidSpanId}});var y=s(476);Object.defineProperty(a,"INVALID_SPANID",{enumerable:!0,get:function(){return y.INVALID_SPANID}}),Object.defineProperty(a,"INVALID_TRACEID",{enumerable:!0,get:function(){return y.INVALID_TRACEID}}),Object.defineProperty(a,"INVALID_SPAN_CONTEXT",{enumerable:!0,get:function(){return y.INVALID_SPAN_CONTEXT}});let v=s(67);Object.defineProperty(a,"context",{enumerable:!0,get:function(){return v.context}});let b=s(506);Object.defineProperty(a,"diag",{enumerable:!0,get:function(){return b.diag}});let w=s(886);Object.defineProperty(a,"metrics",{enumerable:!0,get:function(){return w.metrics}});let _=s(939);Object.defineProperty(a,"propagation",{enumerable:!0,get:function(){return _.propagation}});let E=s(845);Object.defineProperty(a,"trace",{enumerable:!0,get:function(){return E.trace}}),a.default={context:v.context,diag:b.diag,metrics:w.metrics,propagation:_.propagation,trace:E.trace}})(),e.exports=a})()},1843:e=>{"use strict";(()=>{"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//");var t={};(()=>{/*!
 * cookie
 * Copyright(c) 2012-2014 Roman Shtylman
 * Copyright(c) 2015 Douglas Christopher Wilson
 * MIT Licensed
 */t.parse=function(t,r){if("string"!=typeof t)throw TypeError("argument str must be a string");for(var s={},a=t.split(n),i=(r||{}).decode||e,o=0;o<a.length;o++){var l=a[o],c=l.indexOf("=");if(!(c<0)){var u=l.substr(0,c).trim(),d=l.substr(++c,l.length).trim();'"'==d[0]&&(d=d.slice(1,-1)),void 0==s[u]&&(s[u]=function(e,t){try{return t(e)}catch(t){return e}}(d,i))}}return s},t.serialize=function(e,t,n){var a=n||{},i=a.encode||r;if("function"!=typeof i)throw TypeError("option encode is invalid");if(!s.test(e))throw TypeError("argument name is invalid");var o=i(t);if(o&&!s.test(o))throw TypeError("argument val is invalid");var l=e+"="+o;if(null!=a.maxAge){var c=a.maxAge-0;if(isNaN(c)||!isFinite(c))throw TypeError("option maxAge is invalid");l+="; Max-Age="+Math.floor(c)}if(a.domain){if(!s.test(a.domain))throw TypeError("option domain is invalid");l+="; Domain="+a.domain}if(a.path){if(!s.test(a.path))throw TypeError("option path is invalid");l+="; Path="+a.path}if(a.expires){if("function"!=typeof a.expires.toUTCString)throw TypeError("option expires is invalid");l+="; Expires="+a.expires.toUTCString()}if(a.httpOnly&&(l+="; HttpOnly"),a.secure&&(l+="; Secure"),a.sameSite)switch("string"==typeof a.sameSite?a.sameSite.toLowerCase():a.sameSite){case!0:case"strict":l+="; SameSite=Strict";break;case"lax":l+="; SameSite=Lax";break;case"none":l+="; SameSite=None";break;default:throw TypeError("option sameSite is invalid")}return l};var e=decodeURIComponent,r=encodeURIComponent,n=/; */,s=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/})(),e.exports=t})()},5895:e=>{"use strict";(()=>{var t={806:(e,t,r)=>{let n=r(190),s=Symbol("max"),a=Symbol("length"),i=Symbol("lengthCalculator"),o=Symbol("allowStale"),l=Symbol("maxAge"),c=Symbol("dispose"),u=Symbol("noDisposeOnSet"),d=Symbol("lruList"),h=Symbol("cache"),p=Symbol("updateAgeOnGet"),f=()=>1;class m{constructor(e){if("number"==typeof e&&(e={max:e}),e||(e={}),e.max&&("number"!=typeof e.max||e.max<0))throw TypeError("max must be a non-negative number");this[s]=e.max||1/0;let t=e.length||f;if(this[i]="function"!=typeof t?f:t,this[o]=e.stale||!1,e.maxAge&&"number"!=typeof e.maxAge)throw TypeError("maxAge must be a number");this[l]=e.maxAge||0,this[c]=e.dispose,this[u]=e.noDisposeOnSet||!1,this[p]=e.updateAgeOnGet||!1,this.reset()}set max(e){if("number"!=typeof e||e<0)throw TypeError("max must be a non-negative number");this[s]=e||1/0,v(this)}get max(){return this[s]}set allowStale(e){this[o]=!!e}get allowStale(){return this[o]}set maxAge(e){if("number"!=typeof e)throw TypeError("maxAge must be a non-negative number");this[l]=e,v(this)}get maxAge(){return this[l]}set lengthCalculator(e){"function"!=typeof e&&(e=f),e!==this[i]&&(this[i]=e,this[a]=0,this[d].forEach(e=>{e.length=this[i](e.value,e.key),this[a]+=e.length})),v(this)}get lengthCalculator(){return this[i]}get length(){return this[a]}get itemCount(){return this[d].length}rforEach(e,t){t=t||this;for(let r=this[d].tail;null!==r;){let n=r.prev;_(this,e,r,t),r=n}}forEach(e,t){t=t||this;for(let r=this[d].head;null!==r;){let n=r.next;_(this,e,r,t),r=n}}keys(){return this[d].toArray().map(e=>e.key)}values(){return this[d].toArray().map(e=>e.value)}reset(){this[c]&&this[d]&&this[d].length&&this[d].forEach(e=>this[c](e.key,e.value)),this[h]=new Map,this[d]=new n,this[a]=0}dump(){return this[d].map(e=>!y(this,e)&&{k:e.key,v:e.value,e:e.now+(e.maxAge||0)}).toArray().filter(e=>e)}dumpLru(){return this[d]}set(e,t,r){if((r=r||this[l])&&"number"!=typeof r)throw TypeError("maxAge must be a number");let n=r?Date.now():0,o=this[i](t,e);if(this[h].has(e)){if(o>this[s])return b(this,this[h].get(e)),!1;let i=this[h].get(e),l=i.value;return this[c]&&!this[u]&&this[c](e,l.value),l.now=n,l.maxAge=r,l.value=t,this[a]+=o-l.length,l.length=o,this.get(e),v(this),!0}let p=new w(e,t,o,n,r);return p.length>this[s]?(this[c]&&this[c](e,t),!1):(this[a]+=p.length,this[d].unshift(p),this[h].set(e,this[d].head),v(this),!0)}has(e){if(!this[h].has(e))return!1;let t=this[h].get(e).value;return!y(this,t)}get(e){return g(this,e,!0)}peek(e){return g(this,e,!1)}pop(){let e=this[d].tail;return e?(b(this,e),e.value):null}del(e){b(this,this[h].get(e))}load(e){this.reset();let t=Date.now();for(let r=e.length-1;r>=0;r--){let n=e[r],s=n.e||0;if(0===s)this.set(n.k,n.v);else{let e=s-t;e>0&&this.set(n.k,n.v,e)}}}prune(){this[h].forEach((e,t)=>g(this,t,!1))}}let g=(e,t,r)=>{let n=e[h].get(t);if(n){let t=n.value;if(y(e,t)){if(b(e,n),!e[o])return}else r&&(e[p]&&(n.value.now=Date.now()),e[d].unshiftNode(n));return t.value}},y=(e,t)=>{if(!t||!t.maxAge&&!e[l])return!1;let r=Date.now()-t.now;return t.maxAge?r>t.maxAge:e[l]&&r>e[l]},v=e=>{if(e[a]>e[s])for(let t=e[d].tail;e[a]>e[s]&&null!==t;){let r=t.prev;b(e,t),t=r}},b=(e,t)=>{if(t){let r=t.value;e[c]&&e[c](r.key,r.value),e[a]-=r.length,e[h].delete(r.key),e[d].removeNode(t)}};class w{constructor(e,t,r,n,s){this.key=e,this.value=t,this.length=r,this.now=n,this.maxAge=s||0}}let _=(e,t,r,n)=>{let s=r.value;y(e,s)&&(b(e,r),e[o]||(s=void 0)),s&&t.call(n,s.value,s.key,e)};e.exports=m},76:e=>{e.exports=function(e){e.prototype[Symbol.iterator]=function*(){for(let e=this.head;e;e=e.next)yield e.value}}},190:(e,t,r)=>{function n(e){var t=this;if(t instanceof n||(t=new n),t.tail=null,t.head=null,t.length=0,e&&"function"==typeof e.forEach)e.forEach(function(e){t.push(e)});else if(arguments.length>0)for(var r=0,s=arguments.length;r<s;r++)t.push(arguments[r]);return t}function Node(e,t,r,n){if(!(this instanceof Node))return new Node(e,t,r,n);this.list=n,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,r?(r.prev=this,this.next=r):this.next=null}e.exports=n,n.Node=Node,n.create=n,n.prototype.removeNode=function(e){if(e.list!==this)throw Error("removing node which does not belong to this list");var t=e.next,r=e.prev;return t&&(t.prev=r),r&&(r.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=r),e.list.length--,e.next=null,e.prev=null,e.list=null,t},n.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}},n.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}},n.prototype.push=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.tail=new Node(e,this.tail,null,this),this.head||(this.head=this.tail),this.length++;return this.length},n.prototype.unshift=function(){for(var e,t=0,r=arguments.length;t<r;t++)e=arguments[t],this.head=new Node(e,null,this.head,this),this.tail||(this.tail=this.head),this.length++;return this.length},n.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}},n.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}},n.prototype.forEach=function(e,t){t=t||this;for(var r=this.head,n=0;null!==r;n++)e.call(t,r.value,n,this),r=r.next},n.prototype.forEachReverse=function(e,t){t=t||this;for(var r=this.tail,n=this.length-1;null!==r;n--)e.call(t,r.value,n,this),r=r.prev},n.prototype.get=function(e){for(var t=0,r=this.head;null!==r&&t<e;t++)r=r.next;if(t===e&&null!==r)return r.value},n.prototype.getReverse=function(e){for(var t=0,r=this.tail;null!==r&&t<e;t++)r=r.prev;if(t===e&&null!==r)return r.value},n.prototype.map=function(e,t){t=t||this;for(var r=new n,s=this.head;null!==s;)r.push(e.call(t,s.value,this)),s=s.next;return r},n.prototype.mapReverse=function(e,t){t=t||this;for(var r=new n,s=this.tail;null!==s;)r.push(e.call(t,s.value,this)),s=s.prev;return r},n.prototype.reduce=function(e,t){var r,n=this.head;if(arguments.length>1)r=t;else if(this.head)n=this.head.next,r=this.head.value;else throw TypeError("Reduce of empty list with no initial value");for(var s=0;null!==n;s++)r=e(r,n.value,s),n=n.next;return r},n.prototype.reduceReverse=function(e,t){var r,n=this.tail;if(arguments.length>1)r=t;else if(this.tail)n=this.tail.prev,r=this.tail.value;else throw TypeError("Reduce of empty list with no initial value");for(var s=this.length-1;null!==n;s--)r=e(r,n.value,s),n=n.prev;return r},n.prototype.toArray=function(){for(var e=Array(this.length),t=0,r=this.head;null!==r;t++)e[t]=r.value,r=r.next;return e},n.prototype.toArrayReverse=function(){for(var e=Array(this.length),t=0,r=this.tail;null!==r;t++)e[t]=r.value,r=r.prev;return e},n.prototype.slice=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=0,a=this.head;null!==a&&s<e;s++)a=a.next;for(;null!==a&&s<t;s++,a=a.next)r.push(a.value);return r},n.prototype.sliceReverse=function(e,t){(t=t||this.length)<0&&(t+=this.length),(e=e||0)<0&&(e+=this.length);var r=new n;if(t<e||t<0)return r;e<0&&(e=0),t>this.length&&(t=this.length);for(var s=this.length,a=this.tail;null!==a&&s>t;s--)a=a.prev;for(;null!==a&&s>e;s--,a=a.prev)r.push(a.value);return r},n.prototype.splice=function(e,t){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var r=0,n=this.head;null!==n&&r<e;r++)n=n.next;for(var s=[],r=0;n&&r<t;r++)s.push(n.value),n=this.removeNode(n);null===n&&(n=this.tail),n!==this.head&&n!==this.tail&&(n=n.prev);for(var r=2;r<arguments.length;r++)n=function(e,t,r){var n=t===e.head?new Node(r,null,t,e):new Node(r,t,t.next,e);return null===n.next&&(e.tail=n),null===n.prev&&(e.head=n),e.length++,n}(this,n,arguments[r]);return s},n.prototype.reverse=function(){for(var e=this.head,t=this.tail,r=e;null!==r;r=r.prev){var n=r.prev;r.prev=r.next,r.next=n}return this.head=t,this.tail=e,this};try{r(76)(n)}catch(e){}}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},i=!0;try{t[e](a,a.exports,n),i=!1}finally{i&&delete r[e]}return a.exports}n.ab="//";var s=n(806);e.exports=s})()},2087:e=>{"use strict";!function(){var t={114:function(e){function t(e){if("string"!=typeof e)throw TypeError("Path must be a string. Received "+JSON.stringify(e))}function r(e,t){for(var r,n="",s=0,a=-1,i=0,o=0;o<=e.length;++o){if(o<e.length)r=e.charCodeAt(o);else if(47===r)break;else r=47;if(47===r){if(a===o-1||1===i);else if(a!==o-1&&2===i){if(n.length<2||2!==s||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2)){if(n.length>2){var l=n.lastIndexOf("/");if(l!==n.length-1){-1===l?(n="",s=0):s=(n=n.slice(0,l)).length-1-n.lastIndexOf("/"),a=o,i=0;continue}}else if(2===n.length||1===n.length){n="",s=0,a=o,i=0;continue}}t&&(n.length>0?n+="/..":n="..",s=2)}else n.length>0?n+="/"+e.slice(a+1,o):n=e.slice(a+1,o),s=o-a-1;a=o,i=0}else 46===r&&-1!==i?++i:i=-1}return n}var n={resolve:function(){for(var e,n,s="",a=!1,i=arguments.length-1;i>=-1&&!a;i--)i>=0?n=arguments[i]:(void 0===e&&(e=""),n=e),t(n),0!==n.length&&(s=n+"/"+s,a=47===n.charCodeAt(0));return(s=r(s,!a),a)?s.length>0?"/"+s:"/":s.length>0?s:"."},normalize:function(e){if(t(e),0===e.length)return".";var n=47===e.charCodeAt(0),s=47===e.charCodeAt(e.length-1);return(0!==(e=r(e,!n)).length||n||(e="."),e.length>0&&s&&(e+="/"),n)?"/"+e:e},isAbsolute:function(e){return t(e),e.length>0&&47===e.charCodeAt(0)},join:function(){if(0==arguments.length)return".";for(var e,r=0;r<arguments.length;++r){var s=arguments[r];t(s),s.length>0&&(void 0===e?e=s:e+="/"+s)}return void 0===e?".":n.normalize(e)},relative:function(e,r){if(t(e),t(r),e===r||(e=n.resolve(e))===(r=n.resolve(r)))return"";for(var s=1;s<e.length&&47===e.charCodeAt(s);++s);for(var a=e.length,i=a-s,o=1;o<r.length&&47===r.charCodeAt(o);++o);for(var l=r.length-o,c=i<l?i:l,u=-1,d=0;d<=c;++d){if(d===c){if(l>c){if(47===r.charCodeAt(o+d))return r.slice(o+d+1);if(0===d)return r.slice(o+d)}else i>c&&(47===e.charCodeAt(s+d)?u=d:0===d&&(u=0));break}var h=e.charCodeAt(s+d);if(h!==r.charCodeAt(o+d))break;47===h&&(u=d)}var p="";for(d=s+u+1;d<=a;++d)(d===a||47===e.charCodeAt(d))&&(0===p.length?p+="..":p+="/..");return p.length>0?p+r.slice(o+u):(o+=u,47===r.charCodeAt(o)&&++o,r.slice(o))},_makeLong:function(e){return e},dirname:function(e){if(t(e),0===e.length)return".";for(var r=e.charCodeAt(0),n=47===r,s=-1,a=!0,i=e.length-1;i>=1;--i)if(47===(r=e.charCodeAt(i))){if(!a){s=i;break}}else a=!1;return -1===s?n?"/":".":n&&1===s?"//":e.slice(0,s)},basename:function(e,r){if(void 0!==r&&"string"!=typeof r)throw TypeError('"ext" argument must be a string');t(e);var n,s=0,a=-1,i=!0;if(void 0!==r&&r.length>0&&r.length<=e.length){if(r.length===e.length&&r===e)return"";var o=r.length-1,l=-1;for(n=e.length-1;n>=0;--n){var c=e.charCodeAt(n);if(47===c){if(!i){s=n+1;break}}else -1===l&&(i=!1,l=n+1),o>=0&&(c===r.charCodeAt(o)?-1==--o&&(a=n):(o=-1,a=l))}return s===a?a=l:-1===a&&(a=e.length),e.slice(s,a)}for(n=e.length-1;n>=0;--n)if(47===e.charCodeAt(n)){if(!i){s=n+1;break}}else -1===a&&(i=!1,a=n+1);return -1===a?"":e.slice(s,a)},extname:function(e){t(e);for(var r=-1,n=0,s=-1,a=!0,i=0,o=e.length-1;o>=0;--o){var l=e.charCodeAt(o);if(47===l){if(!a){n=o+1;break}continue}-1===s&&(a=!1,s=o+1),46===l?-1===r?r=o:1!==i&&(i=1):-1!==r&&(i=-1)}return -1===r||-1===s||0===i||1===i&&r===s-1&&r===n+1?"":e.slice(r,s)},format:function(e){var t,r;if(null===e||"object"!=typeof e)throw TypeError('The "pathObject" argument must be of type Object. Received type '+typeof e);return t=e.dir||e.root,r=e.base||(e.name||"")+(e.ext||""),t?t===e.root?t+r:t+"/"+r:r},parse:function(e){t(e);var r,n={root:"",dir:"",base:"",ext:"",name:""};if(0===e.length)return n;var s=e.charCodeAt(0),a=47===s;a?(n.root="/",r=1):r=0;for(var i=-1,o=0,l=-1,c=!0,u=e.length-1,d=0;u>=r;--u){if(47===(s=e.charCodeAt(u))){if(!c){o=u+1;break}continue}-1===l&&(c=!1,l=u+1),46===s?-1===i?i=u:1!==d&&(d=1):-1!==i&&(d=-1)}return -1===i||-1===l||0===d||1===d&&i===l-1&&i===o+1?-1!==l&&(0===o&&a?n.base=n.name=e.slice(1,l):n.base=n.name=e.slice(o,l)):(0===o&&a?(n.name=e.slice(1,i),n.base=e.slice(1,l)):(n.name=e.slice(o,i),n.base=e.slice(o,l)),n.ext=e.slice(i,l)),o>0?n.dir=e.slice(0,o-1):a&&(n.dir="/"),n},sep:"/",delimiter:":",win32:null,posix:null};n.posix=n,e.exports=n}},r={};function n(e){var s=r[e];if(void 0!==s)return s.exports;var a=r[e]={exports:{}},i=!0;try{t[e](a,a.exports,n),i=!1}finally{i&&delete r[e]}return a.exports}n.ab="//";var s=n(114);e.exports=s}()},4065:(e,t,r)=>{"use strict";var n=r(1017),s={usingClientEntryPoint:!1,Events:null,Dispatcher:{current:null}};function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(e,t){return"font"===e?"":"string"==typeof t?"use-credentials"===t?t:"":void 0}var o=s.Dispatcher,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentDispatcher;function c(){return l.current.useHostTransitionStatus()}function u(e,t,r){return l.current.useFormState(e,t,r)}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=s,t.createPortal=function(){throw Error(a(448))},t.experimental_useFormState=function(e,t,r){return u(e,t,r)},t.experimental_useFormStatus=function(){return c()},t.flushSync=function(){throw Error(a(449))},t.preconnect=function(e,t){var r=o.current;r&&"string"==typeof e&&(t=t?"string"==typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:null,r.preconnect(e,t))},t.prefetchDNS=function(e){var t=o.current;t&&"string"==typeof e&&t.prefetchDNS(e)},t.preinit=function(e,t){var r=o.current;if(r&&"string"==typeof e&&t&&"string"==typeof t.as){var n=t.as,s=i(n,t.crossOrigin),a="string"==typeof t.integrity?t.integrity:void 0,l="string"==typeof t.fetchPriority?t.fetchPriority:void 0;"style"===n?r.preinitStyle(e,"string"==typeof t.precedence?t.precedence:void 0,{crossOrigin:s,integrity:a,fetchPriority:l}):"script"===n&&r.preinitScript(e,{crossOrigin:s,integrity:a,fetchPriority:l,nonce:"string"==typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){var r=o.current;if(r&&"string"==typeof e){if("object"==typeof t&&null!==t){if(null==t.as||"script"===t.as){var n=i(t.as,t.crossOrigin);r.preinitModuleScript(e,{crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0})}}else null==t&&r.preinitModuleScript(e)}},t.preload=function(e,t){var r=o.current;if(r&&"string"==typeof e&&"object"==typeof t&&null!==t&&"string"==typeof t.as){var n=t.as,s=i(n,t.crossOrigin);r.preload(e,n,{crossOrigin:s,integrity:"string"==typeof t.integrity?t.integrity:void 0,nonce:"string"==typeof t.nonce?t.nonce:void 0,type:"string"==typeof t.type?t.type:void 0,fetchPriority:"string"==typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"==typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"==typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"==typeof t.imageSizes?t.imageSizes:void 0})}},t.preloadModule=function(e,t){var r=o.current;if(r&&"string"==typeof e){if(t){var n=i(t.as,t.crossOrigin);r.preloadModule(e,{as:"string"==typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:n,integrity:"string"==typeof t.integrity?t.integrity:void 0})}else r.preloadModule(e)}},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=u,t.useFormStatus=c,t.version="18.3.0-canary-593ecee66-20231114"},2106:(e,t,r)=>{"use strict";e.exports=r(4065)},6104:(e,t,r)=>{"use strict";var n=r(4939),s=r(2106),a=null,i=0;function o(e,t){if(0!==t.byteLength){if(512<t.byteLength)0<i&&(e.enqueue(new Uint8Array(a.buffer,0,i)),a=new Uint8Array(512),i=0),e.enqueue(t);else{var r=a.length-i;r<t.byteLength&&(0===r?e.enqueue(a):(a.set(t.subarray(0,r),i),e.enqueue(a),t=t.subarray(r)),a=new Uint8Array(512),i=0),a.set(t,i),i+=t.byteLength}}return!0}var l=new TextEncoder,c=Symbol.for("react.client.reference"),u=Symbol.for("react.server.reference");function d(e,t,r){return Object.defineProperties(e,{$$typeof:{value:c},$$id:{value:t},$$async:{value:r}})}var h=Function.prototype.bind,p=Array.prototype.slice;function f(){var e=h.apply(this,arguments);if(this.$$typeof===u){var t=p.call(arguments,1);return Object.defineProperties(e,{$$typeof:{value:u},$$id:{value:this.$$id},$$bound:{value:this.$$bound?this.$$bound.concat(t):t},bind:{value:f}})}return e}var m=Promise.prototype,g={get:function(e,t){switch(t){case"$$typeof":return e.$$typeof;case"$$id":return e.$$id;case"$$async":return e.$$async;case"name":return e.name;case"displayName":case"defaultProps":case"toJSON":return;case Symbol.toPrimitive:return Object.prototype[Symbol.toPrimitive];case"Provider":throw Error("Cannot render a Client Context Provider on the Server. Instead, you can export a Client Component wrapper that itself renders a Client Context Provider.")}throw Error("Cannot access "+String(e.name)+"."+String(t)+" on the server. You cannot dot into a client module from a server component. You can only pass the imported name through.")},set:function(){throw Error("Cannot assign to a client module from a server module.")}};function y(e,t){switch(t){case"$$typeof":return e.$$typeof;case"$$id":return e.$$id;case"$$async":return e.$$async;case"name":return e.name;case"defaultProps":case"toJSON":return;case Symbol.toPrimitive:return Object.prototype[Symbol.toPrimitive];case"__esModule":var r=e.$$id;return e.default=d(function(){throw Error("Attempted to call the default export of "+r+" from the server but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},e.$$id+"#",e.$$async),!0;case"then":if(e.then)return e.then;if(e.$$async)return;var n=d({},e.$$id,!0),s=new Proxy(n,v);return e.status="fulfilled",e.value=s,e.then=d(function(e){return Promise.resolve(e(s))},e.$$id+"#then",!1)}return(n=e[t])||(Object.defineProperty(n=d(function(){throw Error("Attempted to call "+String(t)+"() from the server but "+String(t)+" is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},e.$$id+"#"+t,e.$$async),"name",{value:t}),n=e[t]=new Proxy(n,g)),n}var v={get:function(e,t){return y(e,t)},getOwnPropertyDescriptor:function(e,t){var r=Object.getOwnPropertyDescriptor(e,t);return r||(r={value:y(e,t),writable:!1,configurable:!1,enumerable:!1},Object.defineProperty(e,t,r)),r},getPrototypeOf:function(){return m},set:function(){throw Error("Cannot assign to a client module from a server module.")}};s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Dispatcher;var b="function"==typeof AsyncLocalStorage,w=b?new AsyncLocalStorage:null,_=Symbol.for("react.element"),E=Symbol.for("react.fragment"),S=Symbol.for("react.server_context"),x=Symbol.for("react.forward_ref"),R=(Symbol.for("react.suspense"),Symbol.for("react.suspense_list"),Symbol.for("react.memo")),P=Symbol.for("react.lazy"),A=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.postpone"),Symbol.iterator;var C=null;function T(e,t){if(e!==t){e.context._currentValue=e.parentValue,e=e.parent;var r=t.parent;if(null===e){if(null!==r)throw Error("The stacks must reach the root at the same time. This is a bug in React.")}else{if(null===r)throw Error("The stacks must reach the root at the same time. This is a bug in React.");T(e,r),t.context._currentValue=t.value}}}var O=Error("Suspense Exception: This is not a real error! It's an implementation detail of `use` to interrupt the current render. You must either rethrow it immediately, or move the `use` call outside of the `try/catch` block. Capturing without rethrowing will lead to unexpected behavior.\n\nTo handle async errors, wrap your component in an error boundary, or call the promise's `.catch` method and pass the result to `use`");function I(){}var k=null,N=0,$=null;function M(e){return e._currentValue}function D(){throw Error("This Hook is not supported in Server Components.")}function j(){throw Error("Refreshing the cache is not supported in Server Components.")}var L=Array.isArray;Object.getPrototypeOf;var q=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,U=n.__SECRET_SERVER_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;if(!U)throw Error('The "react" package in this environment is not configured correctly. The "react-server" condition must be enabled in any environment that runs React Server Components.');Object.prototype;var B=JSON.stringify;U.ReactCurrentCache,q.ReactCurrentDispatcher;function F(e){if("fulfilled"===e.status)return e.value;if("rejected"===e.status)throw e.reason;throw e}function H(e,t,r,n,s,a){if(null!=n)throw Error("Refs cannot be used in Server Components, nor passed to Client Components.");if("function"==typeof t)return t.$$typeof===c?[_,t,r,s]:(N=0,$=a,"object"==typeof(s=t(s))&&null!==s&&"function"==typeof s.then?"fulfilled"===s.status?s.value:function(e){switch(e.status){case"fulfilled":case"rejected":break;default:"string"!=typeof e.status&&(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)}))}return{$$typeof:P,_payload:e,_init:F}}(s):s);if("string"==typeof t)return[_,t,r,s];if("symbol"==typeof t)return t===E?s.children:[_,t,r,s];if(null!=t&&"object"==typeof t){if(t.$$typeof===c)return[_,t,r,s];switch(t.$$typeof){case P:return H(e,t=(0,t._init)(t._payload),r,n,s,a);case x:return e=t.render,N=0,$=a,e(s,void 0);case R:return H(e,t.type,r,n,s,a)}}throw Error("Unsupported Server Component type: "+function(e){switch(typeof e){case"string":return JSON.stringify(10>=e.length?e:e.slice(0,10)+"...");case"object":var t;if(L(e))return"[...]";return"Object"===(t=e,e=Object.prototype.toString.call(t).replace(/^\[object (.*)\]$/,function(e,t){return t}))?"{...}":e;case"function":return"function";default:return String(e)}}(t))}var G=new Map;function V(e){var t=globalThis.__next_require__(e);return"function"!=typeof t.then||"fulfilled"===t.status?null:(t.then(function(e){t.status="fulfilled",t.value=e},function(e){t.status="rejected",t.reason=e}),t)}function W(){}function K(e,t,r,n){this.status=e,this.value=t,this.reason=r,this._response=n}function J(e,t){for(var r=0;r<e.length;r++)(0,e[r])(t)}K.prototype=Object.create(Promise.prototype),K.prototype.then=function(e,t){switch("resolved_model"===this.status&&Y(this),this.status){case"fulfilled":e(this.value);break;case"pending":case"blocked":e&&(null===this.value&&(this.value=[]),this.value.push(e)),t&&(null===this.reason&&(this.reason=[]),this.reason.push(t));break;default:t(this.reason)}};var X=null,z=null;function Y(e){var t=X,r=z;X=e,z=null;try{var n=JSON.parse(e.value,e._response._fromJSON);null!==z&&0<z.deps?(z.value=n,e.status="blocked",e.value=null,e.reason=null):(e.status="fulfilled",e.value=n)}catch(t){e.status="rejected",e.reason=t}finally{X=t,z=r}}t.createClientModuleProxy=function(e){return e=d({},e,!1),new Proxy(e,v)}},9545:(e,t,r)=>{"use strict";e.exports=r(6104)},1900:(e,t)=>{"use strict";var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),s=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),o=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.iterator,f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},m=Object.assign,g={};function y(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}function v(){}function b(e,t,r){this.props=e,this.context=t,this.refs=g,this.updater=r||f}y.prototype.isReactComponent={},y.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},y.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=y.prototype;var w=b.prototype=new v;w.constructor=b,m(w,y.prototype),w.isPureReactComponent=!0;var _=Array.isArray,E=Object.prototype.hasOwnProperty,S={current:null},x={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,n){var s,a={},i=null,o=null;if(null!=t)for(s in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(i=""+t.key),t)E.call(t,s)&&!x.hasOwnProperty(s)&&(a[s]=t[s]);var l=arguments.length-2;if(1===l)a.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];a.children=c}if(e&&e.defaultProps)for(s in l=e.defaultProps)void 0===a[s]&&(a[s]=l[s]);return{$$typeof:r,type:e,key:i,ref:o,props:a,_owner:S.current}}function P(e){return"object"==typeof e&&null!==e&&e.$$typeof===r}var A=/\/+/g;function C(e,t){var r,n;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36)}function T(e,t,s){if(null==e)return e;var a=[],i=0;return!function e(t,s,a,i,o){var l,c,u,d=typeof t;("undefined"===d||"boolean"===d)&&(t=null);var h=!1;if(null===t)h=!0;else switch(d){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case r:case n:h=!0}}if(h)return o=o(h=t),t=""===i?"."+C(h,0):i,_(o)?(a="",null!=t&&(a=t.replace(A,"$&/")+"/"),e(o,s,a,"",function(e){return e})):null!=o&&(P(o)&&(l=o,c=a+(!o.key||h&&h.key===o.key?"":(""+o.key).replace(A,"$&/")+"/")+t,o={$$typeof:r,type:l.type,key:c,ref:l.ref,props:l.props,_owner:l._owner}),s.push(o)),1;if(h=0,i=""===i?".":i+":",_(t))for(var f=0;f<t.length;f++){var m=i+C(d=t[f],f);h+=e(d,s,a,m,o)}else if("function"==typeof(m=null===(u=t)||"object"!=typeof u?null:"function"==typeof(u=p&&u[p]||u["@@iterator"])?u:null))for(t=m.call(t),f=0;!(d=t.next()).done;)m=i+C(d=d.value,f++),h+=e(d,s,a,m,o);else if("object"===d)throw Error("Objects are not valid as a React child (found: "+("[object Object]"===(s=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return h}(e,a,"","",function(e){return t.call(s,e,i++)}),a}function O(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var I={current:null};function k(){return new WeakMap}function N(){return{s:0,v:void 0,o:null,p:null}}var $={current:null},M={transition:null};t.Children={map:T,forEach:function(e,t,r){T(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return T(e,function(){t++}),t},toArray:function(e){return T(e,function(e){return e})||[]},only:function(e){if(!P(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=y,t.Fragment=s,t.Profiler=i,t.PureComponent=b,t.StrictMode=a,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentDispatcher:$,ReactCurrentCache:I,ReactCurrentBatchConfig:M,ReactCurrentOwner:S},t.cache=function(e){return function(){var t=I.current;if(!t)return e.apply(null,arguments);var r=t.getCacheForType(k);void 0===(t=r.get(e))&&(t=N(),r.set(e,t)),r=0;for(var n=arguments.length;r<n;r++){var s=arguments[r];if("function"==typeof s||"object"==typeof s&&null!==s){var a=t.o;null===a&&(t.o=a=new WeakMap),void 0===(t=a.get(s))&&(t=N(),a.set(s,t))}else null===(a=t.p)&&(t.p=a=new Map),void 0===(t=a.get(s))&&(t=N(),a.set(s,t))}if(1===t.s)return t.v;if(2===t.s)throw t.v;try{var i=e.apply(null,arguments);return(r=t).s=1,r.v=i}catch(e){throw(i=t).s=2,i.v=e,e}}},t.cloneElement=function(e,t,n){if(null==e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var s=m({},e.props),a=e.key,i=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,o=S.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)E.call(t,c)&&!x.hasOwnProperty(c)&&(s[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)s.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];s.children=l}return{$$typeof:r,type:e.type,key:a,ref:i,props:s,_owner:o}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:o,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=P,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:O}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.unstable_useCacheRefresh=function(){return $.current.useCacheRefresh()},t.use=function(e){return $.current.use(e)},t.useCallback=function(e,t){return $.current.useCallback(e,t)},t.useContext=function(e){return $.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return $.current.useDeferredValue(e,t)},t.useEffect=function(e,t){return $.current.useEffect(e,t)},t.useId=function(){return $.current.useId()},t.useImperativeHandle=function(e,t,r){return $.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return $.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return $.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return $.current.useMemo(e,t)},t.useOptimistic=function(e,t){return $.current.useOptimistic(e,t)},t.useReducer=function(e,t,r){return $.current.useReducer(e,t,r)},t.useRef=function(e){return $.current.useRef(e)},t.useState=function(e){return $.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return $.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return $.current.useTransition()},t.version="18.3.0-canary-593ecee66-20231114"},6021:(e,t)=>{"use strict";var r=Object.assign,n={current:null};function s(){return new Map}if("function"==typeof fetch){var a=fetch,i=function(e,t){var r=n.current;if(!r||t&&t.signal&&t.signal!==r.getCacheSignal())return a(e,t);if("string"!=typeof e||t){var i="string"==typeof e||e instanceof URL?new Request(e,t):e;if("GET"!==i.method&&"HEAD"!==i.method||i.keepalive)return a(e,t);var o=JSON.stringify([i.method,Array.from(i.headers.entries()),i.mode,i.redirect,i.credentials,i.referrer,i.referrerPolicy,i.integrity]);i=i.url}else o='["GET",[],null,"follow",null,null,null,null]',i=e;var l=r.getCacheForType(s);if(void 0===(r=l.get(i)))e=a(e,t),l.set(i,[o,e]);else{for(i=0,l=r.length;i<l;i+=2){var c=r[i+1];if(r[i]===o)return(e=c).then(function(e){return e.clone()})}e=a(e,t),r.push(o,e)}return e.then(function(e){return e.clone()})};r(i,a);try{fetch=i}catch(e){try{globalThis.fetch=i}catch(e){console.warn("React was unable to patch the fetch() function in this environment. Suspensey APIs might not work correctly as a result.")}}}var o={current:null},l={current:null},c=Symbol.for("react.element"),u=Symbol.for("react.portal"),d=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),p=Symbol.for("react.profiler"),f=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.memo"),y=Symbol.for("react.lazy"),v=Symbol.iterator;function b(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var w={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},_={};function E(e,t,r){this.props=e,this.context=t,this.refs=_,this.updater=r||w}function S(){}function x(e,t,r){this.props=e,this.context=t,this.refs=_,this.updater=r||w}E.prototype.isReactComponent={},E.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(b(85));this.updater.enqueueSetState(this,e,t,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},S.prototype=E.prototype;var R=x.prototype=new S;R.constructor=x,r(R,E.prototype),R.isPureReactComponent=!0;var P=Array.isArray,A=Object.prototype.hasOwnProperty,C={key:!0,ref:!0,__self:!0,__source:!0};function T(e){return"object"==typeof e&&null!==e&&e.$$typeof===c}var O=/\/+/g;function I(e,t){var r,n;return"object"==typeof e&&null!==e&&null!=e.key?(r=""+e.key,n={"=":"=0",":":"=2"},"$"+r.replace(/[=:]/g,function(e){return n[e]})):t.toString(36)}function k(e,t,r){if(null==e)return e;var n=[],s=0;return!function e(t,r,n,s,a){var i,o,l,d=typeof t;("undefined"===d||"boolean"===d)&&(t=null);var h=!1;if(null===t)h=!0;else switch(d){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case c:case u:h=!0}}if(h)return a=a(h=t),t=""===s?"."+I(h,0):s,P(a)?(n="",null!=t&&(n=t.replace(O,"$&/")+"/"),e(a,r,n,"",function(e){return e})):null!=a&&(T(a)&&(i=a,o=n+(!a.key||h&&h.key===a.key?"":(""+a.key).replace(O,"$&/")+"/")+t,a={$$typeof:c,type:i.type,key:o,ref:i.ref,props:i.props,_owner:i._owner}),r.push(a)),1;if(h=0,s=""===s?".":s+":",P(t))for(var p=0;p<t.length;p++){var f=s+I(d=t[p],p);h+=e(d,r,n,f,a)}else if("function"==typeof(f=null===(l=t)||"object"!=typeof l?null:"function"==typeof(l=v&&l[v]||l["@@iterator"])?l:null))for(t=f.call(t),p=0;!(d=t.next()).done;)f=s+I(d=d.value,p++),h+=e(d,r,n,f,a);else if("object"===d)throw Error(b(31,"[object Object]"===(r=String(t))?"object with keys {"+Object.keys(t).join(", ")+"}":r));return h}(e,n,"","",function(e){return t.call(r,e,s++)}),n}function N(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){(0===e._status||-1===e._status)&&(e._status=1,e._result=t)},function(t){(0===e._status||-1===e._status)&&(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}function $(){return new WeakMap}function M(){return{s:0,v:void 0,o:null,p:null}}t.Children={map:k,forEach:function(e,t,r){k(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return k(e,function(){t++}),t},toArray:function(e){return k(e,function(e){return e})||[]},only:function(e){if(!T(e))throw Error(b(143));return e}},t.Fragment=d,t.Profiler=p,t.StrictMode=h,t.Suspense=m,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentDispatcher:o,ReactCurrentOwner:l},t.__SECRET_SERVER_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED={ReactCurrentCache:n},t.cache=function(e){return function(){var t=n.current;if(!t)return e.apply(null,arguments);var r=t.getCacheForType($);void 0===(t=r.get(e))&&(t=M(),r.set(e,t)),r=0;for(var s=arguments.length;r<s;r++){var a=arguments[r];if("function"==typeof a||"object"==typeof a&&null!==a){var i=t.o;null===i&&(t.o=i=new WeakMap),void 0===(t=i.get(a))&&(t=M(),i.set(a,t))}else null===(i=t.p)&&(t.p=i=new Map),void 0===(t=i.get(a))&&(t=M(),i.set(a,t))}if(1===t.s)return t.v;if(2===t.s)throw t.v;try{var o=e.apply(null,arguments);return(r=t).s=1,r.v=o}catch(e){throw(o=t).s=2,o.v=e,e}}},t.cloneElement=function(e,t,n){if(null==e)throw Error(b(267,e));var s=r({},e.props),a=e.key,i=e.ref,o=e._owner;if(null!=t){if(void 0!==t.ref&&(i=t.ref,o=l.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(d in t)A.call(t,d)&&!C.hasOwnProperty(d)&&(s[d]=void 0===t[d]&&void 0!==u?u[d]:t[d])}var d=arguments.length-2;if(1===d)s.children=n;else if(1<d){u=Array(d);for(var h=0;h<d;h++)u[h]=arguments[h+2];s.children=u}return{$$typeof:c,type:e.type,key:a,ref:i,props:s,_owner:o}},t.createElement=function(e,t,r){var n,s={},a=null,i=null;if(null!=t)for(n in void 0!==t.ref&&(i=t.ref),void 0!==t.key&&(a=""+t.key),t)A.call(t,n)&&!C.hasOwnProperty(n)&&(s[n]=t[n]);var o=arguments.length-2;if(1===o)s.children=r;else if(1<o){for(var u=Array(o),d=0;d<o;d++)u[d]=arguments[d+2];s.children=u}if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===s[n]&&(s[n]=o[n]);return{$$typeof:c,type:e,key:a,ref:i,props:s,_owner:l.current}},t.createRef=function(){return{current:null}},t.createServerContext=function(){throw Error(b(248))},t.forwardRef=function(e){return{$$typeof:f,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:y,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:g,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){e()},t.use=function(e){return o.current.use(e)},t.useCallback=function(e,t){return o.current.useCallback(e,t)},t.useContext=function(e){return o.current.useContext(e)},t.useDebugValue=function(){},t.useId=function(){return o.current.useId()},t.useMemo=function(e,t){return o.current.useMemo(e,t)},t.version="18.3.0-canary-593ecee66-20231114"},1017:(e,t,r)=>{"use strict";e.exports=r(1900)},4939:(e,t,r)=>{"use strict";e.exports=r(6021)},8625:(e,t,r)=>{"use strict";var n;r.d(t,{ZK:()=>y});let{env:s,stdout:a}=(null==(n=globalThis)?void 0:n.process)??{},i=s&&!s.NO_COLOR&&(s.FORCE_COLOR||(null==a?void 0:a.isTTY)&&!s.CI&&"dumb"!==s.TERM),o=(e,t,r,n)=>{let s=e.substring(0,n)+r,a=e.substring(n+t.length),i=a.indexOf(t);return~i?s+o(a,t,r,i):s+a},l=(e,t,r=e)=>n=>{let s=""+n,a=s.indexOf(t,e.length);return~a?e+o(s,t,r,a)+t:e+s+t},c=i?l("\x1b[1m","\x1b[22m","\x1b[22m\x1b[1m"):String;i&&l("\x1b[2m","\x1b[22m","\x1b[22m\x1b[2m"),i&&l("\x1b[3m","\x1b[23m"),i&&l("\x1b[4m","\x1b[24m"),i&&l("\x1b[7m","\x1b[27m"),i&&l("\x1b[8m","\x1b[28m"),i&&l("\x1b[9m","\x1b[29m"),i&&l("\x1b[30m","\x1b[39m");let u=i?l("\x1b[31m","\x1b[39m"):String,d=i?l("\x1b[32m","\x1b[39m"):String,h=i?l("\x1b[33m","\x1b[39m"):String;i&&l("\x1b[34m","\x1b[39m");let p=i?l("\x1b[35m","\x1b[39m"):String;i&&l("\x1b[38;2;173;127;168m","\x1b[39m"),i&&l("\x1b[36m","\x1b[39m");let f=i?l("\x1b[37m","\x1b[39m"):String;i&&l("\x1b[90m","\x1b[39m"),i&&l("\x1b[40m","\x1b[49m"),i&&l("\x1b[41m","\x1b[49m"),i&&l("\x1b[42m","\x1b[49m"),i&&l("\x1b[43m","\x1b[49m"),i&&l("\x1b[44m","\x1b[49m"),i&&l("\x1b[45m","\x1b[49m"),i&&l("\x1b[46m","\x1b[49m"),i&&l("\x1b[47m","\x1b[49m");let m={wait:f(c("○")),error:u(c("⨯")),warn:h(c("⚠")),ready:"▲",info:f(c(" ")),event:d(c("✓")),trace:p(c("\xbb"))},g={log:"log",warn:"warn",error:"error"};function y(...e){!function(e,...t){(""===t[0]||void 0===t[0])&&1===t.length&&t.shift();let r=e in g?g[e]:"log",n=m[e];0===t.length?console[r](""):console[r](" "+n,...t)}("warn",...e)}},1146:(e,t,r)=>{"use strict";r.d(t,{H4:()=>s,vu:()=>n});let n=[["RSC"],["Next-Router-State-Tree"],["Next-Router-Prefetch"]],s="_rsc"},2306:(e,t,r)=>{"use strict";function n(e,t){if(e.isStaticGeneration&&e.experimental.ppr){if(!e.postpone)throw Error("Invariant: PPR is enabled but the postpone API is unavailable");e.postponeWasTriggered=!0,e.postpone("This page needs to bail out of prerendering at this point because it used "+t+". React throws this special object to indicate where. It should not be caught by your own try/catch. Learn more: https://nextjs.org/docs/messages/ppr-caught-error")}}r.d(t,{j:()=>n})},8036:(e,t,r)=>{"use strict";r.d(t,{Ar:()=>d,BR:()=>g,EX:()=>c,Et:()=>u,Ho:()=>f,JT:()=>l,Qq:()=>a,Sx:()=>i,X_:()=>p,dN:()=>n,hd:()=>o,of:()=>h,y3:()=>s,zt:()=>m});let n="nxtP",s="x-prerender-revalidate",a="x-prerender-revalidate-if-generated",i=".prefetch.rsc",o=".rsc",l=".json",c=".meta",u="x-next-cache-tags",d="x-next-cache-soft-tags",h="x-next-revalidated-tags",p="x-next-revalidate-tag-token",f=256,m="_N_T_",g=31536e3,y={shared:"shared",reactServerComponents:"rsc",serverSideRendering:"ssr",actionBrowser:"action-browser",api:"api",middleware:"middleware",edgeAsset:"edge-asset",appPagesBrowser:"app-pages-browser",appMetadataRoute:"app-metadata-route",appRouteHandler:"app-route-handler"};({...y,GROUP:{server:[y.reactServerComponents,y.actionBrowser,y.appMetadataRoute,y.appRouteHandler],nonClientServerTarget:[y.middleware,y.api],app:[y.reactServerComponents,y.actionBrowser,y.appMetadataRoute,y.appRouteHandler,y.serverSideRendering,y.appPagesBrowser]}})},4210:(e,t,r)=>{"use strict";r.d(t,{B:()=>u});var n=r(1146),s=r(3375),a=r(2896),i=r(1672),o=r(8036);let l="__prerender_bypass";Symbol("__next_preview_data"),Symbol(l);class c{constructor(e,t,r,n){var a;let i=e&&function(e,t){let r=s.h.from(e.headers),n=r.get(o.y3),a=n===t.previewModeId,i=r.has(o.Qq);return{isOnDemandRevalidate:a,revalidateOnlyGenerated:i}}(t,e).isOnDemandRevalidate,c=null==(a=r.get(l))?void 0:a.value;this.isEnabled=!!(!i&&c&&e&&c===e.previewModeId),this._previewModeId=null==e?void 0:e.previewModeId,this._mutableCookies=n}enable(){if(!this._previewModeId)throw Error("Invariant: previewProps missing previewModeId this should never happen");this._mutableCookies.set({name:l,value:this._previewModeId,httpOnly:!0,sameSite:"none",secure:!0,path:"/"})}disable(){this._mutableCookies.set({name:l,value:"",httpOnly:!0,sameSite:"none",secure:!0,path:"/",expires:new Date(0)})}}let u={wrap(e,{req:t,res:r,renderOpts:o},l){let u;function d(e){r&&r.setHeader("Set-Cookie",e)}o&&"previewProps"in o&&(u=o.previewProps);let h={},p={get headers(){return h.headers||(h.headers=function(e){let t=s.h.from(e);for(let e of n.vu)t.delete(e.toString().toLowerCase());return s.h.seal(t)}(t.headers)),h.headers},get cookies(){return h.cookies||(h.cookies=function(e){let t=new i.q(s.h.from(e));return a.Qb.seal(t)}(t.headers)),h.cookies},get mutableCookies(){return h.mutableCookies||(h.mutableCookies=function(e,t){let r=new i.q(s.h.from(e));return a.vr.wrap(r,t)}(t.headers,(null==o?void 0:o.onUpdateCookies)||(r?d:void 0))),h.mutableCookies},get draftMode(){return h.draftMode||(h.draftMode=new c(u,t,this.cookies,this.mutableCookies)),h.draftMode}};return e.run(p,l,p)}}},5123:(e,t,r)=>{"use strict";var n;r.d(t,{x:()=>n}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(n||(n={}))},2483:(e,t,r)=>{"use strict";e.exports=r(2074)},2074:(e,t,r)=>{"use strict";r.d(t,{AppRouteRouteModule:()=>z});var n,s={};r.r(s),r.d(s,{DYNAMIC_ERROR_CODE:()=>R,DynamicServerError:()=>P});var a={};r.r(a),r.d(a,{cookies:()=>L,draftMode:()=>q,headers:()=>j});var i={};r.r(i),r.d(i,{AppRouterContext:()=>W,CacheStates:()=>V,GlobalLayoutRouterContext:()=>J,LayoutRouterContext:()=>K,TemplateContext:()=>X});var o={};r.r(o),r.d(o,{appRouterContext:()=>i});class l{constructor({userland:e,definition:t}){this.userland=e,this.definition=t}}var c=r(4210);let u={wrap(e,{urlPathname:t,renderOpts:r,postpone:n},s){let a=!r.supportsDynamicHTML&&!r.isDraftMode&&!r.isServerAction,i={isStaticGeneration:a,urlPathname:t,pagePath:r.originalPathname,incrementalCache:r.incrementalCache||globalThis.__incrementalCache,isRevalidate:r.isRevalidate,isPrerendering:r.nextExport,fetchCache:r.fetchCache,isOnDemandRevalidate:r.isOnDemandRevalidate,isDraftMode:r.isDraftMode,experimental:r.experimental,postpone:n};return r.store=i,e.run(i,s,i)}};var d=r(2896);function h(){return new Response(null,{status:400})}function p(){return new Response(null,{status:405})}let f=["GET","HEAD","OPTIONS","POST","PUT","DELETE","PATCH"];var m=r(2618),g=r(8581),y=r(9086),v=r(525),b=r(8316);function w(e){let t=new URL(e);return t.host="localhost:3000",t.search="",t.protocol="http",t.toString()}var _=r(4197);function E(e){if("string"!=typeof(null==e?void 0:e.digest))return!1;let[t,r,n,s]=e.digest.split(";",4);return"NEXT_REDIRECT"===t&&("replace"===r||"push"===r)&&"string"==typeof n&&("true"===s||"false"===s)}!function(e){e.push="push",e.replace="replace"}(n||(n={})),r(8625);let S=["HEAD","OPTIONS"],x=["OPTIONS","POST","PUT","DELETE","PATCH"],R="DYNAMIC_SERVER_USAGE";class P extends Error{constructor(e){super("Dynamic server usage: "+e),this.digest=R}}var A=r(3375),C=r(1672),T=r(5326);let O=(0,T.P)();var I=r(2306);let k=(0,T.P)();class N extends Error{constructor(...e){super(...e),this.code="NEXT_STATIC_GEN_BAILOUT"}}function $(e,t){let{dynamic:r,link:n}=t||{};return"Page"+(r?' with `dynamic = "'+r+'"`':"")+" couldn't be rendered statically because it used `"+e+"`."+(n?" See more info here: "+n:"")}let M=(e,t)=>{let r=k.getStore();if(!r)return!1;if(r.forceStatic)return!0;if(r.dynamicShouldError){var n;throw new N($(e,{...t,dynamic:null!=(n=null==t?void 0:t.dynamic)?n:"error"}))}let s=$(e,{...t,link:"https://nextjs.org/docs/messages/dynamic-server-error"});if((0,I.j)(r,e),r.revalidate=0,(null==t?void 0:t.dynamic)||(r.staticPrefetchBailout=!0),r.isStaticGeneration){let t=new P(s);throw r.dynamicUsageDescription=e,r.dynamicUsageStack=t.stack,t}return!1};class D{get isEnabled(){return this._provider.isEnabled}enable(){if(!M("draftMode().enable()"))return this._provider.enable()}disable(){if(!M("draftMode().disable()"))return this._provider.disable()}constructor(e){this._provider=e}}function j(){if(M("headers",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return A.h.seal(new Headers({}));let e=_.F.getStore();if(!e)throw Error("Invariant: headers() expects to have requestAsyncStorage, none available.");return e.headers}function L(){if(M("cookies",{link:"https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering"}))return d.Qb.seal(new C.q(new Headers({})));let e=_.F.getStore();if(!e)throw Error("Invariant: cookies() expects to have requestAsyncStorage, none available.");let t=O.getStore();return t&&(t.isAction||t.isAppRoute)?e.mutableCookies:e.cookies}function q(){let e=_.F.getStore();if(!e)throw Error("Invariant: draftMode() expects to have requestAsyncStorage, none available.");return new D(e.draftMode)}var U=r(9545);let B=U.createClientModuleProxy,F=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js`),{__esModule:H,$$typeof:G}=F;F.default;let V=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js#CacheStates`),W=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js#AppRouterContext`),K=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js#LayoutRouterContext`),J=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js#GlobalLayoutRouterContext`),X=B(String.raw`/workspaces/traceremove-social-bot/node_modules/next/dist/esm/shared/lib/app-router-context.shared-runtime.js#TemplateContext`);class z extends l{static #e=this.sharedModules=o;constructor({userland:e,definition:t,resolvedPagePath:r,nextConfigOutput:n}){if(super({userland:e,definition:t}),this.requestAsyncStorage=_.F,this.staticGenerationAsyncStorage=k,this.serverHooks=s,this.headerHooks=a,this.staticGenerationBailout=M,this.actionAsyncStorage=O,this.resolvedPagePath=r,this.nextConfigOutput=n,this.methods=function(e){let t=f.reduce((t,r)=>({...t,[r]:e[r]??p}),{}),r=new Set(f.filter(t=>e[t])),n=S.filter(e=>!r.has(e));for(let s of n){if("HEAD"===s){if(!e.GET)break;t.HEAD=e.GET,r.add("HEAD");continue}if("OPTIONS"===s){let e=["OPTIONS",...r];!r.has("HEAD")&&r.has("GET")&&e.push("HEAD");let n={Allow:e.sort().join(", ")};t.OPTIONS=()=>new Response(null,{status:204,headers:n}),r.add("OPTIONS");continue}throw Error(`Invariant: should handle all automatic implementable methods, got method: ${s}`)}return t}(e),this.nonStaticMethods=function(e){let t=x.filter(t=>e[t]);return 0!==t.length&&t}(e),this.dynamic=this.userland.dynamic,"export"===this.nextConfigOutput){if(this.dynamic&&"auto"!==this.dynamic){if("force-dynamic"===this.dynamic)throw Error(`export const dynamic = "force-dynamic" on page "${t.pathname}" cannot be used with "output: export". See more info here: https://nextjs.org/docs/advanced-features/static-html-export`)}else this.dynamic="error"}}resolve(e){return f.includes(e)?this.methods[e]:h}async execute(e,t){let r=this.resolve(e.method),n={req:e};n.renderOpts={previewProps:t.prerenderManifest.preview};let s={urlPathname:e.nextUrl.pathname,renderOpts:t.renderOpts};s.renderOpts.fetchCache=this.userland.fetchCache;let a=await this.actionAsyncStorage.run({isAppRoute:!0},()=>c.B.wrap(this.requestAsyncStorage,n,()=>u.wrap(this.staticGenerationAsyncStorage,s,n=>{var s;switch(this.nonStaticMethods&&this.staticGenerationBailout(`non-static methods used ${this.nonStaticMethods.join(", ")}`),this.dynamic){case"force-dynamic":n.forceDynamic=!0,this.staticGenerationBailout("force-dynamic",{dynamic:this.dynamic});break;case"force-static":n.forceStatic=!0;break;case"error":n.dynamicShouldError=!0}n.revalidate??=this.userland.revalidate??!1;let a=function(e,{dynamic:t},r){function n(e){switch(e){case"search":case"searchParams":case"toString":case"href":case"origin":r.staticGenerationBailout(`nextUrl.${e}`);return;default:return}}let s={},a=(e,t)=>{switch(t){case"search":return"";case"searchParams":return s.searchParams||(s.searchParams=new URLSearchParams),s.searchParams;case"url":case"href":return s.url||(s.url=w(e)),s.url;case"toJSON":case"toString":return s.url||(s.url=w(e)),s.toString||(s.toString=()=>s.url),s.toString;case"headers":return s.headers||(s.headers=new Headers),s.headers;case"cookies":return s.headers||(s.headers=new Headers),s.cookies||(s.cookies=new v.RequestCookies(s.headers)),s.cookies;case"clone":return s.url||(s.url=w(e)),()=>new b.c(s.url)}},i=new Proxy(e.nextUrl,{get(e,r){if(n(r),"force-static"===t&&"string"==typeof r){let t=a(e.href,r);if(void 0!==t)return t}let s=e[r];return"function"==typeof s?s.bind(e):s},set:(e,t,r)=>(n(t),e[t]=r,!0)}),o=e=>{switch(e){case"headers":r.headerHooks.headers();return;case"url":case"body":case"blob":case"json":case"text":case"arrayBuffer":case"formData":r.staticGenerationBailout(`request.${e}`);return;default:return}};return new Proxy(e,{get(e,r){if(o(r),"nextUrl"===r)return i;if("force-static"===t&&"string"==typeof r){let t=a(e.url,r);if(void 0!==t)return t}let n=e[r];return"function"==typeof n?n.bind(e):n},set:(e,t,r)=>(o(t),e[t]=r,!0)})}(e,{dynamic:this.dynamic},{headerHooks:this.headerHooks,serverHooks:this.serverHooks,staticGenerationBailout:this.staticGenerationBailout}),i=function(e){let t="/app/";e.includes(t)||(t="\\app\\");let[,...r]=e.split(t),n=t[0]+r.join(t),s=n.split(".").slice(0,-1).join(".");return s}(this.resolvedPagePath);return null==(s=(0,g.Yz)().getRootSpanAttributes())||s.set("next.route",i),(0,g.Yz)().trace(y.PB.runHandler,{spanName:`executing api route (app) ${i}`,attributes:{"next.route":i}},async()=>{var e;(0,m.XH)({serverHooks:this.serverHooks,staticGenerationAsyncStorage:this.staticGenerationAsyncStorage});let s=await r(a,{params:t.params?function(e){let t={};for(let[r,n]of Object.entries(e))void 0!==n&&(t[r]=n);return t}(t.params):void 0});if(!(s instanceof Response))throw Error(`No response is returned from route handler '${this.resolvedPagePath}'. Ensure you return a \`Response\` or a \`NextResponse\` in all branches of your handler.`);t.renderOpts.fetchMetrics=n.fetchMetrics,t.renderOpts.waitUntil=Promise.all(n.pendingRevalidates||[]),(0,m.RQ)(n),t.renderOpts.fetchTags=null==(e=n.tags)?void 0:e.join(",");let i=this.requestAsyncStorage.getStore();if(i&&i.mutableCookies){let e=new Headers(s.headers);if((0,d._5)(e,i.mutableCookies))return new Response(s.body,{status:s.status,statusText:s.statusText,headers:e})}return s})})));if(!(a instanceof Response))return new Response(null,{status:500});if(a.headers.has("x-middleware-rewrite"))throw Error("NextResponse.rewrite() was used in a app route handler, this is not currently supported. Please remove the invocation to continue.");if("1"===a.headers.get("x-middleware-next"))throw Error("NextResponse.next() was used in a app route handler, this is not supported. See here for more info: https://nextjs.org/docs/messages/next-response-next-in-app-route-handler");return a}async handle(e,t){try{let r=await this.execute(e,t);return r}catch(t){let e=function(e){if(E(e)){let t=E(e)?e.digest.split(";",3)[2]:null;if(!t)throw Error("Invariant: Unexpected redirect url format");let r=function(e){if(!E(e))throw Error("Not a redirect error");return"true"===e.digest.split(";",4)[3]?308:307}(e);return function(e,t,r){let n=new Headers({location:e});return(0,d._5)(n,t),new Response(null,{status:r,headers:n})}(t,e.mutableCookies,r)}return(null==e?void 0:e.digest)==="NEXT_NOT_FOUND"&&new Response(null,{status:404})}(t);if(!e)throw t;return e}}}},2618:(e,t,r)=>{"use strict";r.d(t,{RQ:()=>u,XH:()=>h});var n=r(9086),s=r(8581),a=r(8036),i=r(8625),o=r(2306),l=r(6195).Buffer;let c=e=>{let t=["/layout"];if(e.startsWith("/")){let r=e.split("/");for(let e=1;e<r.length+1;e++){let n=r.slice(0,e).join("/");n&&(n.endsWith("/page")||n.endsWith("/route")||(n=`${n}${n.endsWith("/")?"":"/"}layout`),t.push(n))}}return t};function u(e){var t,r;let n=[],{pagePath:s,urlPathname:i}=e;if(Array.isArray(e.tags)||(e.tags=[]),s){let r=c(s);for(let s of r)s=`${a.zt}${s}`,(null==(t=e.tags)?void 0:t.includes(s))||e.tags.push(s),n.push(s)}if(i){let t=new URL(i,"http://n").pathname,s=`${a.zt}${t}`;(null==(r=e.tags)?void 0:r.includes(s))||e.tags.push(s),n.push(s)}return n}function d(e,t){if(!e)return;e.fetchMetrics||(e.fetchMetrics=[]);let r=["url","status","method"];e.fetchMetrics.some(e=>r.every(r=>e[r]===t[r]))||e.fetchMetrics.push({url:t.url,cacheStatus:t.cacheStatus,cacheReason:t.cacheReason,status:t.status,method:t.method,start:t.start,end:Date.now(),idx:e.nextFetchId||0})}function h({serverHooks:e,staticGenerationAsyncStorage:t}){if(globalThis._nextOriginalFetch||(globalThis._nextOriginalFetch=globalThis.fetch),globalThis.fetch.__nextPatched)return;let{DynamicServerError:r}=e,c=globalThis._nextOriginalFetch;globalThis.fetch=async(e,h)=>{var p,f;let m;try{(m=new URL(e instanceof Request?e.url:e)).username="",m.password=""}catch{m=void 0}let g=(null==m?void 0:m.href)??"",y=Date.now(),v=(null==h?void 0:null==(p=h.method)?void 0:p.toUpperCase())||"GET",b=(null==(f=null==h?void 0:h.next)?void 0:f.internal)===!0;return await (0,s.Yz)().trace(b?n.Xy.internalFetch:n.k0.fetch,{kind:s.MU.CLIENT,spanName:["fetch",v,g].filter(Boolean).join(" "),attributes:{"http.url":g,"http.method":v,"net.peer.name":null==m?void 0:m.hostname,"net.peer.port":(null==m?void 0:m.port)||void 0}},async()=>{var n;let s,p,f;let m=t.getStore()||(null==fetch.__nextGetStaticStore?void 0:fetch.__nextGetStaticStore.call(fetch)),v=e&&"object"==typeof e&&"string"==typeof e.method,w=t=>(v?e[t]:null)||(null==h?void 0:h[t]);if(!m||b||m.isDraftMode)return c(e,h);let _=t=>{var r,n,s;return void 0!==(null==h?void 0:null==(r=h.next)?void 0:r[t])?null==h?void 0:null==(n=h.next)?void 0:n[t]:v?null==(s=e.next)?void 0:s[t]:void 0},E=_("revalidate"),S=function(e,t){let r=[],n=[];for(let t of e)"string"!=typeof t?n.push({tag:t,reason:"invalid type, must be a string"}):t.length>a.Ho?n.push({tag:t,reason:`exceeded max length of ${a.Ho}`}):r.push(t);if(n.length>0)for(let{tag:e,reason:r}of(console.warn(`Warning: invalid tags passed to ${t}: `),n))console.log(`tag: "${e}" ${r}`);return r}(_("tags")||[],`fetch ${e.toString()}`);if(Array.isArray(S))for(let e of(m.tags||(m.tags=[]),S))m.tags.includes(e)||m.tags.push(e);let x=u(m),R="only-cache"===m.fetchCache,P="force-cache"===m.fetchCache,A="default-cache"===m.fetchCache,C="default-no-store"===m.fetchCache,T="only-no-store"===m.fetchCache,O="force-no-store"===m.fetchCache,I=w("cache"),k="";"string"==typeof I&&void 0!==E&&(v&&"default"===I||i.ZK(`fetch for ${g} on ${m.urlPathname} specified "cache: ${I}" and "revalidate: ${E}", only one should be specified.`),I=void 0),"force-cache"===I?E=!1:("no-cache"===I||"no-store"===I||O||T)&&(E=0),("no-cache"===I||"no-store"===I)&&(k=`cache: ${I}`),("number"==typeof E||!1===E)&&(f=E);let N=w("headers"),$="function"==typeof(null==N?void 0:N.get)?N:new Headers(N||{}),M=$.get("authorization")||$.get("cookie"),D=!["get","head"].includes((null==(n=w("method"))?void 0:n.toLowerCase())||"get"),j=(M||D)&&0===m.revalidate;if(O&&(k="fetchCache = force-no-store"),T){if("force-cache"===I||void 0!==f&&(!1===f||f>0))throw Error(`cache: 'force-cache' used on fetch for ${g} with 'export const fetchCache = 'only-no-store'`);k="fetchCache = only-no-store"}if(R&&"no-store"===I)throw Error(`cache: 'no-store' used on fetch for ${g} with 'export const fetchCache = 'only-cache'`);P&&(void 0===E||0===E)&&(k="fetchCache = force-cache",f=!1),void 0===f?A?(f=!1,k="fetchCache = default-cache"):j?(f=0,k="auto no cache"):C?(f=0,k="fetchCache = default-no-store"):(k="auto cache",f="boolean"!=typeof m.revalidate&&void 0!==m.revalidate&&m.revalidate):k||(k=`revalidate: ${f}`),!j&&(void 0===m.revalidate||"number"==typeof f&&(!1===m.revalidate||"number"==typeof m.revalidate&&f<m.revalidate))&&(0===f&&(0,o.j)(m,"revalidate: 0"),m.revalidate=f);let L="number"==typeof f&&f>0||!1===f;if(m.incrementalCache&&L)try{s=await m.incrementalCache.fetchCacheKey(g,v?e:h)}catch(t){console.error("Failed to generate cache key for",e)}let q=m.nextFetchId??1;m.nextFetchId=q+1;let U="number"!=typeof f?a.BR:f,B=async(t,r)=>{let n=["cache","credentials","headers","integrity","keepalive","method","mode","redirect","referrer","referrerPolicy","window","duplex",...t?[]:["signal"]];if(v){let t=e,r={body:t._ogBody||t.body};for(let e of n)r[e]=t[e];e=new Request(t.url,r)}else if(h){let e=h;for(let t of(h={body:h._ogBody||h.body},n))h[t]=e[t]}let a={...h,next:{...null==h?void 0:h.next,fetchType:"origin",fetchIdx:q}};return c(e,a).then(async n=>{if(t||d(m,{start:y,url:g,cacheReason:r||k,cacheStatus:0===f||r?"skip":"miss",status:n.status,method:a.method||"GET"}),200===n.status&&m.incrementalCache&&s&&L){let t=l.from(await n.arrayBuffer());try{await m.incrementalCache.set(s,{kind:"FETCH",data:{headers:Object.fromEntries(n.headers.entries()),body:t.toString("base64"),status:n.status,url:n.url},revalidate:U},{fetchCache:!0,revalidate:f,fetchUrl:g,fetchIdx:q,tags:S})}catch(t){console.warn("Failed to set fetch cache",e,t)}let r=new Response(t,{headers:new Headers(n.headers),status:n.status});return Object.defineProperty(r,"url",{value:n.url}),r}return n})},F=()=>Promise.resolve();if(s&&m.incrementalCache){F=await m.incrementalCache.lock(s);let e=m.isOnDemandRevalidate?null:await m.incrementalCache.get(s,{kindHint:"fetch",revalidate:f,fetchUrl:g,fetchIdx:q,tags:S,softTags:x});if(e?await F():p="cache-control: no-cache (hard refresh)",(null==e?void 0:e.value)&&"FETCH"===e.value.kind&&!(m.isRevalidate&&e.isStale)){e.isStale&&(m.pendingRevalidates||(m.pendingRevalidates=[]),m.pendingRevalidates.push(B(!0).catch(console.error)));let t=e.value.data;d(m,{start:y,url:g,cacheReason:k,cacheStatus:"hit",status:t.status||200,method:(null==h?void 0:h.method)||"GET"});let r=new Response(l.from(t.body,"base64"),{headers:t.headers,status:t.status});return Object.defineProperty(r,"url",{value:e.value.data.url}),r}}if(m.isStaticGeneration&&h&&"object"==typeof h){let{cache:t}=h;if(delete h.cache,"no-store"===t){let t=`no-store fetch ${e}${m.urlPathname?` ${m.urlPathname}`:""}`,n=new r(t);m.dynamicUsageErr=n,m.dynamicUsageStack=n.stack,m.dynamicUsageDescription=t,(0,o.j)(m,t),m.revalidate=0}let n="next"in h,{next:s={}}=h;if("number"==typeof s.revalidate&&(void 0===m.revalidate||"number"==typeof m.revalidate&&s.revalidate<m.revalidate)){let t=m.forceDynamic;if(!t&&0===s.revalidate){let t=`revalidate: 0 fetch ${e}${m.urlPathname?` ${m.urlPathname}`:""}`,n=new r(t);m.dynamicUsageErr=n,m.dynamicUsageStack=n.stack,m.dynamicUsageDescription=t,(0,o.j)(m,t)}t&&0===s.revalidate||(m.revalidate=s.revalidate)}n&&delete h.next}return B(!1,p).finally(F)})},globalThis.fetch.__nextGetStaticStore=()=>t,globalThis.fetch.__nextPatched=!0}},9086:(e,t,r)=>{"use strict";var n,s,a,i,o,l,c,u,d,h,p;r.d(t,{PB:()=>h,Xy:()=>i,k0:()=>c,lw:()=>f}),function(e){e.handleRequest="BaseServer.handleRequest",e.run="BaseServer.run",e.pipe="BaseServer.pipe",e.getStaticHTML="BaseServer.getStaticHTML",e.render="BaseServer.render",e.renderToResponseWithComponents="BaseServer.renderToResponseWithComponents",e.renderToResponse="BaseServer.renderToResponse",e.renderToHTML="BaseServer.renderToHTML",e.renderError="BaseServer.renderError",e.renderErrorToResponse="BaseServer.renderErrorToResponse",e.renderErrorToHTML="BaseServer.renderErrorToHTML",e.render404="BaseServer.render404"}(n||(n={})),function(e){e.loadDefaultErrorComponents="LoadComponents.loadDefaultErrorComponents",e.loadComponents="LoadComponents.loadComponents"}(s||(s={})),function(e){e.getRequestHandler="NextServer.getRequestHandler",e.getServer="NextServer.getServer",e.getServerRequestHandler="NextServer.getServerRequestHandler",e.createServer="createServer.createServer"}(a||(a={})),function(e){e.compression="NextNodeServer.compression",e.getBuildId="NextNodeServer.getBuildId",e.generateStaticRoutes="NextNodeServer.generateStaticRoutes",e.generateFsStaticRoutes="NextNodeServer.generateFsStaticRoutes",e.generatePublicRoutes="NextNodeServer.generatePublicRoutes",e.generateImageRoutes="NextNodeServer.generateImageRoutes.route",e.sendRenderResult="NextNodeServer.sendRenderResult",e.proxyRequest="NextNodeServer.proxyRequest",e.runApi="NextNodeServer.runApi",e.render="NextNodeServer.render",e.renderHTML="NextNodeServer.renderHTML",e.imageOptimizer="NextNodeServer.imageOptimizer",e.getPagePath="NextNodeServer.getPagePath",e.getRoutesManifest="NextNodeServer.getRoutesManifest",e.findPageComponents="NextNodeServer.findPageComponents",e.getFontManifest="NextNodeServer.getFontManifest",e.getServerComponentManifest="NextNodeServer.getServerComponentManifest",e.getRequestHandler="NextNodeServer.getRequestHandler",e.renderToHTML="NextNodeServer.renderToHTML",e.renderError="NextNodeServer.renderError",e.renderErrorToHTML="NextNodeServer.renderErrorToHTML",e.render404="NextNodeServer.render404",e.route="route",e.onProxyReq="onProxyReq",e.apiResolver="apiResolver",e.internalFetch="internalFetch"}(i||(i={})),(o||(o={})).startServer="startServer.startServer",function(e){e.getServerSideProps="Render.getServerSideProps",e.getStaticProps="Render.getStaticProps",e.renderToString="Render.renderToString",e.renderDocument="Render.renderDocument",e.createBodyResult="Render.createBodyResult"}(l||(l={})),function(e){e.renderToString="AppRender.renderToString",e.renderToReadableStream="AppRender.renderToReadableStream",e.getBodyResult="AppRender.getBodyResult",e.fetch="AppRender.fetch"}(c||(c={})),(u||(u={})).executeRoute="Router.executeRoute",(d||(d={})).runHandler="Node.runHandler",(h||(h={})).runHandler="AppRouteRouteHandlers.runHandler",function(e){e.generateMetadata="ResolveMetadata.generateMetadata",e.generateViewport="ResolveMetadata.generateViewport"}(p||(p={}));let f=["BaseServer.handleRequest","Render.getServerSideProps","Render.getStaticProps","AppRender.fetch","AppRender.getBodyResult","Render.renderDocument","Node.runHandler","AppRouteRouteHandlers.runHandler","ResolveMetadata.generateMetadata","ResolveMetadata.generateViewport"]},8581:(e,t,r)=>{"use strict";let n;r.d(t,{MU:()=>c,Yz:()=>v});var s=r(9086);n=r(4578);let{context:a,propagation:i,trace:o,SpanStatusCode:l,SpanKind:c,ROOT_CONTEXT:u}=n,d=e=>null!==e&&"object"==typeof e&&"function"==typeof e.then,h=(e,t)=>{(null==t?void 0:t.bubble)===!0?e.setAttribute("next.bubble",!0):(t&&e.recordException(t),e.setStatus({code:l.ERROR,message:null==t?void 0:t.message})),e.end()},p=new Map,f=n.createContextKey("next.rootSpanId"),m=0,g=()=>m++;class y{getTracerInstance(){return o.getTracer("next.js","0.0.1")}getContext(){return a}getActiveScopeSpan(){return o.getSpan(null==a?void 0:a.active())}withPropagatedContext(e,t){if(a.active()!==u)return t();let r=i.extract(u,e.headers);return a.with(r,t)}trace(...e){var t;let[r,n,i]=e,{fn:l,options:c}="function"==typeof n?{fn:n,options:{}}:{fn:i,options:{...n}};if(!s.lw.includes(r)&&"1"!==process.env.NEXT_OTEL_VERBOSE||c.hideSpan)return l();let m=c.spanName??r,y=this.getSpanContext((null==c?void 0:c.parentSpan)??this.getActiveScopeSpan()),v=!1;y?(null==(t=o.getSpanContext(y))?void 0:t.isRemote)&&(v=!0):(y=u,v=!0);let b=g();return c.attributes={"next.span_name":m,"next.span_type":r,...c.attributes},a.with(y.setValue(f,b),()=>this.getTracerInstance().startActiveSpan(m,c,e=>{let t=()=>{p.delete(b)};v&&p.set(b,new Map(Object.entries(c.attributes??{})));try{if(l.length>1)return l(e,t=>h(e,t));let r=l(e);return d(r)?r.then(()=>e.end(),t=>h(e,t)).finally(t):(e.end(),t()),r}catch(r){throw h(e,r),t(),r}}))}wrap(...e){let t=this,[r,n,i]=3===e.length?e:[e[0],{},e[1]];return s.lw.includes(r)||"1"===process.env.NEXT_OTEL_VERBOSE?function(){let e=n;"function"==typeof e&&"function"==typeof i&&(e=e.apply(this,arguments));let s=arguments.length-1,o=arguments[s];if("function"!=typeof o)return t.trace(r,e,()=>i.apply(this,arguments));{let n=t.getContext().bind(a.active(),o);return t.trace(r,e,(e,t)=>(arguments[s]=function(e){return null==t||t(e),n.apply(this,arguments)},i.apply(this,arguments)))}}:i}startSpan(...e){let[t,r]=e,n=this.getSpanContext((null==r?void 0:r.parentSpan)??this.getActiveScopeSpan());return this.getTracerInstance().startSpan(t,r,n)}getSpanContext(e){let t=e?o.setSpan(a.active(),e):void 0;return t}getRootSpanAttributes(){let e=a.active().getValue(f);return p.get(e)}}let v=(()=>{let e=new y;return()=>e})()},2133:(e,t,r)=>{"use strict";let n,s,a;async function i(){if("_ENTRIES"in globalThis&&_ENTRIES.middleware_instrumentation&&_ENTRIES.middleware_instrumentation.register)try{await _ENTRIES.middleware_instrumentation.register()}catch(e){throw e.message=`An error occurred while loading instrumentation hook: ${e.message}`,e}}r.d(t,{a:()=>ec});let o=null;function l(){return o||(o=i()),o}function c(e){return`The edge runtime does not support Node.js '${e}' module.
Learn More: https://nextjs.org/docs/messages/node-module-in-edge-runtime`}process!==r.g.process&&(process.env=r.g.process.env,r.g.process=process),Object.defineProperty(globalThis,"__import_unsupported",{value:function(e){let t=new Proxy(function(){},{get(t,r){if("then"===r)return{};throw Error(c(e))},construct(){throw Error(c(e))},apply(r,n,s){if("function"==typeof s[0])return s[0](t);throw Error(c(e))}});return new Proxy({},{get:()=>t})},enumerable:!1,configurable:!1}),l();class u extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class d extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class h extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}var p=r(8967);let f=Symbol("response"),m=Symbol("passThrough"),g=Symbol("waitUntil");class y{constructor(e){this[g]=[],this[m]=!1}respondWith(e){this[f]||(this[f]=Promise.resolve(e))}passThroughOnException(){this[m]=!0}waitUntil(e){this[g].push(e)}}class v extends y{constructor(e){super(e.request),this.sourcePage=e.page}get request(){throw new u({page:this.sourcePage})}respondWith(){throw new u({page:this.sourcePage})}}var b=r(8316),w=r(1672);let _=Symbol("internal request");class E extends Request{constructor(e,t={}){let r="string"!=typeof e&&"url"in e?e.url:String(e);(0,p.r4)(r),e instanceof Request?super(e,t):super(r,t);let n=new b.c(r,{headers:(0,p.lb)(this.headers),nextConfig:t.nextConfig});this[_]={cookies:new w.q(this.headers),geo:t.geo||{},ip:t.ip,nextUrl:n,url:n.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[_].cookies}get geo(){return this[_].geo}get ip(){return this[_].ip}get nextUrl(){return this[_].nextUrl}get page(){throw new d}get ua(){throw new h}get url(){return this[_].url}}var S=r(1567);function x(e,t){let r="string"==typeof t?new URL(t):t,n=new URL(e,t),s=r.protocol+"//"+r.host;return n.protocol+"//"+n.host===s?n.toString().replace(s,""):n.toString()}var R=r(1146);r(4474);let P={client:"client",server:"server",edgeServer:"edge-server"};P.client,P.server,P.edgeServer,Symbol("polyfills");let A=["__nextFallback","__nextLocale","__nextInferredLocaleFromDefault","__nextDefaultLocale","__nextIsNotFound",R.H4],C=["__nextDataReq"];function T(e){return e.startsWith("/")?e:"/"+e}var O=r(8036),I=r(4210),k=r(4197);class N extends E{constructor(e){super(e.input,e.init),this.sourcePage=e.page}get request(){throw new u({page:this.sourcePage})}respondWith(){throw new u({page:this.sourcePage})}waitUntil(){throw new u({page:this.sourcePage})}}async function $(e){let t,r;await l();let n=void 0!==self.__BUILD_MANIFEST,s="string"==typeof self.__PRERENDER_MANIFEST?JSON.parse(self.__PRERENDER_MANIFEST):void 0;e.request.url=e.request.url.replace(/\.rsc($|\?)/,"$1");let a=new b.c(e.request.url,{headers:e.request.headers,nextConfig:e.request.nextConfig}),i=[...a.searchParams.keys()];for(let e of i){let t=a.searchParams.getAll(e);if(e!==O.dN&&e.startsWith(O.dN)){let r=e.substring(O.dN.length);for(let e of(a.searchParams.delete(r),t))a.searchParams.append(r,e);a.searchParams.delete(e)}}let o=a.buildId;a.buildId="";let c=e.request.headers["x-nextjs-data"];c&&"/index"===a.pathname&&(a.pathname="/");let u=(0,p.EK)(e.request.headers),d=new Map;if(!n)for(let e of R.vu){let t=e.toString().toLowerCase(),r=u.get(t);r&&(d.set(t,u.get(t)),u.delete(t))}let h=new N({page:e.page,input:(function(e,t){let r="string"==typeof e,n=r?new URL(e):e;for(let e of A)n.searchParams.delete(e);if(t)for(let e of C)n.searchParams.delete(e);return r?n.toString():n})(a,!0).toString(),init:{body:e.request.body,geo:e.request.geo,headers:u,ip:e.request.ip,method:e.request.method,nextConfig:e.request.nextConfig,signal:e.request.signal}});c&&Object.defineProperty(h,"__isData",{enumerable:!1,value:!0}),!globalThis.__incrementalCache&&e.IncrementalCache&&(globalThis.__incrementalCache=new e.IncrementalCache({appDir:!0,fetchCache:!0,minimalMode:!0,fetchCacheKeyPrefix:void 0,dev:!1,requestHeaders:e.request.headers,requestProtocol:"https",getPrerenderManifest:()=>({version:-1,routes:{},dynamicRoutes:{},notFoundRoutes:[],preview:{previewModeId:"development-id"}})}));let f=new v({request:h,page:e.page}),m="/middleware"===e.page||"/src/middleware"===e.page;if((t=m?await I.B.wrap(k.F,{req:h,renderOpts:{onUpdateCookies:e=>{r=e},previewProps:(null==s?void 0:s.preview)||{previewModeId:"development-id",previewModeEncryptionKey:"",previewModeSigningKey:""}}},()=>e.handler(h,f)):await e.handler(h,f))&&!(t instanceof Response))throw TypeError("Expected an instance of Response to be returned");t&&r&&t.headers.set("set-cookie",r);let y=null==t?void 0:t.headers.get("x-middleware-rewrite");if(t&&y){let r=new b.c(y,{forceLocale:!0,headers:e.request.headers,nextConfig:e.request.nextConfig});r.host===h.nextUrl.host&&(r.buildId=o||r.buildId,t.headers.set("x-middleware-rewrite",String(r)));let n=x(String(r),String(a));c&&t.headers.set("x-nextjs-rewrite",n)}let w=null==t?void 0:t.headers.get("Location");if(t&&w&&!n){let r=new b.c(w,{forceLocale:!1,headers:e.request.headers,nextConfig:e.request.nextConfig});t=new Response(t.body,t),r.host===h.nextUrl.host&&(r.buildId=o||r.buildId,t.headers.set("Location",String(r))),c&&(t.headers.delete("Location"),t.headers.set("x-nextjs-redirect",x(String(r),String(a))))}let _=t||S.x.next(),E=_.headers.get("x-middleware-override-headers"),P=[];if(E){for(let[e,t]of d)_.headers.set(`x-middleware-request-${e}`,t),P.push(e);P.length>0&&_.headers.set("x-middleware-override-headers",E+","+P.join(","))}return{response:_,waitUntil:Promise.all(f[g]),fetchMetrics:h.fetchMetrics}}var M=r(5895),D=r.n(M);let j=0,L="x-vercel-cache-tags",q="x-vercel-sc-headers",U="x-vercel-revalidate",B="x-vercel-cache-item-name";class F{static isAvailable(e){return!!(e._requestHeaders["x-vercel-sc-host"]||process.env.SUSPENSE_CACHE_URL)}constructor(e){if(this.debug=!!process.env.NEXT_PRIVATE_DEBUG_CACHE,this.headers={},this.headers["Content-Type"]="application/json",q in e._requestHeaders){let t=JSON.parse(e._requestHeaders[q]);for(let e in t)this.headers[e]=t[e];delete e._requestHeaders[q]}let t=e._requestHeaders["x-vercel-sc-host"]||process.env.SUSPENSE_CACHE_URL,r=e._requestHeaders["x-vercel-sc-basepath"]||process.env.SUSPENSE_CACHE_BASEPATH;process.env.SUSPENSE_CACHE_AUTH_TOKEN&&(this.headers.Authorization=`Bearer ${process.env.SUSPENSE_CACHE_AUTH_TOKEN}`),t?(this.cacheEndpoint=`https://${t}${r||""}`,this.debug&&console.log("using cache endpoint",this.cacheEndpoint)):this.debug&&console.log("no cache endpoint available"),e.maxMemoryCacheSize?n||(this.debug&&console.log("using memory store for fetch cache"),n=new(D())({max:e.maxMemoryCacheSize,length({value:e}){var t;if(!e)return 25;if("REDIRECT"===e.kind)return JSON.stringify(e.props).length;if("IMAGE"===e.kind)throw Error("invariant image should not be incremental-cache");return"FETCH"===e.kind?JSON.stringify(e.data||"").length:"ROUTE"===e.kind?e.body.length:e.html.length+((null==(t=JSON.stringify(e.pageData))?void 0:t.length)||0)}})):this.debug&&console.log("not using memory store for fetch cache")}async revalidateTag(e){if(this.debug&&console.log("revalidateTag",e),Date.now()<j){this.debug&&console.log("rate limited ",j);return}try{let t=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/revalidate?tags=${e}`,{method:"POST",headers:this.headers,next:{internal:!0}});if(429===t.status){let e=t.headers.get("retry-after")||"60000";j=Date.now()+parseInt(e)}if(!t.ok)throw Error(`Request failed with status ${t.status}.`)}catch(t){console.warn(`Failed to revalidate tag ${e}`,t)}}async get(...e){let[t,r={}]=e,{tags:s,softTags:a,kindHint:i,fetchIdx:o,fetchUrl:l}=r;if("fetch"!==i)return null;if(Date.now()<j)return this.debug&&console.log("rate limited"),null;let c=null==n?void 0:n.get(t);if(Date.now()-((null==c?void 0:c.lastModified)||0)>2e3&&(c=void 0),!c&&this.cacheEndpoint)try{let e=Date.now(),r=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/${t}`,{method:"GET",headers:{...this.headers,[B]:l,[L]:(null==s?void 0:s.join(","))||"",[O.Ar]:(null==a?void 0:a.join(","))||""},next:{internal:!0,fetchType:"cache-get",fetchUrl:l,fetchIdx:o}});if(429===r.status){let e=r.headers.get("retry-after")||"60000";j=Date.now()+parseInt(e)}if(404===r.status)return this.debug&&console.log(`no fetch cache entry for ${t}, duration: ${Date.now()-e}ms`),null;if(!r.ok)throw console.error(await r.text()),Error(`invalid response from cache ${r.status}`);let i=await r.json();if(!i||"FETCH"!==i.kind)throw this.debug&&console.log({cached:i}),Error("invalid cache value");let u=r.headers.get("x-vercel-cache-state"),d=r.headers.get("age");c={value:i,lastModified:"fresh"!==u?Date.now()-O.BR:Date.now()-1e3*parseInt(d||"0",10)},this.debug&&console.log(`got fetch cache entry for ${t}, duration: ${Date.now()-e}ms, size: ${Object.keys(i).length}, cache-state: ${u} tags: ${null==s?void 0:s.join(",")} softTags: ${null==a?void 0:a.join(",")}`),c&&(null==n||n.set(t,c))}catch(e){this.debug&&console.error("Failed to get from fetch-cache",e)}return c||null}async set(...e){let[t,r,s]=e,{fetchCache:a,fetchIdx:i,fetchUrl:o,tags:l}=s;if(a){if(Date.now()<j){this.debug&&console.log("rate limited");return}if(null==n||n.set(t,{value:r,lastModified:Date.now()}),this.cacheEndpoint)try{let e=Date.now();null!==r&&"revalidate"in r&&(this.headers[U]=r.revalidate.toString()),!this.headers[U]&&null!==r&&"data"in r&&(this.headers["x-vercel-cache-control"]=r.data.headers["cache-control"]);let n=JSON.stringify({...r,tags:void 0});this.debug&&console.log("set cache",t);let s=await fetch(`${this.cacheEndpoint}/v1/suspense-cache/${t}`,{method:"POST",headers:{...this.headers,[B]:o||"",[L]:(null==l?void 0:l.join(","))||""},body:n,next:{internal:!0,fetchType:"cache-set",fetchUrl:o,fetchIdx:i}});if(429===s.status){let e=s.headers.get("retry-after")||"60000";j=Date.now()+parseInt(e)}if(!s.ok)throw this.debug&&console.log(await s.text()),Error(`invalid response ${s.status}`);this.debug&&console.log(`successfully set to fetch-cache for ${t}, duration: ${Date.now()-e}ms, size: ${n.length}`)}catch(e){this.debug&&console.error("Failed to update fetch cache",e)}}}}var H=r(3763),G=r.n(H);class V{constructor(e){this.fs=e.fs,this.flushToDisk=e.flushToDisk,this.serverDistDir=e.serverDistDir,this.appDir=!!e._appDir,this.pagesDir=!!e._pagesDir,this.revalidatedTags=e.revalidatedTags,this.experimental=e.experimental,e.maxMemoryCacheSize&&!s&&(s=new(D())({max:e.maxMemoryCacheSize,length({value:e}){var t;if(!e)return 25;if("REDIRECT"===e.kind)return JSON.stringify(e.props).length;if("IMAGE"===e.kind)throw Error("invariant image should not be incremental-cache");return"FETCH"===e.kind?JSON.stringify(e.data||"").length:"ROUTE"===e.kind?e.body.length:e.html.length+((null==(t=JSON.stringify(e.pageData))?void 0:t.length)||0)}})),this.serverDistDir&&this.fs&&(this.tagsManifestPath=G().join(this.serverDistDir,"..","cache","fetch-cache","tags-manifest.json"),this.loadTagsManifest())}loadTagsManifest(){if(this.tagsManifestPath&&this.fs&&!a)try{a=JSON.parse(this.fs.readFileSync(this.tagsManifestPath,"utf8"))}catch(e){a={version:1,items:{}}}}async revalidateTag(e){if(this.loadTagsManifest(),!a||!this.tagsManifestPath)return;let t=a.items[e]||{};t.revalidatedAt=Date.now(),a.items[e]=t;try{await this.fs.mkdir(G().dirname(this.tagsManifestPath)),await this.fs.writeFile(this.tagsManifestPath,JSON.stringify(a||{}))}catch(e){console.warn("Failed to update tags manifest.",e)}}async get(...e){var t,r,n;let[i,o={}]=e,{tags:l,softTags:c,kindHint:u}=o,d=null==s?void 0:s.get(i);if((null==d?void 0:null==(t=d.value)?void 0:t.kind)==="PAGE"){let e;let t=null==(n=d.value.headers)?void 0:n[O.Et];if("string"==typeof t&&(e=t.split(",")),null==e?void 0:e.length){this.loadTagsManifest();let t=e.some(e=>{var t;return(null==a?void 0:null==(t=a.items[e])?void 0:t.revalidatedAt)&&(null==a?void 0:a.items[e].revalidatedAt)>=((null==d?void 0:d.lastModified)||Date.now())});t&&(d=void 0)}}if(d&&(null==d?void 0:null==(r=d.value)?void 0:r.kind)==="FETCH"){this.loadTagsManifest();let e=[...l||[],...c||[]],t=e.some(e=>{var t;return!!this.revalidatedTags.includes(e)||(null==a?void 0:null==(t=a.items[e])?void 0:t.revalidatedAt)&&(null==a?void 0:a.items[e].revalidatedAt)>=((null==d?void 0:d.lastModified)||Date.now())});t&&(d=void 0)}return d??null}async set(...e){let[t,r,n]=e;if(null==s||s.set(t,{value:r,lastModified:Date.now()}),this.flushToDisk){if((null==r?void 0:r.kind)==="ROUTE"){let e=this.getFilePath(`${t}.body`,"app");await this.fs.mkdir(G().dirname(e)),await this.fs.writeFile(e,r.body);let n={headers:r.headers,status:r.status,postponed:void 0};await this.fs.writeFile(e.replace(/\.body$/,O.EX),JSON.stringify(n,null,2));return}if((null==r?void 0:r.kind)==="PAGE"){let e="string"==typeof r.pageData,n=this.getFilePath(`${t}.html`,e?"app":"pages");if(await this.fs.mkdir(G().dirname(n)),await this.fs.writeFile(n,r.html),await this.fs.writeFile(this.getFilePath(`${t}${e?this.experimental.ppr?O.Sx:O.hd:O.JT}`,e?"app":"pages"),e?r.pageData:JSON.stringify(r.pageData)),r.headers||r.status){let e={headers:r.headers,status:r.status,postponed:r.postponed};await this.fs.writeFile(n.replace(/\.html$/,O.EX),JSON.stringify(e))}}else if((null==r?void 0:r.kind)==="FETCH"){let e=this.getFilePath(t,"fetch");await this.fs.mkdir(G().dirname(e)),await this.fs.writeFile(e,JSON.stringify({...r,tags:n.tags}))}}}detectFileKind(e){if(!this.appDir&&!this.pagesDir)throw Error("Invariant: Can't determine file path kind, no page directory enabled");if(!this.appDir&&this.pagesDir)return"pages";if(this.appDir&&!this.pagesDir)return"app";let t=this.getFilePath(e,"pages");if(this.fs.existsSync(t))return"pages";if(t=this.getFilePath(e,"app"),this.fs.existsSync(t))return"app";throw Error(`Invariant: Unable to determine file path kind for ${e}`)}getFilePath(e,t){switch(t){case"fetch":return G().join(this.serverDistDir,"..","cache","fetch-cache",e);case"pages":return G().join(this.serverDistDir,"pages",e);case"app":return G().join(this.serverDistDir,"app",e);default:throw Error("Invariant: Can't determine file path kind")}}}let W=["(..)(..)","(.)","(..)","(...)"],K=/\/\[[^/]+?\](?=\/|$)/;function J(e){return void 0!==e.split("/").find(e=>W.find(t=>e.startsWith(t)))&&(e=function(e){let t,r,n;for(let s of e.split("/"))if(r=W.find(e=>s.startsWith(e))){[t,n]=e.split(r,2);break}if(!t||!r||!n)throw Error(`Invalid interception route: ${e}. Must be in the format /<intercepting route>/(..|...|..)(..)/<intercepted route>`);switch(t=T(t.split("/").reduce((e,t,r,n)=>t?"("===t[0]&&t.endsWith(")")||"@"===t[0]||("page"===t||"route"===t)&&r===n.length-1?e:e+"/"+t:e,"")),r){case"(.)":n="/"===t?`/${n}`:t+"/"+n;break;case"(..)":if("/"===t)throw Error(`Invalid interception route: ${e}. Cannot use (..) marker at the root level, use (.) instead.`);n=t.split("/").slice(0,-1).concat(n).join("/");break;case"(...)":n="/"+n;break;case"(..)(..)":let s=t.split("/");if(s.length<=2)throw Error(`Invalid interception route: ${e}. Cannot use (..)(..) marker at the root level or one level up.`);n=s.slice(0,-2).concat(n).join("/");break;default:throw Error("Invariant: unexpected marker")}return{interceptingRoute:t,interceptedRoute:n}}(e).interceptedRoute),K.test(e)}let X="undefined"!=typeof performance;X&&["mark","measure","getEntriesByName"].every(e=>"function"==typeof performance[e]);class z extends Error{}function Y(e){let t=/^\/index(\/|$)/.test(e)&&!J(e)?"/index"+e:"/"===e?"/index":T(e);return t}function Q(e){return e.replace(/\/$/,"").replace(/\/index$/,"")||"/"}class Z{constructor({fs:e,dev:t,appDir:r,pagesDir:n,flushToDisk:s,fetchCache:a,minimalMode:i,serverDistDir:o,requestHeaders:l,requestProtocol:c,maxMemoryCacheSize:u,getPrerenderManifest:d,fetchCacheKeyPrefix:h,CurCacheHandler:p,allowedRevalidateHeaderKeys:f,experimental:m}){var g,y,v,b;this.locks=new Map,this.unlocks=new Map;let w=!!process.env.NEXT_PRIVATE_DEBUG_CACHE;p?w&&console.log("using custom cache handler",p.name):(e&&o&&(w&&console.log("using filesystem cache handler"),p=V),F.isAvailable({_requestHeaders:l})&&i&&a&&(w&&console.log("using fetch cache handler"),p=F)),process.env.__NEXT_TEST_MAX_ISR_CACHE&&(u=parseInt(process.env.__NEXT_TEST_MAX_ISR_CACHE,10)),this.dev=t,this.minimalMode=i,this.requestHeaders=l,this.requestProtocol=c,this.allowedRevalidateHeaderKeys=f,this.prerenderManifest=d(),this.fetchCacheKeyPrefix=h;let _=[];l[O.y3]===(null==(y=this.prerenderManifest)?void 0:null==(g=y.preview)?void 0:g.previewModeId)&&(this.isOnDemandRevalidate=!0),i&&"string"==typeof l[O.of]&&l[O.X_]===(null==(b=this.prerenderManifest)?void 0:null==(v=b.preview)?void 0:v.previewModeId)&&(_=l[O.of].split(",")),p&&(this.cacheHandler=new p({dev:t,fs:e,flushToDisk:s,serverDistDir:o,revalidatedTags:_,maxMemoryCacheSize:u,_pagesDir:!!n,_appDir:!!r,_requestHeaders:l,fetchCacheKeyPrefix:h,experimental:m}))}calculateRevalidate(e,t,r){if(r)return new Date().getTime()-1e3;let{initialRevalidateSeconds:n}=this.prerenderManifest.routes[Q(e)]||{initialRevalidateSeconds:1};return"number"==typeof n?1e3*n+t:n}_getPathname(e,t){return t?e:Y(e)}async unlock(e){let t=this.unlocks.get(e);t&&(t(),this.locks.delete(e),this.unlocks.delete(e))}async lock(e){process.env.__NEXT_INCREMENTAL_CACHE_IPC_PORT&&process.env.__NEXT_INCREMENTAL_CACHE_IPC_KEY;let t=()=>Promise.resolve(),r=this.locks.get(e);if(r)await r;else{let r=new Promise(e=>{t=async()=>{e()}});this.locks.set(e,r),this.unlocks.set(e,t)}return t}async revalidateTag(e){var t,r;return process.env.__NEXT_INCREMENTAL_CACHE_IPC_PORT&&process.env.__NEXT_INCREMENTAL_CACHE_IPC_KEY,null==(r=this.cacheHandler)?void 0:null==(t=r.revalidateTag)?void 0:t.call(r,e)}async fetchCacheKey(e,t={}){let r;let n=[],s=new TextEncoder,a=new TextDecoder;if(t.body){if("function"==typeof t.body.getReader){let e=t.body,r=[];try{await e.pipeTo(new WritableStream({write(e){"string"==typeof e?(r.push(s.encode(e)),n.push(e)):(r.push(e),n.push(a.decode(e,{stream:!0})))}})),n.push(a.decode());let i=r.reduce((e,t)=>e+t.length,0),o=new Uint8Array(i),l=0;for(let e of r)o.set(e,l),l+=e.length;t._ogBody=o}catch(e){console.error("Problem reading body",e)}}else if("function"==typeof t.body.keys){let e=t.body;for(let r of(t._ogBody=t.body,new Set([...e.keys()]))){let t=e.getAll(r);n.push(`${r}=${(await Promise.all(t.map(async e=>"string"==typeof e?e:await e.text()))).join(",")}`)}}else if("function"==typeof t.body.arrayBuffer){let e=t.body,r=await e.arrayBuffer();n.push(await e.text()),t._ogBody=new Blob([r],{type:e.type})}else"string"==typeof t.body&&(n.push(t.body),t._ogBody=t.body)}let i=JSON.stringify(["v3",this.fetchCacheKeyPrefix||"",e,t.method,"function"==typeof(t.headers||{}).keys?Object.fromEntries(t.headers):t.headers,t.mode,t.redirect,t.credentials,t.referrer,t.referrerPolicy,t.integrity,t.cache,n]);{var o;let e=s.encode(i);o=await crypto.subtle.digest("SHA-256",e),r=Array.prototype.map.call(new Uint8Array(o),e=>e.toString(16).padStart(2,"0")).join("")}return r}async get(e,t={}){var r,n,s;let a,i;if(process.env.__NEXT_INCREMENTAL_CACHE_IPC_PORT&&process.env.__NEXT_INCREMENTAL_CACHE_IPC_KEY,this.dev&&("fetch"!==t.kindHint||"no-cache"===this.requestHeaders["cache-control"]))return null;e=this._getPathname(e,"fetch"===t.kindHint);let o=null,l=t.revalidate,c=await (null==(r=this.cacheHandler)?void 0:r.get(e,t));if((null==c?void 0:null==(n=c.value)?void 0:n.kind)==="FETCH"){let e=[...t.tags||[],...t.softTags||[]];if(e.some(e=>{var t;return null==(t=this.revalidatedTags)?void 0:t.includes(e)}))return null;l=l||c.value.revalidate;let r=Math.round((Date.now()-(c.lastModified||0))/1e3),n=r>l,s=c.value.data;return{isStale:n,value:{kind:"FETCH",data:s,revalidate:l},revalidateAfter:Date.now()+1e3*l}}let u=null==(s=this.prerenderManifest.routes[Q(e)])?void 0:s.initialRevalidateSeconds;return(null==c?void 0:c.lastModified)===-1?(a=-1,i=-1*O.BR):a=!!(!1!==(i=this.calculateRevalidate(e,(null==c?void 0:c.lastModified)||Date.now(),this.dev&&"fetch"!==t.kindHint))&&i<Date.now())||void 0,c&&(o={isStale:a,curRevalidate:u,revalidateAfter:i,value:c.value}),!c&&this.prerenderManifest.notFoundRoutes.includes(e)&&(o={isStale:a,value:null,curRevalidate:u,revalidateAfter:i},this.set(e,o.value,t)),o}async set(e,t,r){if(process.env.__NEXT_INCREMENTAL_CACHE_IPC_PORT&&process.env.__NEXT_INCREMENTAL_CACHE_IPC_KEY,!this.dev||r.fetchCache){if(r.fetchCache&&JSON.stringify(t).length>2097152){if(this.dev)throw Error("fetch for over 2MB of data can not be cached");return}e=this._getPathname(e,r.fetchCache);try{var n;void 0===r.revalidate||r.fetchCache||(this.prerenderManifest.routes[e]={experimentalPPR:void 0,dataRoute:G().posix.join("/_next/data",`${Y(e)}.json`),srcRoute:null,initialRevalidateSeconds:r.revalidate,prefetchDataRoute:void 0}),await (null==(n=this.cacheHandler)?void 0:n.set(e,t,r))}catch(t){console.warn("Failed to update prerender cache for",e,t)}}}}let ee=/[|\\{}()[\]^$+*?.-]/,et=/[|\\{}()[\]^$+*?.-]/g;function er(e){return ee.test(e)?e.replace(et,"\\$&"):e}var en=r(8476);function es(e){let t=e.startsWith("[")&&e.endsWith("]");t&&(e=e.slice(1,-1));let r=e.startsWith("...");return r&&(e=e.slice(3)),{key:e,repeat:r,optional:t}}class ea{constructor(e){this.definition=e,J(e.pathname)&&(this.dynamic=function(e){let{re:t,groups:r}=e;return e=>{let n=t.exec(e);if(!n)return!1;let s=e=>{try{return decodeURIComponent(e)}catch(e){throw new z("failed to decode param")}},a={};return Object.keys(r).forEach(e=>{let t=r[e],i=n[t.pos];void 0!==i&&(a[e]=~i.indexOf("/")?i.split("/").map(e=>s(e)):t.repeat?[s(i)]:s(i))}),a}}(function(e){let{parameterizedRoute:t,groups:r}=function(e){let t=(0,en.Q)(e).slice(1).split("/"),r={},n=1;return{parameterizedRoute:t.map(e=>{let t=W.find(t=>e.startsWith(t)),s=e.match(/\[((?:\[.*\])|.+)\]/);if(t&&s){let{key:e,optional:a,repeat:i}=es(s[1]);return r[e]={pos:n++,repeat:i,optional:a},"/"+er(t)+"([^/]+?)"}if(!s)return"/"+er(e);{let{key:e,repeat:t,optional:a}=es(s[1]);return r[e]={pos:n++,repeat:t,optional:a},t?a?"(?:/(.+?))?":"/(.+?)":"/([^/]+?)"}}).join(""),groups:r}}(e);return{re:RegExp("^"+t+"(?:/)?$"),groups:r}}(e.pathname)))}get identity(){return this.definition.pathname}get isDynamic(){return void 0!==this.dynamic}match(e){let t=this.test(e);return t?{definition:this.definition,params:t.params}:null}test(e){if(this.dynamic){let t=this.dynamic(e);return t?{params:t}:null}return e===this.definition.pathname?{}:null}}var ei=r(4495);let eo=Symbol.for("__next_internal_waitUntil__"),el=globalThis[eo]||(globalThis[eo]={waitUntilCounter:0,waitUntilResolve:void 0,waitUntilPromise:null});class ec{constructor(e){this.routeModule=e,this.matcher=new ea(e.definition)}static wrap(e,t={}){let r=new ec(e);return e=>$({...e,...t,IncrementalCache:Z,handler:r.handler.bind(r)})}async handler(e,t){let r=(0,en.Q)(new URL(e.url).pathname),{basePath:n}=e.nextUrl;n&&(r=(0,ei.n)(r,n));let s=this.matcher.match(r);if(!s)throw Error(`Invariant: no match found for request. Pathname '${r}' should have matched '${this.matcher.definition.pathname}'`);let a="string"==typeof self.__PRERENDER_MANIFEST?JSON.parse(self.__PRERENDER_MANIFEST):void 0,i={params:s.params,prerenderManifest:{version:4,routes:{},dynamicRoutes:{},preview:(null==a?void 0:a.preview)||{previewModeEncryptionKey:"",previewModeId:"development-id",previewModeSigningKey:""},notFoundRoutes:[]},renderOpts:{supportsDynamicHTML:!0,experimental:{ppr:!1}}},o=await this.routeModule.handle(e,i),l=[el.waitUntilPromise];return i.renderOpts.waitUntil&&l.push(i.renderOpts.waitUntil),t.waitUntil(Promise.all(l)),o}}},8609:(e,t,r)=>{"use strict";r.d(t,{Z:()=>n.x});var n=r(1567)},8316:(e,t,r)=>{"use strict";r.d(t,{c:()=>p});var n=r(8476),s=r(3725);function a(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:a}=(0,s.c)(e);return""+t+r+n+a}function i(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:r,query:n,hash:a}=(0,s.c)(e);return""+r+t+n+a}var o=r(7054);function l(e,t){let r;let n=e.split("/");return(t||[]).some(t=>!!n[1]&&n[1].toLowerCase()===t.toLowerCase()&&(r=t,n.splice(1,1),e=n.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}var c=r(4495);let u=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function d(e,t){return new URL(String(e).replace(u,"localhost"),t&&String(t).replace(u,"localhost"))}let h=Symbol("NextURLInternal");class p{constructor(e,t,r){let n,s;"object"==typeof t&&"pathname"in t||"string"==typeof t?(n=t,s=r||{}):s=r||t||{},this[h]={url:d(e,n??s.base),options:s,basePath:""},this.analyze()}analyze(){var e,t,r,n,s;let a=function(e,t){var r,n;let{basePath:s,i18n:a,trailingSlash:i}=null!=(r=t.nextConfig)?r:{},u={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):i};s&&(0,o.Y)(u.pathname,s)&&(u.pathname=(0,c.n)(u.pathname,s),u.basePath=s);let d=u.pathname;if(u.pathname.startsWith("/_next/data/")&&u.pathname.endsWith(".json")){let e=u.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),r=e[0];u.buildId=r,d="index"!==e[1]?"/"+e.slice(1).join("/"):"/",!0===t.parseData&&(u.pathname=d)}if(a){let e=t.i18nProvider?t.i18nProvider.analyze(u.pathname):l(u.pathname,a.locales);u.locale=e.detectedLocale,u.pathname=null!=(n=e.pathname)?n:u.pathname,!e.detectedLocale&&u.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):l(d,a.locales)).detectedLocale&&(u.locale=e.detectedLocale)}return u}(this[h].url.pathname,{nextConfig:this[h].options.nextConfig,parseData:!0,i18nProvider:this[h].options.i18nProvider}),i=function(e,t){let r;if((null==t?void 0:t.host)&&!Array.isArray(t.host))r=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;r=e.hostname}return r.toLowerCase()}(this[h].url,this[h].options.headers);this[h].domainLocale=this[h].options.i18nProvider?this[h].options.i18nProvider.detectDomainLocale(i):function(e,t,r){if(e)for(let a of(r&&(r=r.toLowerCase()),e)){var n,s;let e=null==(n=a.domain)?void 0:n.split(":",1)[0].toLowerCase();if(t===e||r===a.defaultLocale.toLowerCase()||(null==(s=a.locales)?void 0:s.some(e=>e.toLowerCase()===r)))return a}}(null==(t=this[h].options.nextConfig)?void 0:null==(e=t.i18n)?void 0:e.domains,i);let u=(null==(r=this[h].domainLocale)?void 0:r.defaultLocale)||(null==(s=this[h].options.nextConfig)?void 0:null==(n=s.i18n)?void 0:n.defaultLocale);this[h].url.pathname=a.pathname,this[h].defaultLocale=u,this[h].basePath=a.basePath??"",this[h].buildId=a.buildId,this[h].locale=a.locale??u,this[h].trailingSlash=a.trailingSlash}formatPathname(){var e;let t;return t=function(e,t,r,n){if(!t||t===r)return e;let s=e.toLowerCase();return!n&&((0,o.Y)(s,"/api")||(0,o.Y)(s,"/"+t.toLowerCase()))?e:a(e,"/"+t)}((e={basePath:this[h].basePath,buildId:this[h].buildId,defaultLocale:this[h].options.forceLocale?void 0:this[h].defaultLocale,locale:this[h].locale,pathname:this[h].url.pathname,trailingSlash:this[h].trailingSlash}).pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix),(e.buildId||!e.trailingSlash)&&(t=(0,n.Q)(t)),e.buildId&&(t=i(a(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=a(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:i(t,"/"):(0,n.Q)(t)}formatSearch(){return this[h].url.search}get buildId(){return this[h].buildId}set buildId(e){this[h].buildId=e}get locale(){return this[h].locale??""}set locale(e){var t,r;if(!this[h].locale||!(null==(r=this[h].options.nextConfig)?void 0:null==(t=r.i18n)?void 0:t.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[h].locale=e}get defaultLocale(){return this[h].defaultLocale}get domainLocale(){return this[h].domainLocale}get searchParams(){return this[h].url.searchParams}get host(){return this[h].url.host}set host(e){this[h].url.host=e}get hostname(){return this[h].url.hostname}set hostname(e){this[h].url.hostname=e}get port(){return this[h].url.port}set port(e){this[h].url.port=e}get protocol(){return this[h].url.protocol}set protocol(e){this[h].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[h].url=d(e),this.analyze()}get origin(){return this[h].url.origin}get pathname(){return this[h].url.pathname}set pathname(e){this[h].url.pathname=e}get hash(){return this[h].url.hash}set hash(e){this[h].url.hash=e}get search(){return this[h].url.search}set search(e){this[h].url.search=e}get password(){return this[h].url.password}set password(e){this[h].url.password=e}get username(){return this[h].url.username}set username(e){this[h].url.username=e}get basePath(){return this[h].basePath}set basePath(e){this[h].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new p(String(this),this[h].options)}}},3375:(e,t,r)=>{"use strict";r.d(t,{h:()=>a});var n=r(7749);class s extends Error{constructor(){super("Headers cannot be modified. Read more: https://nextjs.org/docs/app/api-reference/functions/headers")}static callable(){throw new s}}class a extends Headers{constructor(e){super(),this.headers=new Proxy(e,{get(t,r,s){if("symbol"==typeof r)return n.g.get(t,r,s);let a=r.toLowerCase(),i=Object.keys(e).find(e=>e.toLowerCase()===a);if(void 0!==i)return n.g.get(t,i,s)},set(t,r,s,a){if("symbol"==typeof r)return n.g.set(t,r,s,a);let i=r.toLowerCase(),o=Object.keys(e).find(e=>e.toLowerCase()===i);return n.g.set(t,o??r,s,a)},has(t,r){if("symbol"==typeof r)return n.g.has(t,r);let s=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0!==a&&n.g.has(t,a)},deleteProperty(t,r){if("symbol"==typeof r)return n.g.deleteProperty(t,r);let s=r.toLowerCase(),a=Object.keys(e).find(e=>e.toLowerCase()===s);return void 0===a||n.g.deleteProperty(t,a)}})}static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"append":case"delete":case"set":return s.callable;default:return n.g.get(e,t,r)}}})}merge(e){return Array.isArray(e)?e.join(", "):e}static from(e){return e instanceof Headers?e:new a(e)}append(e,t){let r=this.headers[e];"string"==typeof r?this.headers[e]=[r,t]:Array.isArray(r)?r.push(t):this.headers[e]=t}delete(e){delete this.headers[e]}get(e){let t=this.headers[e];return void 0!==t?this.merge(t):null}has(e){return void 0!==this.headers[e]}set(e,t){this.headers[e]=t}forEach(e,t){for(let[r,n]of this.entries())e.call(t,n,r,this)}*entries(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase(),r=this.get(t);yield[t,r]}}*keys(){for(let e of Object.keys(this.headers)){let t=e.toLowerCase();yield t}}*values(){for(let e of Object.keys(this.headers)){let t=this.get(e);yield t}}[Symbol.iterator](){return this.entries()}}},7749:(e,t,r)=>{"use strict";r.d(t,{g:()=>n});class n{static get(e,t,r){let n=Reflect.get(e,t,r);return"function"==typeof n?n.bind(e):n}static set(e,t,r,n){return Reflect.set(e,t,r,n)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},2896:(e,t,r)=>{"use strict";r.d(t,{Qb:()=>i,_5:()=>l,vr:()=>c});var n=r(1672),s=r(7749);class a extends Error{constructor(){super("Cookies can only be modified in a Server Action or Route Handler. Read more: https://nextjs.org/docs/app/api-reference/functions/cookies#cookiessetname-value-options")}static callable(){throw new a}}class i{static seal(e){return new Proxy(e,{get(e,t,r){switch(t){case"clear":case"delete":case"set":return a.callable;default:return s.g.get(e,t,r)}}})}}let o=Symbol.for("next.mutated.cookies");function l(e,t){let r=function(e){let t=e[o];return t&&Array.isArray(t)&&0!==t.length?t:[]}(t);if(0===r.length)return!1;let s=new n.n(e),a=s.getAll();for(let e of r)s.set(e);for(let e of a)s.set(e);return!0}class c{static wrap(e,t){let r=new n.n(new Headers);for(let t of e.getAll())r.set(t);let a=[],i=new Set,l=()=>{var e;let s=null==fetch.__nextGetStaticStore?void 0:null==(e=fetch.__nextGetStaticStore.call(fetch))?void 0:e.getStore();s&&(s.pathWasRevalidated=!0);let o=r.getAll();if(a=o.filter(e=>i.has(e.name)),t){let e=[];for(let t of a){let r=new n.n(new Headers);r.set(t),e.push(r.toString())}t(e)}};return new Proxy(r,{get(e,t,r){switch(t){case o:return a;case"delete":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{e.delete(...t)}finally{l()}};case"set":return function(...t){i.add("string"==typeof t[0]?t[0]:t[0].name);try{return e.set(...t)}finally{l()}};default:return s.g.get(e,t,r)}}})}}},1672:(e,t,r)=>{"use strict";r.d(t,{n:()=>n.ResponseCookies,q:()=>n.RequestCookies});var n=r(525)},1567:(e,t,r)=>{"use strict";r.d(t,{x:()=>c});var n=r(8316),s=r(8967),a=r(1672);let i=Symbol("internal response"),o=new Set([301,302,303,307,308]);function l(e,t){var r;if(null==e?void 0:null==(r=e.request)?void 0:r.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let r=[];for(let[n,s]of e.request.headers)t.set("x-middleware-request-"+n,s),r.push(n);t.set("x-middleware-override-headers",r.join(","))}}class c extends Response{constructor(e,t={}){super(e,t),this[i]={cookies:new a.n(this.headers),url:t.url?new n.c(t.url,{headers:(0,s.lb)(this.headers),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[i].cookies}static json(e,t){let r=Response.json(e,t);return new c(r.body,r)}static redirect(e,t){let r="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!o.has(r))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let n="object"==typeof t?t:{},a=new Headers(null==n?void 0:n.headers);return a.set("Location",(0,s.r4)(e)),new c(null,{...n,headers:a,status:r})}static rewrite(e,t){let r=new Headers(null==t?void 0:t.headers);return r.set("x-middleware-rewrite",(0,s.r4)(e)),l(t,r),new c(null,{...t,headers:r})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),l(e,t),new c(null,{...e,headers:t})}}},8967:(e,t,r)=>{"use strict";function n(e){let t=new Headers;for(let[r,n]of Object.entries(e)){let e=Array.isArray(n)?n:[n];for(let n of e)void 0!==n&&("number"==typeof n&&(n=n.toString()),t.append(r,n))}return t}function s(e){let t={},r=[];if(e)for(let[n,s]of e.entries())"set-cookie"===n.toLowerCase()?(r.push(...function(e){var t,r,n,s,a,i=[],o=0;function l(){for(;o<e.length&&/\s/.test(e.charAt(o));)o+=1;return o<e.length}for(;o<e.length;){for(t=o,a=!1;l();)if(","===(r=e.charAt(o))){for(n=o,o+=1,l(),s=o;o<e.length&&"="!==(r=e.charAt(o))&&";"!==r&&","!==r;)o+=1;o<e.length&&"="===e.charAt(o)?(a=!0,o=s,i.push(e.substring(t,n)),t=o):o=n+1}else o+=1;(!a||o>=e.length)&&i.push(e.substring(t,e.length))}return i}(s)),t[n]=1===r.length?r[0]:r):t[n]=s;return t}function a(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}r.d(t,{EK:()=>n,lb:()=>s,r4:()=>a})},3763:(e,t,r)=>{"use strict";let n;n=r(2087),e.exports=n},4474:e=>{"use strict";e.exports=["chrome 64","edge 79","firefox 67","opera 51","safari 12"]},3725:(e,t,r)=>{"use strict";function n(e){let t=e.indexOf("#"),r=e.indexOf("?"),n=r>-1&&(t<0||r<t);return n||t>-1?{pathname:e.substring(0,n?r:t),query:n?e.substring(r,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}r.d(t,{c:()=>n})},7054:(e,t,r)=>{"use strict";r.d(t,{Y:()=>s});var n=r(3725);function s(e,t){if("string"!=typeof e)return!1;let{pathname:r}=(0,n.c)(e);return r===t||r.startsWith(t+"/")}},4495:(e,t,r)=>{"use strict";r.d(t,{n:()=>s});var n=r(7054);function s(e,t){if(!(0,n.Y)(e,t))return e;let r=e.slice(t.length);return r.startsWith("/")?r:"/"+r}},8476:(e,t,r)=>{"use strict";function n(e){return e.replace(/\/$/,"")||"/"}r.d(t,{Q:()=>n})},5918:(e,t,r)=>{"use strict";var n=function(){if("undefined"!=typeof self)return self;if(void 0!==r.g)return r.g;throw Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},7019:(e,t,r)=>{"use strict";r.d(t,{nS:()=>n,sr:()=>s}),`
Ты — редактор бренда traceremove.dev, персона \xabфилософ технологий\xbb. Пиши по-русски.
Требуется вернуть ГОТОВЫЙ пост для указанной платформы из входных данных (platform, title, summary, url, tags).

Тон: спокойный, лаконичный, без хайпа и эмодзи, без клише. Короткие фразы, допустим 1 мягкий риторический вопрос.
Ценность: не пересказ, а сжатое философское осмысление (человек↔технологии, этика, архитектура).

Хэштеги: только из заданных tags, строчные, очищенные, ≤20 символов, #traceremove — в конце.
Не выдумывай новые. Хэштеги отдельной строкой.

Ссылка: если url есть — отдельной строкой \xabЧитать: {url}\xbb, без изменений.

Правила:
- X: основной текст ≤270 символов (без ссылки и хэштегов). Структура:
  1) текст; 2) \xabЧитать: {url}\xbb (если есть); 3) 1–3 хэштега (через пробел).
- Facebook: один короткий абзац; затем (если есть) \xabЧитать: {url}\xbb; затем 3–5 хэштегов.
- Instagram: 1–2 коротких абзаца; затем (если есть) \xabЧитать: {url}\xbb; затем 5–10 хэштегов.

Запреты: реклама, псевдонаука, агрессия, политагитация, спам.
Вывод: только чистый текст поста, без Markdown и служебных строк.
`.trim(),`
Ты — редактор traceremove.dev (\xabфилософ технологий\xbb). Верни строгий JSON с полями:
{text: string, hashtags: string[], meta: { platform: "X"|"Facebook"|"Instagram", length: number }}

Тон: спокойный, ясный, без эмодзи/клише, допускается 1 риторический вопрос.
Смысл: этика/архитектура/последствия технологий для человека.

Нормализация тегов: только из входных, строчные, чистые, ≤20; добавь "#traceremove" последним, если нет.
Лимиты: X=1–3; Facebook=3–5; Instagram=5–10.

Структура сборки (которую ты выполнишь сам):
- X: body ≤270 символов; затем (если есть) строка \xabЧитать: {url}\xbb; затем строка хэштегов (через пробел).
- Facebook: короткий абзац → (url) → хэштеги.
- Instagram: 1–2 коротких абзаца → (url) → хэштеги.

Если url нет — не вставляй строку \xabЧитать: ...\xbb.
meta.length — длина body (без ссылки и хэштегов).
Ответ: только валидный JSON без пояснений.
`.trim();class n{async generateComprehensiveContent(e){let{type:t,topic:r,requirements:n,deliverables:s,timeline:a,audience:i,platform:o,language:l}=e;try{switch(t){case"content":return await this.generateContentPiece(r,n||[],i,o,l);case"project":return await this.generateProjectPlan(r,n||[],s,a);case"development":return await this.generateDevelopmentSolution(r,n||[],o);case"strategy":return await this.generateStrategy(r,n||[],i,a);case"analysis":return await this.generateAnalysis(r,n||[],i);default:throw Error(`Unsupported content type: ${t}`)}}catch(e){return console.error("Error generating comprehensive content:",e),{content:[{content:`I apologize, but I encountered an error while generating ${t} content for "${r}". Please try again or contact support.`,hashtags:[`#${t}`,"#Error"],platform:o||"general",type:t}],deliverables:["Error report"],timeline:"Immediate",nextSteps:["Retry request","Contact support"]}}}async generateContentPiece(e,t,r,n,s){return{content:[{content:`# ${e}

Comprehensive content piece covering ${e} with focus on ${t.join(", ")}.

## Overview
Detailed analysis and insights on ${e}.

## Key Points
${t.map(e=>`- ${e}`).join("\n")}

## Conclusion
Actionable takeaways and next steps.`,hashtags:["#Content","#Strategy"],platform:n||"blog",type:"content"}],deliverables:["Content piece","SEO optimization","Distribution plan"],timeline:"7 days",nextSteps:["Content review","Publication","Performance tracking"]}}async generateProjectPlan(e,t,r,n){return{content:[{content:`# Project Plan: ${e}

## Project Overview
Comprehensive project plan for ${e}.

## Requirements
${t.map(e=>`- ${e}`).join("\n")}

## Deliverables
${(r||["Planning document","Implementation guide"]).map(e=>`- ${e}`).join("\n")}

## Timeline
${n||"30 days"}

## Next Steps
- Project kickoff
- Resource allocation
- Implementation tracking`,hashtags:["#ProjectManagement","#Planning"],platform:"documentation",type:"project"}],deliverables:r||["Planning document","Implementation guide","Progress tracking"],timeline:n||"30 days",nextSteps:["Project kickoff","Resource allocation","Implementation tracking"]}}async generateDevelopmentSolution(e,t,r){return{content:[{content:`# Development Solution: ${e}

## Technical Requirements
${t.map(e=>`- ${e}`).join("\n")}

## Architecture
Scalable solution architecture for ${e}.

## Implementation Plan
Step-by-step development approach.

## Code Structure
\`\`\`typescript
// Example implementation
class ${e.replace(/\s+/g,"")}Solution {
  // Implementation details
}
\`\`\``,hashtags:["#Development","#Code"],platform:r||"github",type:"development"}],deliverables:["Technical specification","Code implementation","Testing suite"],timeline:"21 days",nextSteps:["Code review","Testing","Deployment"]}}async generateStrategy(e,t,r,n){return{content:[{content:`# Strategic Plan: ${e}

## Objectives
${t.map(e=>`- ${e}`).join("\n")}

## Target Audience
${r||"stakeholders"}

## Timeline
${n||"90 days"}

## Implementation Strategy
Detailed implementation plan with milestones and success metrics.`,hashtags:["#Strategy","#Planning"],platform:"documentation",type:"strategy"}],deliverables:["Strategic document","Implementation roadmap","Success metrics"],timeline:n||"90 days",nextSteps:["Stakeholder review","Resource allocation","Implementation kickoff"]}}async generateAnalysis(e,t,r){return{content:[{content:`# Analysis Report: ${e}

## Executive Summary
Comprehensive analysis of ${e} based on specified requirements.

## Key Findings
${t.map(e=>`- ${e}`).join("\n")}

## Recommendations
Actionable insights and next steps based on analysis.`,hashtags:["#Analysis","#Research"],platform:"documentation",type:"analysis"}],deliverables:["Analysis report","Data insights","Recommendations"],timeline:"14 days",nextSteps:["Review findings","Implement recommendations","Monitor results"]}}}let s=new n},5326:(e,t,r)=>{"use strict";r.d(t,{P:()=>i});let n=Error("Invariant: AsyncLocalStorage accessed in runtime where it is not available");class s{disable(){throw n}getStore(){}run(){throw n}exit(){throw n}enterWith(){throw n}}let a=globalThis.AsyncLocalStorage;function i(){return a?new a:new s}},4197:(e,t,r)=>{"use strict";r.d(t,{F:()=>s});var n=r(5326);let s=(0,n.P)()},9508:(e,t,r)=>{"use strict";let n,s,a,i,o,l,c,u,d,h;r.d(t,{ZP:()=>nA});let p="RFC3986",f={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},m=(Object.prototype.hasOwnProperty,Array.isArray),g=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function y(e,t){if(m(e)){let r=[];for(let n=0;n<e.length;n+=1)r.push(t(e[n]));return r}return t(e)}let v=Object.prototype.hasOwnProperty,b={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},w=Array.isArray,_=Array.prototype.push,E=function(e,t){_.apply(e,w(t)?t:[t])},S=Date.prototype.toISOString,x={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,r,n,s)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===r)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,r=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===s&&(40===n||41===n)){r[r.length]=t.charAt(e);continue}if(n<128){r[r.length]=g[n];continue}if(n<2048){r[r.length]=g[192|n>>6]+g[128|63&n];continue}if(n<55296||n>=57344){r[r.length]=g[224|n>>12]+g[128|n>>6&63]+g[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),r[r.length]=g[240|n>>18]+g[128|n>>12&63]+g[128|n>>6&63]+g[128|63&n]}i+=r.join("")}return i},encodeValuesOnly:!1,format:p,formatter:f[p],indices:!1,serializeDate:e=>S.call(e),skipNulls:!1,strictNullHandling:!1},R={},P="4.104.0",A=!1;class C{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}let T=()=>{s||function(e,t={auto:!1}){if(A)throw Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(s)throw Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${s}'\``);A=t.auto,s=e.kind,a=e.fetch,e.Request,e.Response,e.Headers,i=e.FormData,e.Blob,o=e.File,l=e.ReadableStream,c=e.getMultipartRequestOptions,u=e.getDefaultAgent,d=e.fileFromPath,h=e.isFsReadStream}(function({manuallyImported:e}={}){let t,r,n,s;let a=e?"You may need to use polyfills":`Add one of these imports before your first \`import … from 'openai'\`:
- \`import 'openai/shims/node'\` (if you're running on Node)
- \`import 'openai/shims/web'\` (otherwise)
`;try{t=fetch,r=Request,n=Response,s=Headers}catch(e){throw Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${a}`)}return{kind:"web",fetch:t,Request:r,Response:n,Headers:s,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${a}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${a}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${a}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${a}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new C(e)}),getDefaultAgent:e=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0})};T();class O extends Error{}class I extends O{constructor(e,t,r,n){super(`${I.makeMessage(e,t,r)}`),this.status=e,this.headers=n,this.request_id=n?.["x-request-id"],this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,r){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):r;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,r,n){if(!e||!n)return new N({message:r,cause:tD(t)});let s=t?.error;return 400===e?new M(e,s,r,n):401===e?new D(e,s,r,n):403===e?new j(e,s,r,n):404===e?new L(e,s,r,n):409===e?new q(e,s,r,n):422===e?new U(e,s,r,n):429===e?new B(e,s,r,n):e>=500?new F(e,s,r,n):new I(e,s,r,n)}}class k extends I{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class N extends I{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class $ extends N{constructor({message:e}={}){super({message:e??"Request timed out."})}}class M extends I{}class D extends I{}class j extends I{}class L extends I{}class q extends I{}class U extends I{}class B extends I{}class F extends I{}class H extends O{constructor(){super("Could not parse response content as the length limit was reached")}}class G extends O{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}var V,W,K,J,X,z,Y,Q,Z,ee,et,er,en,es,ea,ei,eo,el,ec,eu,ed,eh,ep,ef,em,eg,ey,ev,eb,ew,e_,eE,eS,ex,eR,eP,eA,eC,eT,eO,eI,ek,eN,e$,eM,eD,ej,eL,eq,eU,eB,eF,eH,eG,eV,eW,eK,eJ,eX,ez,eY,eQ,eZ,e0,e1,e2=r(6195).Buffer,e4=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},e3=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class e6{constructor(){V.set(this,void 0),this.buffer=new Uint8Array,e4(this,V,null,"f")}decode(e){let t;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?new TextEncoder().encode(e):e,n=new Uint8Array(this.buffer.length+r.length);n.set(this.buffer),n.set(r,this.buffer.length),this.buffer=n;let s=[];for(;null!=(t=function(e,t){for(let r=t??0;r<e.length;r++){if(10===e[r])return{preceding:r,index:r+1,carriage:!1};if(13===e[r])return{preceding:r,index:r+1,carriage:!0}}return null}(this.buffer,e3(this,V,"f")));){if(t.carriage&&null==e3(this,V,"f")){e4(this,V,t.index,"f");continue}if(null!=e3(this,V,"f")&&(t.index!==e3(this,V,"f")+1||t.carriage)){s.push(this.decodeText(this.buffer.slice(0,e3(this,V,"f")-1))),this.buffer=this.buffer.slice(e3(this,V,"f")),e4(this,V,null,"f");continue}let e=null!==e3(this,V,"f")?t.preceding-1:t.preceding,r=this.decodeText(this.buffer.slice(0,e));s.push(r),this.buffer=this.buffer.slice(t.index),e4(this,V,null,"f")}return s}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(void 0!==e2){if(e instanceof e2)return e.toString();if(e instanceof Uint8Array)return e2.from(e).toString();throw new O(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new O(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new O("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){return this.buffer.length?this.decode("\n"):[]}}function e5(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}V=new WeakMap,e6.NEWLINE_CHARS=new Set(["\n","\r"]),e6.NEWLINE_REGEXP=/\r\n|[\n\r]/g;class e8{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let r=!1;return new e8(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let n=!1;try{for await(let r of e9(e,t))if(!n){if(r.data.startsWith("[DONE]")){n=!0;continue}if(null===r.event||r.event.startsWith("response.")||r.event.startsWith("transcript.")){let t;try{t=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if(t&&t.error)throw new I(void 0,t.error,void 0,tx(e.headers));yield t}else{let e;try{e=JSON.parse(r.data)}catch(e){throw console.error("Could not parse message into JSON:",r.data),console.error("From chunk:",r.raw),e}if("error"==r.event)throw new I(void 0,e.error,e.message,void 0);yield{event:r.event,data:e}}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}},t)}static fromReadableStream(e,t){let r=!1;async function*n(){let t=new e6,r=e5(e);for await(let e of r)for(let r of t.decode(e))yield r;for(let e of t.flush())yield e}return new e8(async function*(){if(r)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");r=!0;let e=!1;try{for await(let t of n())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{e||t.abort()}},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){let e=[],t=[],r=this.iterator(),n=n=>({next:()=>{if(0===n.length){let n=r.next();e.push(n),t.push(n)}return n.shift()}});return[new e8(()=>n(e),this.controller),new e8(()=>n(t),this.controller)]}toReadableStream(){let e;let t=this,r=new TextEncoder;return new l({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:n,done:s}=await e.next();if(s)return t.close();let a=r.encode(JSON.stringify(n)+"\n");t.enqueue(a)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*e9(e,t){if(!e.body)throw t.abort(),new O("Attempted to iterate over a response with no body");let r=new te,n=new e6,s=e5(e.body);for await(let e of e7(s))for(let t of n.decode(e)){let e=r.decode(t);e&&(yield e)}for(let e of n.flush()){let t=r.decode(e);t&&(yield t)}}async function*e7(e){let t=new Uint8Array;for await(let r of e){let e;if(null==r)continue;let n=r instanceof ArrayBuffer?new Uint8Array(r):"string"==typeof r?new TextEncoder().encode(r):r,s=new Uint8Array(t.length+n.length);for(s.set(t),s.set(n,t.length),t=s;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class te{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,r,n]=function(e,t){let r=e.indexOf(t);return -1!==r?[e.substring(0,r),t,e.substring(r+t.length)]:[e,"",""]}(e,":");return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}var tt=r(6195).Buffer;let tr=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,tn=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&ts(e),ts=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer,ta=e=>tn(e)||tr(e)||h(e);async function ti(e,t,r){var n;if(tn(e=await e))return e;if(tr(e)){let n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");let s=ts(n)?[await n.arrayBuffer()]:[n];return new o(s,t,r)}let s=await to(e);if(t||(t=(tl((n=e).name)||tl(n.filename)||tl(n.path)?.split(/[\\/]/).pop())??"unknown_file"),!r?.type){let e=s[0]?.type;"string"==typeof e&&(r={...r,type:e})}return new o(s,t,r)}async function to(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(ts(e))t.push(await e.arrayBuffer());else if(tc(e))for await(let r of e)t.push(r);else throw Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){let t=Object.getOwnPropertyNames(e);return`[${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`);return t}let tl=e=>"string"==typeof e?e:void 0!==tt&&e instanceof tt?String(e):void 0,tc=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tu=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],td=async e=>{let t=await th(e.body);return c(t,e)},th=async e=>{let t=new i;return await Promise.all(Object.entries(e||{}).map(([e,r])=>tf(t,e,r))),t},tp=e=>{if(ta(e))return!0;if(Array.isArray(e))return e.some(tp);if(e&&"object"==typeof e){for(let t in e)if(tp(e[t]))return!0}return!1},tf=async(e,t,r)=>{if(void 0!==r){if(null==r)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof r||"number"==typeof r||"boolean"==typeof r)e.append(t,String(r));else if(ta(r)){let n=await ti(r);e.append(t,n)}else if(Array.isArray(r))await Promise.all(r.map(r=>tf(e,t+"[]",r)));else if("object"==typeof r)await Promise.all(Object.entries(r).map(([r,n])=>tf(e,`${t}[${r}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${r} instead`)}};var tm=r(6195).Buffer,tg=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},ty=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};async function tv(e){let{response:t}=e;if(e.options.stream)return(tF("response",t.status,t.url,t.headers,t.body),e.options.__streamClass)?e.options.__streamClass.fromSSEResponse(t,e.controller):e8.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;let r=t.headers.get("content-type"),n=r?.split(";")[0]?.trim(),s=n?.includes("application/json")||n?.endsWith("+json");if(s){let e=await t.json();return tF("response",t.status,t.url,t.headers,e),tb(e,t)}let a=await t.text();return tF("response",t.status,t.url,t.headers,a),a}function tb(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}T();class tw extends Promise{constructor(e,t=tv){super(e=>{e(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new tw(this.responsePromise,async t=>tb(e(await this.parseResponse(t),t),t.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class t_{constructor({baseURL:e,maxRetries:t=2,timeout:r=6e5,httpAgent:n,fetch:s}){this.baseURL=e,this.maxRetries=tM("maxRetries",t),this.timeout=tM("timeout",r),this.httpAgent=n,this.fetch=s??a}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...tO(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${tH()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,r){return this.request(Promise.resolve(r).then(async r=>{let n=r&&ts(r?.body)?new DataView(await r.body.arrayBuffer()):r?.body instanceof DataView?r.body:r?.body instanceof ArrayBuffer?new DataView(r.body):r&&ArrayBuffer.isView(r?.body)?new DataView(r.body.buffer):r?.body;return{method:e,path:t,...r,body:n}}))}getAPIList(e,t,r){return this.requestAPIList(t,{method:"get",path:e,...r})}calculateContentLength(e){if("string"==typeof e){if(void 0!==tm)return tm.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder){let t=new TextEncoder,r=t.encode(e);return r.length.toString()}}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){let r={...e},{method:n,path:s,query:a,headers:i={}}=r,o=ArrayBuffer.isView(r.body)||r.__binaryRequest&&"string"==typeof r.body?r.body:tu(r.body)?r.body.body:r.body?JSON.stringify(r.body,null,2):null,l=this.calculateContentLength(o),c=this.buildURL(s,a);"timeout"in r&&tM("timeout",r.timeout),r.timeout=r.timeout??this.timeout;let d=r.httpAgent??this.httpAgent??u(c),h=r.timeout+1e3;"number"==typeof d?.options?.timeout&&h>(d.options.timeout??0)&&(d.options.timeout=h),this.idempotencyHeader&&"get"!==n&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let p=this.buildHeaders({options:r,headers:i,contentLength:l,retryCount:t}),f={method:n,...o&&{body:o},headers:p,...d&&{agent:d},signal:r.signal??null};return{req:f,url:c,timeout:r.timeout}}buildHeaders({options:e,headers:t,contentLength:r,retryCount:n}){let a={};r&&(a["content-length"]=r);let i=this.defaultHeaders(e);return tU(a,i),tU(a,t),tu(e.body)&&"node"!==s&&delete a["content-type"],void 0===tW(i,"x-stainless-retry-count")&&void 0===tW(t,"x-stainless-retry-count")&&(a["x-stainless-retry-count"]=String(n)),void 0===tW(i,"x-stainless-timeout")&&void 0===tW(t,"x-stainless-timeout")&&e.timeout&&(a["x-stainless-timeout"]=String(Math.trunc(e.timeout/1e3))),this.validateHeaders(a,t),a}async prepareOptions(e){}async prepareRequest(e,{url:t,options:r}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(e=>[...e])):{...e}:{}}makeStatusError(e,t,r,n){return I.generate(e,t,r,n)}request(e,t=null){return new tw(this.makeRequest(e,t))}async makeRequest(e,t){let r=await e,n=r.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(r);let{req:s,url:a,timeout:i}=this.buildRequest(r,{retryCount:n-t});if(await this.prepareRequest(s,{url:a,options:r}),tF("request",a,r,s.headers),r.signal?.aborted)throw new k;let o=new AbortController,l=await this.fetchWithTimeout(a,s,i,o).catch(tD);if(l instanceof Error){if(r.signal?.aborted)throw new k;if(t)return this.retryRequest(r,t);if("AbortError"===l.name)throw new $;throw new N({cause:l})}let c=tx(l.headers);if(!l.ok){if(t&&this.shouldRetry(l)){let e=`retrying, ${t} attempts remaining`;return tF(`response (error; ${e})`,l.status,a,c),this.retryRequest(r,t,c)}let e=await l.text().catch(e=>tD(e).message),n=tI(e),s=n?void 0:e,i=t?"(error; no more retries left)":"(error; not retryable)";tF(`response (error; ${i})`,l.status,a,c,s);let o=this.makeStatusError(l.status,n,s,c);throw o}return{response:l,options:r,controller:o}}requestAPIList(e,t){let r=this.makeRequest(t,null);return new tS(this,r,e)}buildURL(e,t){let r=new URL(tN(e)?e:this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return tL(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}stringifyQuery(e){return Object.entries(e).filter(([e,t])=>void 0!==t).map(([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new O(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(e,t,r,n){let{signal:s,...a}=t||{};s&&s.addEventListener("abort",()=>n.abort());let i=setTimeout(()=>n.abort(),r),o={signal:n.signal,...a};return o.method&&(o.method=o.method.toUpperCase()),this.fetch.call(void 0,e,o).finally(()=>{clearTimeout(i)})}shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,r){let n;let s=r?.["retry-after-ms"];if(s){let e=parseFloat(s);Number.isNaN(e)||(n=e)}let a=r?.["retry-after"];if(a&&!n){let e=parseFloat(a);n=Number.isNaN(e)?Date.parse(a)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){let r=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,r)}return await t$(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${P}`}}class tE{constructor(e,t,r,n){W.set(this,void 0),tg(this,W,e,"f"),this.options=n,this.response=t,this.body=r}hasNextPage(){let e=this.getPaginatedItems();return!!e.length&&null!=this.nextPageInfo()}async getNextPage(){let e=this.nextPageInfo();if(!e)throw new O("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){let r=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(let[t,n]of r)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await ty(this,W,"f").requestAPIList(this.constructor,t)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(W=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tS extends tw{constructor(e,t,r){super(t,async t=>new r(e,t.response,await tv(t),t.options))}async *[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}}let tx=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){let r=t.toString();return e[r.toLowerCase()]||e[r]}}),tR={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__metadata:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},tP=e=>"object"==typeof e&&null!==e&&!tL(e)&&Object.keys(e).every(e=>tq(tR,e)),tA=()=>"undefined"!=typeof Deno&&null!=Deno.build?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":tT(Deno.build.os),"X-Stainless-Arch":tC(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":P,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"other:edge-runtime","X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version},tC=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",tT=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown",tO=()=>n??(n=tA()),tI=e=>{try{return JSON.parse(e)}catch(e){return}},tk=/^[a-z][a-z0-9+.-]*:/i,tN=e=>tk.test(e),t$=e=>new Promise(t=>setTimeout(t,e)),tM=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new O(`${e} must be an integer`);if(t<0)throw new O(`${e} must be a positive integer`);return t},tD=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return Error(JSON.stringify(e))}catch{}return Error(e)},tj=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function tL(e){if(!e)return!0;for(let t in e)return!1;return!0}function tq(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function tU(e,t){for(let r in t){if(!tq(t,r))continue;let n=r.toLowerCase();if(!n)continue;let s=t[r];null===s?delete e[n]:void 0!==s&&(e[n]=s)}}let tB=new Set(["authorization","api-key"]);function tF(e,...t){if("undefined"!=typeof process&&process?.env?.DEBUG==="true"){let r=t.map(e=>{if(!e)return e;if(e.headers){let t={...e,headers:{...e.headers}};for(let r in e.headers)tB.has(r.toLowerCase())&&(t.headers[r]="REDACTED");return t}let t=null;for(let r in e)tB.has(r.toLowerCase())&&(t??(t={...e}),t[r]="REDACTED");return t??e});console.log(`OpenAI:DEBUG:${e}`,...r)}}let tH=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),tG=()=>!1,tV=e=>"function"==typeof e?.get,tW=(e,t)=>{let r=t.toLowerCase();if(tV(e)){let n=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,(e,t,r)=>t+r.toUpperCase());for(let s of[t,r,t.toUpperCase(),n]){let t=e.get(s);if(t)return t}}for(let[n,s]of Object.entries(e))if(n.toLowerCase()===r){if(Array.isArray(s)){if(s.length<=1)return s[0];return console.warn(`Received ${s.length} entries for the ${t} header, using the first entry.`),s[0]}return s}},tK=e=>{if(void 0!==tm){let t=tm.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),r=t.length,n=new Uint8Array(r);for(let e=0;e<r;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}};function tJ(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class tX{constructor(e){this._client=e}}class tz extends tX{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class tY extends tX{list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/chat/completions/${e}/messages`,t2,{query:t,...r})}}class tQ extends tE{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.object=r.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class tZ extends tE{constructor(e,t,r,n){super(e,t,r,n),this.data=r.data||[],this.has_more=r.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageParams(){let e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;let t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){let e=this.getPaginatedItems();if(!e.length)return null;let t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class t0 extends tX{constructor(){super(...arguments),this.messages=new tY(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(`/chat/completions/${e}`,t)}update(e,t,r){return this._client.post(`/chat/completions/${e}`,{body:t,...r})}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/chat/completions",t1,{query:e,...t})}del(e,t){return this._client.delete(`/chat/completions/${e}`,t)}}class t1 extends tZ{}class t2 extends tZ{}t0.ChatCompletionsPage=t1,t0.Messages=tY;class t4 extends tX{constructor(){super(...arguments),this.completions=new t0(this._client)}}t4.Completions=t0,t4.ChatCompletionsPage=t1;class t3 extends tX{create(e,t){let r=!!e.encoding_format,n=r?e.encoding_format:"base64";r&&tF("Request","User defined encoding_format:",e.encoding_format);let s=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return r?s:(tF("response","Decoding base64 embeddings to float32 array"),s._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=tK(t)}),e)))}}class t6 extends tX{create(e,t){return this._client.post("/files",td({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/files",t5,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/binary",...t?.headers},__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,t)}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:r=18e5}={}){let n=new Set(["processed","error","deleted"]),s=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await t$(t),a=await this.retrieve(e),Date.now()-s>r)throw new $({message:`Giving up on waiting for file ${e} to finish processing after ${r} milliseconds.`});return a}}class t5 extends tZ{}t6.FileObjectsPage=t5;class t8 extends tX{createVariation(e,t){return this._client.post("/images/variations",td({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",td({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}class t9 extends tX{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:{Accept:"application/octet-stream",...t?.headers},__binaryResponse:!0})}}class t7 extends tX{create(e,t){return this._client.post("/audio/transcriptions",td({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}}))}}class re extends tX{create(e,t){return this._client.post("/audio/translations",td({body:e,...t,__metadata:{model:e.model}}))}}class Audio extends tX{constructor(){super(...arguments),this.transcriptions=new t7(this._client),this.translations=new re(this._client),this.speech=new t9(this._client)}}Audio.Transcriptions=t7,Audio.Translations=re,Audio.Speech=t9;class rt extends tX{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class rr extends tX{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",rn,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class rn extends tQ{}rr.ModelsPage=rn;class rs extends tX{}class ra extends tX{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class ri extends tX{constructor(){super(...arguments),this.graders=new ra(this._client)}}ri.Graders=ra;class Permissions extends tX{create(e,t,r){return this._client.getAPIList(`/fine_tuning/checkpoints/${e}/permissions`,ro,{body:t,method:"post",...r})}retrieve(e,t={},r){return tP(t)?this.retrieve(e,{},t):this._client.get(`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...r})}del(e,t,r){return this._client.delete(`/fine_tuning/checkpoints/${e}/permissions/${t}`,r)}}class ro extends tQ{}Permissions.PermissionCreateResponsesPage=ro;class rl extends tX{constructor(){super(...arguments),this.permissions=new Permissions(this._client)}}rl.Permissions=Permissions,rl.PermissionCreateResponsesPage=ro;class rc extends tX{list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,ru,{query:t,...r})}}class ru extends tZ{}rc.FineTuningJobCheckpointsPage=ru;class rd extends tX{constructor(){super(...arguments),this.checkpoints=new rc(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",rh,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},r){return tP(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,rp,{query:t,...r})}pause(e,t){return this._client.post(`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(`/fine_tuning/jobs/${e}/resume`,t)}}class rh extends tZ{}class rp extends tZ{}rd.FineTuningJobsPage=rh,rd.FineTuningJobEventsPage=rp,rd.Checkpoints=rc,rd.FineTuningJobCheckpointsPage=ru;class rf extends tX{constructor(){super(...arguments),this.methods=new rs(this._client),this.jobs=new rd(this._client),this.checkpoints=new rl(this._client),this.alpha=new ri(this._client)}}rf.Methods=rs,rf.Jobs=rd,rf.FineTuningJobsPage=rh,rf.FineTuningJobEventsPage=rp,rf.Checkpoints=rl,rf.Alpha=ri;class rm extends tX{}class rg extends tX{constructor(){super(...arguments),this.graderModels=new rm(this._client)}}rg.GraderModels=rm;let ry=async e=>{let t=await Promise.allSettled(e),r=t.filter(e=>"rejected"===e.status);if(r.length){for(let e of r)console.error(e.reason);throw Error(`${r.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class rv extends tX{create(e,t,r){return this._client.post(`/vector_stores/${e}/files`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/vector_stores/${e}/files/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,rb,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let s=await this.retrieve(e,t,{...r,headers:n}).withResponse(),a=s.data;switch(a.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=s.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await t$(i);break;case"failed":case"completed":return a}}}async upload(e,t,r){let n=await this._client.files.create({file:t,purpose:"assistants"},r);return this.create(e,{file_id:n.id},r)}async uploadAndPoll(e,t,r){let n=await this.upload(e,t,r);return await this.poll(e,n.id,r)}content(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/files/${t}/content`,rw,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class rb extends tZ{}class rw extends tQ{}rv.VectorStoreFilesPage=rb,rv.FileContentResponsesPage=rw;class r_ extends tX{create(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t);return await this.poll(e,n.id,r)}listFiles(e,t,r={},n){return tP(r)?this.listFiles(e,t,{},r):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,rb,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:s,response:a}=await this.retrieve(e,t,{...r,headers:n}).withResponse();switch(s.status){case"in_progress":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await t$(i);break;case"failed":case"cancelled":case"completed":return s}}}async uploadAndPoll(e,{files:t,fileIds:r=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let s=n?.maxConcurrency??5,a=Math.min(s,t.length),i=this._client,o=t.values(),l=[...r];async function c(e){for(let t of e){let e=await i.files.create({file:t,purpose:"assistants"},n);l.push(e.id)}}let u=Array(a).fill(o).map(c);return await ry(u),await this.createAndPoll(e,{file_ids:l})}}class rE extends tX{constructor(){super(...arguments),this.files=new rv(this._client),this.fileBatches=new r_(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/vector_stores/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/vector_stores",rS,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}search(e,t,r){return this._client.getAPIList(`/vector_stores/${e}/search`,rx,{body:t,method:"post",...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class rS extends tZ{}class rx extends tQ{}rE.VectorStoresPage=rS,rE.VectorStoreSearchResponsesPage=rx,rE.Files=rv,rE.VectorStoreFilesPage=rb,rE.FileContentResponsesPage=rw,rE.FileBatches=r_;class rR extends tX{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/assistants/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/assistants",rP,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class rP extends tZ{}function rA(e){return"function"==typeof e.parse}rR.AssistantsPage=rP;let rC=e=>e?.role==="assistant",rT=e=>e?.role==="function",rO=e=>e?.role==="tool";var rI=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},rk=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class rN{constructor(){K.add(this),this.controller=new AbortController,J.set(this,void 0),X.set(this,()=>{}),z.set(this,()=>{}),Y.set(this,void 0),Q.set(this,()=>{}),Z.set(this,()=>{}),ee.set(this,{}),et.set(this,!1),er.set(this,!1),en.set(this,!1),es.set(this,!1),rI(this,J,new Promise((e,t)=>{rI(this,X,e,"f"),rI(this,z,t,"f")}),"f"),rI(this,Y,new Promise((e,t)=>{rI(this,Q,e,"f"),rI(this,Z,t,"f")}),"f"),rk(this,J,"f").catch(()=>{}),rk(this,Y,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},rk(this,K,"m",ea).bind(this))},0)}_connected(){this.ended||(rk(this,X,"f").call(this),this._emit("connect"))}get ended(){return rk(this,et,"f")}get errored(){return rk(this,er,"f")}get aborted(){return rk(this,en,"f")}abort(){this.controller.abort()}on(e,t){let r=rk(this,ee,"f")[e]||(rk(this,ee,"f")[e]=[]);return r.push({listener:t}),this}off(e,t){let r=rk(this,ee,"f")[e];if(!r)return this;let n=r.findIndex(e=>e.listener===t);return n>=0&&r.splice(n,1),this}once(e,t){let r=rk(this,ee,"f")[e]||(rk(this,ee,"f")[e]=[]);return r.push({listener:t,once:!0}),this}emitted(e){return new Promise((t,r)=>{rI(this,es,!0,"f"),"error"!==e&&this.once("error",r),this.once(e,t)})}async done(){rI(this,es,!0,"f"),await rk(this,Y,"f")}_emit(e,...t){if(rk(this,et,"f"))return;"end"===e&&(rI(this,et,!0,"f"),rk(this,Q,"f").call(this));let r=rk(this,ee,"f")[e];if(r&&(rk(this,ee,"f")[e]=r.filter(e=>!e.once),r.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];rk(this,es,"f")||r?.length||Promise.reject(e),rk(this,z,"f").call(this,e),rk(this,Z,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];rk(this,es,"f")||r?.length||Promise.reject(e),rk(this,z,"f").call(this,e),rk(this,Z,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function r$(e){return e?.$brand==="auto-parseable-response-format"}function rM(e){return e?.$brand==="auto-parseable-tool"}function rD(e,t){let r=e.choices.map(e=>{if("length"===e.finish_reason)throw new H;if("content_filter"===e.finish_reason)throw new G;return{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>(function(e,t){let r=e.tools?.find(e=>e.function?.name===t.function.name);return{...t,function:{...t.function,parsed_arguments:rM(r)?r.$parseRaw(t.function.arguments):r?.function.strict?JSON.parse(t.function.arguments):null}}})(t,e))??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?function(e,t){if(e.response_format?.type!=="json_schema")return null;if(e.response_format?.type==="json_schema"){if("$parseRaw"in e.response_format){let r=e.response_format;return r.$parseRaw(t)}return JSON.parse(t)}return null}(t,e.message.content):null}}});return{...e,choices:r}}function rj(e){return!!r$(e.response_format)||(e.tools?.some(e=>rM(e)||"function"===e.type&&!0===e.function.strict)??!1)}J=new WeakMap,X=new WeakMap,z=new WeakMap,Y=new WeakMap,Q=new WeakMap,Z=new WeakMap,ee=new WeakMap,et=new WeakMap,er=new WeakMap,en=new WeakMap,es=new WeakMap,K=new WeakSet,ea=function(e){if(rI(this,er,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new k),e instanceof k)return rI(this,en,!0,"f"),this._emit("abort",e);if(e instanceof O)return this._emit("error",e);if(e instanceof Error){let t=new O(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new O(String(e)))};var rL=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class rq extends rN{constructor(){super(...arguments),ei.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(rT(e)||rO(e))&&e.content)this._emit("functionCallResult",e.content);else if(rC(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(rC(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new O("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),rL(this,ei,"m",eo).call(this)}async finalMessage(){return await this.done(),rL(this,ei,"m",el).call(this)}async finalFunctionCall(){return await this.done(),rL(this,ei,"m",ec).call(this)}async finalFunctionCallResult(){return await this.done(),rL(this,ei,"m",eu).call(this)}async totalUsage(){return await this.done(),rL(this,ei,"m",ed).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=rL(this,ei,"m",el).call(this);t&&this._emit("finalMessage",t);let r=rL(this,ei,"m",eo).call(this);r&&this._emit("finalContent",r);let n=rL(this,ei,"m",ec).call(this);n&&this._emit("finalFunctionCall",n);let s=rL(this,ei,"m",eu).call(this);null!=s&&this._emit("finalFunctionCallResult",s),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",rL(this,ei,"m",ed).call(this))}async _createChatCompletion(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),rL(this,ei,"m",eh).call(this,t);let s=await e.chat.completions.create({...t,stream:!1},{...r,signal:this.controller.signal});return this._connected(),this._addChatCompletion(rD(s,t))}async _runChatCompletion(e,t,r){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,r)}async _runFunctions(e,t,r){let n="function",{function_call:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.name,{maxChatCompletions:l=10}=r||{},c={};for(let e of t.functions)c[e.name||e.function.name]=e;let u=t.functions.map(e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description}));for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t;let a=await this._createChatCompletion(e,{...i,function_call:s,functions:u,messages:[...this.messages]},r),l=a.choices[0]?.message;if(!l)throw new O("missing message in ChatCompletion response");if(!l.function_call)return;let{name:d,arguments:h}=l.function_call,p=c[d];if(p){if(o&&o!==d){let e=`Invalid function_call: ${JSON.stringify(d)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,name:d,content:e});continue}}else{let e=`Invalid function_call: ${JSON.stringify(d)}. Available options are: ${u.map(e=>JSON.stringify(e.name)).join(", ")}. Please try again`;this._addMessage({role:n,name:d,content:e});continue}try{t=rA(p)?await p.parse(h):h}catch(e){this._addMessage({role:n,name:d,content:e instanceof Error?e.message:String(e)});continue}let f=await p.function(t,this),m=rL(this,ei,"m",ep).call(this,f);if(this._addMessage({role:n,name:d,content:m}),o)return}}async _runTools(e,t,r){let n="tool",{tool_choice:s="auto",stream:a,...i}=t,o="string"!=typeof s&&s?.function?.name,{maxChatCompletions:l=10}=r||{},c=t.tools.map(e=>{if(rM(e)){if(!e.$callback)throw new O("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),u={};for(let e of c)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);let d="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:s,tools:d,messages:[...this.messages]},r),a=t.choices[0]?.message;if(!a)throw new O("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let r=e.id,{name:s,arguments:a}=e.function,i=u[s];if(i){if(o&&o!==s){let e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(u).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:r,content:e});continue}try{t=rA(i)?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:r,content:e});continue}let l=await i.function(t,this),c=rL(this,ei,"m",ep).call(this,l);if(this._addMessage({role:n,tool_call_id:r,content:c}),o)return}}}}ei=new WeakSet,eo=function(){return rL(this,ei,"m",el).call(this).content??null},el=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(rC(t)){let{function_call:e,...r}=t,n={...r,content:t.content??null,refusal:t.refusal??null};return e&&(n.function_call=e),n}}throw new O("stream ended without producing a ChatCompletionMessage with role=assistant")},ec=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(rC(t)&&t?.function_call)return t.function_call;if(rC(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},eu=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(rT(t)&&null!=t.content||rO(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},ed=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},eh=function(e){if(null!=e.n&&e.n>1)throw new O("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},ep=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class rU extends rq{static runFunctions(e,t,r){let n=new rU,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,s)),n}static runTools(e,t,r){let n=new rU,s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}_addMessage(e,t=!0){super._addMessage(e,t),rC(e)&&e.content&&this._emit("content",e.content)}}let rB={STR:1,NUM:2,ARR:4,OBJ:8,NULL:16,BOOL:32,NAN:64,INFINITY:128,MINUS_INFINITY:256,ALL:511};class rF extends Error{}class rH extends Error{}let rG=(e,t)=>{let r=e.length,n=0,s=e=>{throw new rF(`${e} at position ${n}`)},a=e=>{throw new rH(`${e} at position ${n}`)},i=()=>(d(),n>=r&&s("Unexpected end of input"),'"'===e[n])?o():"{"===e[n]?l():"["===e[n]?c():"null"===e.substring(n,n+4)||rB.NULL&t&&r-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||rB.BOOL&t&&r-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||rB.BOOL&t&&r-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||rB.INFINITY&t&&r-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||rB.MINUS_INFINITY&t&&1<r-n&&r-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||rB.NAN&t&&r-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u(),o=()=>{let i=n,o=!1;for(n++;n<r&&('"'!==e[n]||o&&"\\"===e[n-1]);)o="\\"===e[n]&&!o,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(o)))}catch(e){a(String(e))}else if(rB.STR&t)try{return JSON.parse(e.substring(i,n-Number(o))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}s("Unterminated string literal")},l=()=>{n++,d();let a={};try{for(;"}"!==e[n];){if(d(),n>=r&&rB.OBJ&t)return a;let s=o();d(),n++;try{let e=i();Object.defineProperty(a,s,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(rB.OBJ&t)return a;throw e}d(),","===e[n]&&n++}}catch(e){if(rB.OBJ&t)return a;s("Expected '}' at end of object")}return n++,a},c=()=>{n++;let r=[];try{for(;"]"!==e[n];)r.push(i()),d(),","===e[n]&&n++}catch(e){if(rB.ARR&t)return r;s("Expected ']' at end of array")}return n++,r},u=()=>{if(0===n){"-"===e&&rB.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e)}catch(r){if(rB.NUM&t)try{if("."===e[e.length-1])return JSON.parse(e.substring(0,e.lastIndexOf(".")));return JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}a(String(r))}}let i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=r||rB.NUM&t||s("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(r){"-"===e.substring(i,n)&&rB.NUM&t&&s("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){a(String(e))}}},d=()=>{for(;n<r&&" \n\r	".includes(e[n]);)n++};return i()},rV=e=>(function(e,t=rB.ALL){if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return rG(e.trim(),t)})(e,rB.ALL^rB.NUM);var rW=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},rK=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class rJ extends rq{constructor(e){super(),ef.add(this),em.set(this,void 0),eg.set(this,void 0),ey.set(this,void 0),rW(this,em,e,"f"),rW(this,eg,[],"f")}get currentChatCompletionSnapshot(){return rK(this,ey,"f")}static fromReadableStream(e){let t=new rJ(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,r){let n=new rJ(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,r){super._createChatCompletion;let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),rK(this,ef,"m",ev).call(this);let s=await e.chat.completions.create({...t,stream:!0},{...r,signal:this.controller.signal});for await(let e of(this._connected(),s))rK(this,ef,"m",ew).call(this,e);if(s.controller.signal?.aborted)throw new k;return this._addChatCompletion(rK(this,ef,"m",eS).call(this))}async _fromReadableStream(e,t){let r;let n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),rK(this,ef,"m",ev).call(this),this._connected();let s=e8.fromReadableStream(e,this.controller);for await(let e of s)r&&r!==e.id&&this._addChatCompletion(rK(this,ef,"m",eS).call(this)),rK(this,ef,"m",ew).call(this,e),r=e.id;if(s.controller.signal?.aborted)throw new k;return this._addChatCompletion(rK(this,ef,"m",eS).call(this))}[(em=new WeakMap,eg=new WeakMap,ey=new WeakMap,ef=new WeakSet,ev=function(){this.ended||rW(this,ey,void 0,"f")},eb=function(e){let t=rK(this,eg,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},rK(this,eg,"f")[e.index]=t),t},ew=function(e){if(this.ended)return;let t=rK(this,ef,"m",eR).call(this,e);for(let r of(this._emit("chunk",e,t),e.choices)){let e=t.choices[r.index];null!=r.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",r.delta.content,e.message.content),this._emit("content.delta",{delta:r.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=r.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:r.delta.refusal,snapshot:e.message.refusal}),r.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:r.logprobs?.content,snapshot:e.logprobs?.content??[]}),r.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:r.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=rK(this,ef,"m",eb).call(this,e);for(let t of(e.finish_reason&&(rK(this,ef,"m",eE).call(this,e),null!=n.current_tool_call_index&&rK(this,ef,"m",e_).call(this,e,n.current_tool_call_index)),r.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(rK(this,ef,"m",eE).call(this,e),null!=n.current_tool_call_index&&rK(this,ef,"m",e_).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of r.delta.tool_calls??[]){let r=e.message.tool_calls?.[t.index];r?.type&&(r?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:r.function?.name,index:t.index,arguments:r.function.arguments,parsed_arguments:r.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):r?.type)}}},e_=function(e,t){let r=rK(this,ef,"m",eb).call(this,e);if(r.done_tool_calls.has(t))return;let n=e.message.tool_calls?.[t];if(!n)throw Error("no tool call snapshot");if(!n.type)throw Error("tool call snapshot missing `type`");if("function"===n.type){let e=rK(this,em,"f")?.tools?.find(e=>"function"===e.type&&e.function.name===n.function.name);this._emit("tool_calls.function.arguments.done",{name:n.function.name,index:t,arguments:n.function.arguments,parsed_arguments:rM(e)?e.$parseRaw(n.function.arguments):e?.function.strict?JSON.parse(n.function.arguments):null})}else n.type},eE=function(e){let t=rK(this,ef,"m",eb).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let r=rK(this,ef,"m",ex).call(this);this._emit("content.done",{content:e.message.content,parsed:r?r.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},eS=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");let e=rK(this,ey,"f");if(!e)throw new O("request ended without sending any chunks");return rW(this,ey,void 0,"f"),rW(this,eg,[],"f"),function(e,t){let{id:r,choices:n,created:s,model:a,system_fingerprint:i,...o}=e,l={...o,id:r,choices:n.map(({message:t,finish_reason:r,index:n,logprobs:s,...a})=>{if(!r)throw new O(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,u=t.role;if(!u)throw new O(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new O(`missing function_call.arguments for choice ${n}`);if(!l)throw new O(`missing function_call.name for choice ${n}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}return l?{...a,index:n,finish_reason:r,logprobs:s,message:{...c,role:u,content:i,refusal:t.refusal??null,tool_calls:l.map((t,r)=>{let{function:s,type:a,id:i,...o}=t,{arguments:l,name:c,...u}=s||{};if(null==i)throw new O(`missing choices[${n}].tool_calls[${r}].id
${rX(e)}`);if(null==a)throw new O(`missing choices[${n}].tool_calls[${r}].type
${rX(e)}`);if(null==c)throw new O(`missing choices[${n}].tool_calls[${r}].function.name
${rX(e)}`);if(null==l)throw new O(`missing choices[${n}].tool_calls[${r}].function.arguments
${rX(e)}`);return{...o,id:i,type:a,function:{...u,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:u,refusal:t.refusal??null},finish_reason:r,index:n,logprobs:s}}),created:s,model:a,object:"chat.completion",...i?{system_fingerprint:i}:{}};return t&&rj(t)?rD(l,t):{...l,choices:l.choices.map(e=>({...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,rK(this,em,"f"))},ex=function(){let e=rK(this,em,"f")?.response_format;return r$(e)?e:null},eR=function(e){var t,r,n,s;let a=rK(this,ey,"f"),{choices:i,...o}=e;for(let{delta:i,finish_reason:l,index:c,logprobs:u=null,...d}of(a?Object.assign(a,o):a=rW(this,ey,{...o,choices:[]},"f"),e.choices)){let e=a.choices[c];if(e||(e=a.choices[c]={finish_reason:l,index:c,message:{},logprobs:u,...d}),u){if(e.logprobs){let{content:n,refusal:s,...a}=u;Object.assign(e.logprobs,a),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),s&&((r=e.logprobs).refusal??(r.refusal=[]),e.logprobs.refusal.push(...s))}else e.logprobs=Object.assign({},u)}if(l&&(e.finish_reason=l,rK(this,em,"f")&&rj(rK(this,em,"f")))){if("length"===l)throw new H;if("content_filter"===l)throw new G}if(Object.assign(e,d),!i)continue;let{content:o,refusal:h,function_call:p,role:f,tool_calls:m,...g}=i;if(Object.assign(e.message,g),h&&(e.message.refusal=(e.message.refusal||"")+h),f&&(e.message.role=f),p&&(e.message.function_call?(p.name&&(e.message.function_call.name=p.name),p.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=p.arguments)):e.message.function_call=p),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&rK(this,ef,"m",ex).call(this)&&(e.message.parsed=rV(e.message.content))),m)for(let{index:t,id:r,type:n,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(s=e.message.tool_calls)[t]??(s[t]={});Object.assign(o,i),r&&(o.id=r),n&&(o.type=n),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e)return!1;let r=e.tools?.find(e=>e.function?.name===t.function.name);return rM(r)||r?.function.strict||!1}(rK(this,em,"f"),o)&&(o.function.parsed_arguments=rV(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("chunk",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});let n=e.shift();return{value:n,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){let e=new e8(this[Symbol.asyncIterator].bind(this),this.controller);return e.toReadableStream()}}function rX(e){return JSON.stringify(e)}class rz extends rJ{static fromReadableStream(e){let t=new rz(null);return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,r){let n=new rz(null),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run(()=>n._runFunctions(e,t,s)),n}static runTools(e,t,r){let n=new rz(t),s={...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,s)),n}}class rY extends tX{parse(e,t){return!function(e){for(let t of e??[]){if("function"!==t.type)throw new O(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new O(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap(t=>rD(t,e))}runFunctions(e,t){return e.stream?rz.runFunctions(this._client,e,t):rU.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?rz.runTools(this._client,e,t):rU.runTools(this._client,e,t)}stream(e,t){return rJ.createChatCompletion(this._client,e,t)}}class rQ extends tX{constructor(){super(...arguments),this.completions=new rY(this._client)}}(rQ||(rQ={})).Completions=rY;class rZ extends tX{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class r0 extends tX{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class r1 extends tX{constructor(){super(...arguments),this.sessions=new rZ(this._client),this.transcriptionSessions=new r0(this._client)}}r1.Sessions=rZ,r1.TranscriptionSessions=r0;var r2=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)},r4=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r};class r3 extends rN{constructor(){super(...arguments),eP.add(this),eA.set(this,[]),eC.set(this,{}),eT.set(this,{}),eO.set(this,void 0),eI.set(this,void 0),ek.set(this,void 0),eN.set(this,void 0),e$.set(this,void 0),eM.set(this,void 0),eD.set(this,void 0),ej.set(this,void 0),eL.set(this,void 0)}[(eA=new WeakMap,eC=new WeakMap,eT=new WeakMap,eO=new WeakMap,eI=new WeakMap,ek=new WeakMap,eN=new WeakMap,e$=new WeakMap,eM=new WeakMap,eD=new WeakMap,ej=new WeakMap,eL=new WeakMap,eP=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});let n=e.shift();return{value:n,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new r3;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let r=t?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=e8.fromReadableStream(e,this.controller);for await(let e of n)r2(this,eP,"m",eq).call(this,e);if(n.controller.signal?.aborted)throw new k;return this._addRun(r2(this,eP,"m",eU).call(this))}toReadableStream(){let e=new e8(this[Symbol.asyncIterator].bind(this),this.controller);return e.toReadableStream()}static createToolAssistantStream(e,t,r,n,s){let a=new r3;return a._run(()=>a._runToolAssistantStream(e,t,r,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),a}async _createToolAssistantStream(e,t,r,n,s){let a=s?.signal;a&&(a.aborted&&this.controller.abort(),a.addEventListener("abort",()=>this.controller.abort()));let i={...n,stream:!0},o=await e.submitToolOutputs(t,r,i,{...s,signal:this.controller.signal});for await(let e of(this._connected(),o))r2(this,eP,"m",eq).call(this,e);if(o.controller.signal?.aborted)throw new k;return this._addRun(r2(this,eP,"m",eU).call(this))}static createThreadAssistantStream(e,t,r){let n=new r3;return n._run(()=>n._threadAssistantStream(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,r,n){let s=new r3;return s._run(()=>s._runAssistantStream(e,t,r,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}currentEvent(){return r2(this,eD,"f")}currentRun(){return r2(this,ej,"f")}currentMessageSnapshot(){return r2(this,eO,"f")}currentRunStepSnapshot(){return r2(this,eL,"f")}async finalRunSteps(){return await this.done(),Object.values(r2(this,eC,"f"))}async finalMessages(){return await this.done(),Object.values(r2(this,eT,"f"))}async finalRun(){if(await this.done(),!r2(this,eI,"f"))throw Error("Final run was not received.");return r2(this,eI,"f")}async _createThreadAssistantStream(e,t,r){let n=r?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let s={...t,stream:!0},a=await e.createAndRun(s,{...r,signal:this.controller.signal});for await(let e of(this._connected(),a))r2(this,eP,"m",eq).call(this,e);if(a.controller.signal?.aborted)throw new k;return this._addRun(r2(this,eP,"m",eU).call(this))}async _createAssistantStream(e,t,r,n){let s=n?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort()));let a={...r,stream:!0},i=await e.create(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))r2(this,eP,"m",eq).call(this,e);if(i.controller.signal?.aborted)throw new k;return this._addRun(r2(this,eP,"m",eU).call(this))}static accumulateDelta(e,t){for(let[r,n]of Object.entries(t)){if(!e.hasOwnProperty(r)){e[r]=n;continue}let t=e[r];if(null==t||"index"===r||"type"===r){e[r]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(tJ(t)&&tJ(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!tJ(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let r=e.index;if(null==r)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof r)throw Error(`Expected array delta entry \`index\` property to be a number but got ${r}`);let n=t[r];null==n?t.push(e):t[r]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${r}, deltaValue: ${n}, accValue: ${t}`);e[r]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,r){return await this._createThreadAssistantStream(t,e,r)}async _runAssistantStream(e,t,r,n){return await this._createAssistantStream(t,e,r,n)}async _runToolAssistantStream(e,t,r,n,s){return await this._createToolAssistantStream(r,e,t,n,s)}}eq=function(e){if(!this.ended)switch(r4(this,eD,e,"f"),r2(this,eP,"m",eH).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":r2(this,eP,"m",eK).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":r2(this,eP,"m",eF).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":r2(this,eP,"m",eB).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eU=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");if(!r2(this,eI,"f"))throw Error("Final run has not been received");return r2(this,eI,"f")},eB=function(e){let[t,r]=r2(this,eP,"m",eV).call(this,e,r2(this,eO,"f"));for(let e of(r4(this,eO,t,"f"),r2(this,eT,"f")[t.id]=t,r)){let r=t.content[e.index];r?.type=="text"&&this._emit("textCreated",r.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let r of e.data.delta.content){if("text"==r.type&&r.text){let e=r.text,n=t.content[r.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(r.index!=r2(this,ek,"f")){if(r2(this,eN,"f"))switch(r2(this,eN,"f").type){case"text":this._emit("textDone",r2(this,eN,"f").text,r2(this,eO,"f"));break;case"image_file":this._emit("imageFileDone",r2(this,eN,"f").image_file,r2(this,eO,"f"))}r4(this,ek,r.index,"f")}r4(this,eN,t.content[r.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==r2(this,ek,"f")){let t=e.data.content[r2(this,ek,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,r2(this,eO,"f"));break;case"text":this._emit("textDone",t.text,r2(this,eO,"f"))}}r2(this,eO,"f")&&this._emit("messageDone",e.data),r4(this,eO,void 0,"f")}},eF=function(e){let t=r2(this,eP,"m",eG).call(this,e);switch(r4(this,eL,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let r=e.data.delta;if(r.step_details&&"tool_calls"==r.step_details.type&&r.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of r.step_details.tool_calls)e.index==r2(this,e$,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(r2(this,eM,"f")&&this._emit("toolCallDone",r2(this,eM,"f")),r4(this,e$,e.index,"f"),r4(this,eM,t.step_details.tool_calls[e.index],"f"),r2(this,eM,"f")&&this._emit("toolCallCreated",r2(this,eM,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":r4(this,eL,void 0,"f");let n=e.data.step_details;"tool_calls"==n.type&&r2(this,eM,"f")&&(this._emit("toolCallDone",r2(this,eM,"f")),r4(this,eM,void 0,"f")),this._emit("runStepDone",e.data,t)}},eH=function(e){r2(this,eA,"f").push(e),this._emit("event",e)},eG=function(e){switch(e.event){case"thread.run.step.created":return r2(this,eC,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=r2(this,eC,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let r=e.data;if(r.delta){let n=r3.accumulateDelta(t,r.delta);r2(this,eC,"f")[e.data.id]=n}return r2(this,eC,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":r2(this,eC,"f")[e.data.id]=e.data}if(r2(this,eC,"f")[e.data.id])return r2(this,eC,"f")[e.data.id];throw Error("No snapshot available")},eV=function(e,t){let r=[];switch(e.event){case"thread.message.created":return[e.data,r];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let r=t.content[e.index];t.content[e.index]=r2(this,eP,"m",eW).call(this,e,r)}else t.content[e.index]=e,r.push(e);return[t,r];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,r];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},eW=function(e,t){return r3.accumulateDelta(t,e)},eK=function(e){switch(r4(this,ej,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":r4(this,eI,e.data,"f"),r2(this,eM,"f")&&(this._emit("toolCallDone",r2(this,eM,"f")),r4(this,eM,void 0,"f"))}};class r6 extends tX{create(e,t,r){return this._client.post(`/threads/${e}/messages`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}retrieve(e,t,r){return this._client.get(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,r5,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t,r){return this._client.delete(`/threads/${e}/messages/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}}class r5 extends tZ{}r6.MessagesPage=r5;class r8 extends tX{retrieve(e,t,r,n={},s){return tP(n)?this.retrieve(e,t,r,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${r}`,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,r={},n){return tP(r)?this.list(e,t,{},r):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,r9,{query:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class r9 extends tZ{}r8.RunStepsPage=r9;class r7 extends tX{constructor(){super(...arguments),this.steps=new r8(this._client)}create(e,t,r){let{include:n,...s}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:s,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers},stream:t.stream??!1})}retrieve(e,t,r){return this._client.get(`/threads/${e}/runs/${t}`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}update(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,ne,{query:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}cancel(e,t,r){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}async createAndPoll(e,t,r){let n=await this.create(e,t,r);return await this.poll(e,n.id,r)}createAndStream(e,t,r){return r3.createAssistantStream(e,this._client.beta.threads.runs,t,r)}async poll(e,t,r){let n={...r?.headers,"X-Stainless-Poll-Helper":"true"};for(r?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=r.pollIntervalMs.toString());;){let{data:s,response:a}=await this.retrieve(e,t,{...r,headers:{...r?.headers,...n}}).withResponse();switch(s.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(r?.pollIntervalMs)i=r.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await t$(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return s}}}stream(e,t,r){return r3.createAssistantStream(e,this._client.beta.threads.runs,t,r)}submitToolOutputs(e,t,r,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:r,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:r.stream??!1})}async submitToolOutputsAndPoll(e,t,r,n){let s=await this.submitToolOutputs(e,t,r,n);return await this.poll(e,s.id,n)}submitToolOutputsStream(e,t,r,n){return r3.createToolAssistantStream(e,t,this._client.beta.threads.runs,r,n)}}class ne extends tZ{}r7.RunsPage=ne,r7.Steps=r8,r7.RunStepsPage=r9;class nt extends tX{constructor(){super(...arguments),this.runs=new r7(this._client),this.messages=new r6(this._client)}create(e={},t){return tP(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,r){return this._client.post(`/threads/${e}`,{body:t,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){let r=await this.createAndRun(e,t);return await this.runs.poll(r.thread_id,r.id,t)}createAndRunStream(e,t){return r3.createThreadAssistantStream(e,this._client.beta.threads,t)}}nt.Runs=r7,nt.RunsPage=ne,nt.Messages=r6,nt.MessagesPage=r5;class nr extends tX{constructor(){super(...arguments),this.realtime=new r1(this._client),this.chat=new rQ(this._client),this.assistants=new rR(this._client),this.threads=new nt(this._client)}}nr.Realtime=r1,nr.Assistants=rR,nr.AssistantsPage=rP,nr.Threads=nt;class nn extends tX{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/batches",ns,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class ns extends tZ{}nn.BatchesPage=ns;class na extends tX{create(e,t,r){return this._client.post(`/uploads/${e}/parts`,td({body:t,...r}))}}class ni extends tX{constructor(){super(...arguments),this.parts=new na(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,r){return this._client.post(`/uploads/${e}/complete`,{body:t,...r})}}function no(e,t){let r=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var r,n,s;let a=(r=e.tools??[],n=t.name,r.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:(s=a,s?.$brand==="auto-parseable-tool")?a.$parseRaw(t.arguments):a?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let r=e.content.map(e=>"output_text"===e.type?{...e,parsed:function(e,t){if(e.text?.format?.type!=="json_schema")return null;if("$parseRaw"in e.text?.format){let r=e.text?.format;return r.$parseRaw(t)}return JSON.parse(t)}(t,e.text)}:e);return{...e,content:r}}return e}),n=Object.assign({},e,{output:r});return Object.getOwnPropertyDescriptor(e,"output_text")||nl(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function nl(e){let t=[];for(let r of e.output)if("message"===r.type)for(let e of r.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}ni.Parts=na;class nc extends tX{list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/responses/${e}/input_items`,nf,{query:t,...r})}}var nu=function(e,t,r,n,s){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!s)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(e,r):s?s.value=r:t.set(e,r),r},nd=function(e,t,r,n){if("a"===r&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?n:"a"===r?n.call(e):n?n.value:t.get(e)};class nh extends rN{constructor(e){super(),eJ.add(this),eX.set(this,void 0),ez.set(this,void 0),eY.set(this,void 0),nu(this,eX,e,"f")}static createResponse(e,t,r){let n=new nh(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,r){let n;let s=r?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),nd(this,eJ,"m",eQ).call(this);let a=null;for await(let s of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...r,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...r,signal:this.controller.signal}),this._connected(),n))nd(this,eJ,"m",eZ).call(this,s,a);if(n.controller.signal?.aborted)throw new k;return nd(this,eJ,"m",e0).call(this)}[(eX=new WeakMap,ez=new WeakMap,eY=new WeakMap,eJ=new WeakSet,eQ=function(){this.ended||nu(this,ez,void 0,"f")},eZ=function(e,t){if(this.ended)return;let r=(e,r)=>{(null==t||r.sequence_number>t)&&this._emit(e,r)},n=nd(this,eJ,"m",e1).call(this,e);switch(r("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new O(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new O(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new O(`expected content to be 'output_text', got ${n.type}`);r("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new O(`missing output at index ${e.output_index}`);"function_call"===t.type&&r("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:r(e.type,e)}},e0=function(){if(this.ended)throw new O("stream has ended, this shouldn't happen");let e=nd(this,ez,"f");if(!e)throw new O("request ended without sending any events");nu(this,ez,void 0,"f");let t=function(e,t){return t&&r$(t.text?.format)?no(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,nd(this,eX,"f"));return nu(this,eY,t,"f"),t},e1=function(e){let t=nd(this,ez,"f");if(!t){if("response.created"!==e.type)throw new O(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return nu(this,ez,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let r=t.output[e.output_index];if(!r)throw new O(`missing output at index ${e.output_index}`);"message"===r.type&&r.content.push(e.part);break}case"response.output_text.delta":{let r=t.output[e.output_index];if(!r)throw new O(`missing output at index ${e.output_index}`);if("message"===r.type){let t=r.content[e.content_index];if(!t)throw new O(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new O(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let r=t.output[e.output_index];if(!r)throw new O(`missing output at index ${e.output_index}`);"function_call"===r.type&&(r.arguments+=e.delta);break}case"response.completed":nu(this,ez,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],r=!1;return this.on("event",r=>{let n=t.shift();n?n.resolve(r):e.push(r)}),this.on("end",()=>{for(let e of(r=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(r=!0,t))n.reject(e);t.length=0}),{next:async()=>{if(!e.length)return r?{value:void 0,done:!0}:new Promise((e,r)=>t.push({resolve:e,reject:r})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0});let n=e.shift();return{value:n,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=nd(this,eY,"f");if(!e)throw new O("stream ended without producing a ChatCompletion");return e}}class np extends tX{constructor(){super(...arguments),this.inputItems=new nc(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&nl(e),e))}retrieve(e,t={},r){return this._client.get(`/responses/${e}`,{query:t,...r,stream:t?.stream??!1})}del(e,t){return this._client.delete(`/responses/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>no(t,e))}stream(e,t){return nh.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(`/responses/${e}/cancel`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class nf extends tZ{}np.InputItems=nc;class nm extends tX{retrieve(e,t,r,n){return this._client.get(`/evals/${e}/runs/${t}/output_items/${r}`,n)}list(e,t,r={},n){return tP(r)?this.list(e,t,{},r):this._client.getAPIList(`/evals/${e}/runs/${t}/output_items`,ng,{query:r,...n})}}class ng extends tZ{}nm.OutputItemListResponsesPage=ng;class ny extends tX{constructor(){super(...arguments),this.outputItems=new nm(this._client)}create(e,t,r){return this._client.post(`/evals/${e}/runs`,{body:t,...r})}retrieve(e,t,r){return this._client.get(`/evals/${e}/runs/${t}`,r)}list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/evals/${e}/runs`,nv,{query:t,...r})}del(e,t,r){return this._client.delete(`/evals/${e}/runs/${t}`,r)}cancel(e,t,r){return this._client.post(`/evals/${e}/runs/${t}`,r)}}class nv extends tZ{}ny.RunListResponsesPage=nv,ny.OutputItems=nm,ny.OutputItemListResponsesPage=ng;class nb extends tX{constructor(){super(...arguments),this.runs=new ny(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(`/evals/${e}`,t)}update(e,t,r){return this._client.post(`/evals/${e}`,{body:t,...r})}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/evals",nw,{query:e,...t})}del(e,t){return this._client.delete(`/evals/${e}`,t)}}class nw extends tZ{}nb.EvalListResponsesPage=nw,nb.Runs=ny,nb.RunListResponsesPage=nv;class n_ extends tX{retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}/content`,{...r,headers:{Accept:"application/binary",...r?.headers},__binaryResponse:!0})}}class nE extends tX{constructor(){super(...arguments),this.content=new n_(this._client)}create(e,t,r){return this._client.post(`/containers/${e}/files`,td({body:t,...r}))}retrieve(e,t,r){return this._client.get(`/containers/${e}/files/${t}`,r)}list(e,t={},r){return tP(t)?this.list(e,{},t):this._client.getAPIList(`/containers/${e}/files`,nS,{query:t,...r})}del(e,t,r){return this._client.delete(`/containers/${e}/files/${t}`,{...r,headers:{Accept:"*/*",...r?.headers}})}}class nS extends tZ{}nE.FileListResponsesPage=nS,nE.Content=n_;class nx extends tX{constructor(){super(...arguments),this.files=new nE(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(`/containers/${e}`,t)}list(e={},t){return tP(e)?this.list({},e):this._client.getAPIList("/containers",nR,{query:e,...t})}del(e,t){return this._client.delete(`/containers/${e}`,{...t,headers:{Accept:"*/*",...t?.headers}})}}class nR extends tZ{}nx.ContainerListResponsesPage=nR,nx.Files=nE,nx.FileListResponsesPage=nS;class nP extends t_{constructor({baseURL:e=tj("OPENAI_BASE_URL"),apiKey:t=tj("OPENAI_API_KEY"),organization:r=tj("OPENAI_ORG_ID")??null,project:n=tj("OPENAI_PROJECT_ID")??null,...s}={}){if(void 0===t)throw new O("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let a={apiKey:t,organization:r,project:n,...s,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&tG())throw new O("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new tz(this),this.chat=new t4(this),this.embeddings=new t3(this),this.files=new t6(this),this.images=new t8(this),this.audio=new Audio(this),this.moderations=new rt(this),this.models=new rr(this),this.fineTuning=new rf(this),this.graders=new rg(this),this.vectorStores=new rE(this),this.beta=new nr(this),this.batches=new nn(this),this.uploads=new ni(this),this.responses=new np(this),this.evals=new nb(this),this.containers=new nx(this),this._options=a,this.apiKey=t,this.organization=r,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let r,n=e,s=function(e=x){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let r=e.charset||x.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=p;if(void 0!==e.format){if(!v.call(f,e.format))throw TypeError("Unknown format option provided.");n=e.format}let s=f[n],a=x.filter;if(("function"==typeof e.filter||w(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in b?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":x.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||x.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:x.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:x.allowEmptyArrays,arrayFormat:t,charset:r,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:x.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?x.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:x.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:x.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:x.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:x.encodeValuesOnly,filter:a,format:n,formatter:s,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:x.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:x.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:x.strictNullHandling}}(t);"function"==typeof s.filter?n=(0,s.filter)("",n):w(s.filter)&&(r=s.filter);let a=[];if("object"!=typeof n||null===n)return"";let i=b[s.arrayFormat],o="comma"===i&&s.commaRoundTrip;r||(r=Object.keys(n)),s.sort&&r.sort(s.sort);let l=new WeakMap;for(let e=0;e<r.length;++e){let t=r[e];s.skipNulls&&null===n[t]||E(a,function e(t,r,n,s,a,i,o,l,c,u,d,h,p,f,m,g,v,b){var _,S;let P,A=t,C=b,T=0,O=!1;for(;void 0!==(C=C.get(R))&&!O;){let e=C.get(t);if(T+=1,void 0!==e){if(e===T)throw RangeError("Cyclic object value");O=!0}void 0===C.get(R)&&(T=0)}if("function"==typeof u?A=u(r,A):A instanceof Date?A=p?.(A):"comma"===n&&w(A)&&(A=y(A,function(e){return e instanceof Date?p?.(e):e})),null===A){if(i)return c&&!g?c(r,x.encoder,v,"key",f):r;A=""}if("string"==typeof(_=A)||"number"==typeof _||"boolean"==typeof _||"symbol"==typeof _||"bigint"==typeof _||(S=A)&&"object"==typeof S&&S.constructor&&S.constructor.isBuffer&&S.constructor.isBuffer(S)){if(c){let e=g?r:c(r,x.encoder,v,"key",f);return[m?.(e)+"="+m?.(c(A,x.encoder,v,"value",f))]}return[m?.(r)+"="+m?.(String(A))]}let I=[];if(void 0===A)return I;if("comma"===n&&w(A))g&&c&&(A=y(A,c)),P=[{value:A.length>0?A.join(",")||null:void 0}];else if(w(u))P=u;else{let e=Object.keys(A);P=d?e.sort(d):e}let k=l?String(r).replace(/\./g,"%2E"):String(r),N=s&&w(A)&&1===A.length?k+"[]":k;if(a&&w(A)&&0===A.length)return N+"[]";for(let r=0;r<P.length;++r){let y=P[r],_="object"==typeof y&&void 0!==y.value?y.value:A[y];if(o&&null===_)continue;let S=h&&l?y.replace(/\./g,"%2E"):y,x=w(A)?"function"==typeof n?n(N,S):N:N+(h?"."+S:"["+S+"]");b.set(t,T);let C=new WeakMap;C.set(R,b),E(I,e(_,x,n,s,a,i,o,l,"comma"===n&&g&&w(A)?null:c,u,d,h,p,f,m,g,v,C))}return I}(n[t],t,i,o,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,l))}let c=a.join(s.delimiter),u=!0===s.addQueryPrefix?"?":"";return s.charsetSentinel&&("iso-8859-1"===s.charset?u+="utf8=%26%2310003%3B&":u+="utf8=%E2%9C%93&"),c.length>0?u+c:""}(e,{arrayFormat:"brackets"})}}nP.OpenAI=nP,nP.DEFAULT_TIMEOUT=6e5,nP.OpenAIError=O,nP.APIError=I,nP.APIConnectionError=N,nP.APIConnectionTimeoutError=$,nP.APIUserAbortError=k,nP.NotFoundError=L,nP.ConflictError=q,nP.RateLimitError=B,nP.BadRequestError=M,nP.AuthenticationError=D,nP.InternalServerError=F,nP.PermissionDeniedError=j,nP.UnprocessableEntityError=U,nP.toFile=ti,nP.fileFromPath=d,nP.Completions=tz,nP.Chat=t4,nP.ChatCompletionsPage=t1,nP.Embeddings=t3,nP.Files=t6,nP.FileObjectsPage=t5,nP.Images=t8,nP.Audio=Audio,nP.Moderations=rt,nP.Models=rr,nP.ModelsPage=rn,nP.FineTuning=rf,nP.Graders=rg,nP.VectorStores=rE,nP.VectorStoresPage=rS,nP.VectorStoreSearchResponsesPage=rx,nP.Beta=nr,nP.Batches=nn,nP.BatchesPage=ns,nP.Uploads=ni,nP.Responses=np,nP.Evals=nb,nP.EvalListResponsesPage=nw,nP.Containers=nx,nP.ContainerListResponsesPage=nR;let nA=nP},2882:e=>{"use strict";e.exports=JSON.parse('{"name":"@notionhq/client","version":"2.3.0","description":"A simple and easy to use client for the Notion API","engines":{"node":">=12"},"homepage":"https://developers.notion.com/docs/getting-started","bugs":{"url":"https://github.com/makenotion/notion-sdk-js/issues"},"repository":{"type":"git","url":"https://github.com/makenotion/notion-sdk-js/"},"keywords":["notion","notionapi","rest","notion-api"],"main":"./build/src","types":"./build/src/index.d.ts","scripts":{"prepare":"npm run build","prepublishOnly":"npm run checkLoggedIn && npm run lint && npm run test","build":"tsc","prettier":"prettier --write .","lint":"prettier --check . && eslint . --ext .ts && cspell \'**/*\' ","test":"jest ./test","check-links":"git ls-files | grep md$ | xargs -n 1 markdown-link-check","prebuild":"npm run clean","clean":"rm -rf ./build","checkLoggedIn":"./scripts/verifyLoggedIn.sh"},"author":"","license":"MIT","files":["build/package.json","build/src/**"],"dependencies":{"@types/node-fetch":"^2.5.10","node-fetch":"^2.6.1"},"devDependencies":{"@types/jest":"^28.1.4","@typescript-eslint/eslint-plugin":"^5.39.0","@typescript-eslint/parser":"^5.39.0","cspell":"^5.4.1","eslint":"^7.24.0","jest":"^28.1.2","markdown-link-check":"^3.8.7","prettier":"^2.8.8","ts-jest":"^28.0.5","typescript":"^4.8.4"}}')}},e=>{var t=e(e.s=2482);(_ENTRIES="undefined"==typeof _ENTRIES?{}:_ENTRIES)["middleware_app/api/chat/route"]=t}]);
//# sourceMappingURL=route.js.map